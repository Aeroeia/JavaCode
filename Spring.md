# 		Springé¢è¯•

## Spring

### è¯´ä¸€ä¸‹ä½ å¯¹ Spring çš„ç†è§£

![img](https://cdn.xiaolincoding.com//picgo/1712650311366-b499469c-5afd-4be9-bad3-d787de86bf98.png)

Springæ¡†æ¶æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š

- **IoCå®¹å™¨**ï¼šSpringé€šè¿‡æ§åˆ¶åè½¬å®ç°äº†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ç®¡ç†ã€‚å¼€å‘è€…åªéœ€è¦å®šä¹‰å¥½BeanåŠå…¶ä¾èµ–å…³ç³»ï¼ŒSpringå®¹å™¨è´Ÿè´£åˆ›å»ºå’Œç»„è£…è¿™äº›å¯¹è±¡ã€‚

  > æ§åˆ¶åè½¬çš„æ„æ€æ˜¯ï¼š
  >
  > - **åŸæœ¬ç”±ç¨‹åºå‘˜è‡ªå·±åœ¨ä»£ç ä¸­åˆ›å»ºå’Œç®¡ç†å¯¹è±¡çš„è¿‡ç¨‹**ï¼ˆæ¯”å¦‚ `new UserService()`ï¼‰ï¼Œ
  > - äº¤ç»™ **Spring å®¹å™¨** æ¥è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€ç®¡ç†å’Œä¾èµ–æ³¨å…¥ã€‚

- **AOP**ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå…è®¸å¼€å‘è€…å®šä¹‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†ã€å®‰å…¨æ§åˆ¶ç­‰ï¼Œç‹¬ç«‹äºä¸šåŠ¡é€»è¾‘çš„ä»£ç ã€‚é€šè¿‡AOPï¼Œå¯ä»¥å°†è¿™äº›å…³æ³¨ç‚¹æ¨¡å—åŒ–ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚

- **äº‹åŠ¡ç®¡ç†**ï¼šSpringæä¾›äº†ä¸€è‡´çš„äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œæ”¯æŒå£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€‚å¼€å‘è€…å¯ä»¥è½»æ¾åœ°è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„äº‹åŠ¡APIã€‚

- **MVCæ¡†æ¶**ï¼šSpring MVCæ˜¯ä¸€ä¸ªåŸºäºServlet APIæ„å»ºçš„Webæ¡†æ¶ï¼Œé‡‡ç”¨äº†æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¶æ„ã€‚å®ƒæ”¯æŒçµæ´»çš„URLåˆ°é¡µé¢æ§åˆ¶å™¨çš„æ˜ å°„ï¼Œä»¥åŠå¤šç§è§†å›¾æŠ€æœ¯ã€‚

------

### Springçš„aopä»‹ç»ä¸€ä¸‹

Spring AOPæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦æ¨¡å—ï¼Œç”¨äºå®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒJava å°±æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­è¨€ï¼Œåœ¨ OOP ä¸­æœ€å°çš„å•å…ƒå°±æ˜¯â€œClass å¯¹è±¡â€ï¼Œä½†æ˜¯åœ¨ AOP ä¸­æœ€å°çš„å•å…ƒæ˜¯â€œåˆ‡é¢â€ã€‚ä¸€ä¸ªâ€œåˆ‡é¢â€å¯ä»¥åŒ…å«å¾ˆå¤šç§ç±»å‹å’Œå¯¹è±¡ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†ã€‚

åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ€æƒ³é‡Œé¢ï¼ŒæŠŠåŠŸèƒ½åˆ†ä¸ºä¸¤ç§

- **æ ¸å¿ƒä¸šåŠ¡**ï¼šç™»é™†ã€æ³¨å†Œã€å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€éƒ½å«æ ¸å¿ƒä¸šåŠ¡
- **å‘¨è¾¹åŠŸèƒ½**ï¼šæ—¥å¿—ã€äº‹åŠ¡ç®¡ç†è¿™äº›æ¬¡è¦çš„ä¸ºå‘¨è¾¹ä¸šåŠ¡

åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å’Œå‘¨è¾¹åŠŸèƒ½æ˜¯åˆ†åˆ«ç‹¬ç«‹è¿›è¡Œå¼€å‘ï¼Œä¸¤è€…ä¸æ˜¯è€¦åˆçš„ï¼Œç„¶åæŠŠåˆ‡é¢åŠŸèƒ½å’Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ "ç¼–ç»‡" åœ¨ä¸€èµ·ï¼Œè¿™å°±å«AOPã€‚

AOPèƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œ**å´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥**ï¼Œä¾¿äº**å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç **ï¼Œ**é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦**ï¼Œå¹¶**æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§**ã€‚

åœ¨ AOP ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š

- **AspectJ**ï¼šåˆ‡é¢ï¼Œåªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ²¡æœ‰å…·ä½“çš„æ¥å£æˆ–ç±»ä¸ä¹‹å¯¹åº”ï¼Œæ˜¯ Join pointï¼ŒAdvice å’Œ Pointcut çš„ä¸€ä¸ªç»Ÿç§°ã€‚
- **Join point**ï¼šè¿æ¥ç‚¹ï¼ŒæŒ‡ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚==åœ¨ Spring AOP ä¸­ï¼Œä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„è¿æ¥ç‚¹ã€‚==
- **Advice**ï¼šé€šçŸ¥ï¼Œå³æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªåˆ‡é¢ä¸­çš„æ¨ªåˆ‡é€»è¾‘ï¼Œ==æœ‰â€œaroundâ€ï¼Œâ€œbeforeâ€å’Œâ€œafterâ€ä¸‰ç§ç±»å‹==ã€‚åœ¨å¾ˆå¤šçš„ AOP å®ç°æ¡†æ¶ä¸­ï¼ŒAdvice é€šå¸¸ä½œä¸ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¹Ÿå¯ä»¥åŒ…å«è®¸å¤šä¸ªæ‹¦æˆªå™¨ä½œä¸ºä¸€æ¡é“¾è·¯å›´ç»•ç€ Join point è¿›è¡Œå¤„ç†ã€‚
- **Pointcut**ï¼šåˆ‡ç‚¹ï¼Œç”¨äºåŒ¹é…è¿æ¥ç‚¹ï¼Œä¸€ä¸ª AspectJ ä¸­åŒ…å«å“ªäº› Join point éœ€è¦ç”± Pointcut è¿›è¡Œç­›é€‰ã€‚
- **Introduction**ï¼šå¼•ä»‹ï¼Œè®©ä¸€ä¸ªåˆ‡é¢å¯ä»¥å£°æ˜è¢«é€šçŸ¥çš„å¯¹è±¡å®ç°ä»»ä½•ä»–ä»¬æ²¡æœ‰çœŸæ­£å®ç°çš„é¢å¤–çš„æ¥å£ã€‚ä¾‹å¦‚å¯ä»¥è®©ä¸€ä¸ªä»£ç†å¯¹è±¡ä»£ç†ä¸¤ä¸ªç›®æ ‡ç±»ã€‚
- **Weaving**ï¼šç»‡å…¥ï¼Œåœ¨æœ‰äº†è¿æ¥ç‚¹ã€åˆ‡ç‚¹ã€é€šçŸ¥ä»¥åŠåˆ‡é¢ï¼Œå¦‚ä½•å°†å®ƒä»¬åº”ç”¨åˆ°ç¨‹åºä¸­å‘¢ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯ç»‡å…¥ï¼Œåœ¨åˆ‡ç‚¹çš„å¼•å¯¼ä¸‹ï¼Œå°†é€šçŸ¥é€»è¾‘æ’å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸Šï¼Œä½¿å¾—æˆ‘ä»¬çš„é€šçŸ¥é€»è¾‘åœ¨æ–¹æ³•è°ƒç”¨æ—¶å¾—ä»¥æ‰§è¡Œã€‚
- **AOP proxy**ï¼šAOP ä»£ç†ï¼ŒæŒ‡åœ¨ AOP å®ç°æ¡†æ¶ä¸­å®ç°åˆ‡é¢åè®®çš„å¯¹è±¡ã€‚åœ¨ Spring AOP ä¸­æœ‰ä¸¤ç§ä»£ç†ï¼Œåˆ†åˆ«æ˜¯ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†ã€‚
- **Target object**ï¼šç›®æ ‡å¯¹è±¡ï¼Œå°±æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ã€‚

Spring AOP æ˜¯==åŸºäº JDK åŠ¨æ€ä»£ç†å’Œ Cglib æå‡å®ç°çš„==ï¼Œä¸¤ç§ä»£ç†æ–¹å¼éƒ½å±äºè¿è¡Œæ—¶çš„ä¸€ä¸ªæ–¹å¼ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç¼–è¯‘æ—¶çš„ä¸€ä¸ªå¤„ç†ï¼Œé‚£ä¹ˆå› æ­¤ Spring æ˜¯é€šè¿‡ Java ä»£ç å®ç°çš„ã€‚

==Spring AOP åŸºäº**åŠ¨æ€ä»£ç†**ï¼ˆJDK åŠ¨æ€ä»£ç†æˆ– CGLIBï¼‰ï¼Œå®ƒåªä¼šä»£ç†ç”± **Spring IoC å®¹å™¨åˆ›å»ºå’Œç®¡ç†çš„ Bean**==

------

### IOCå’ŒAOPæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å®ç°çš„?

> Spring IOC å®ç°æœºåˆ¶

- **åå°„**ï¼šSpring IOCå®¹å™¨åˆ©ç”¨Javaçš„åå°„æœºåˆ¶åŠ¨æ€åœ°åŠ è½½ç±»ã€åˆ›å»ºå¯¹è±¡å®ä¾‹åŠè°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œåå°„å…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ä¿¡æ¯ï¼Œä»è€Œå®ç°çµæ´»çš„å¯¹è±¡å®ä¾‹åŒ–å’Œç®¡ç†ã€‚
- **ä¾èµ–æ³¨å…¥**ï¼šIOCçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ä¾èµ–æ³¨å…¥ï¼Œå³å®¹å™¨è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Springé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ã€å±æ€§æ³¨å…¥æˆ–æ–¹æ³•æ³¨å…¥ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æè¿°åœ¨é…ç½®æ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ³¨è§£ã€‚
- **è®¾è®¡æ¨¡å¼ - å·¥å‚æ¨¡å¼**ï¼šSpring IOCå®¹å™¨é€šå¸¸é‡‡ç”¨å·¥å‚æ¨¡å¼æ¥ç®¡ç†å¯¹è±¡çš„åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸã€‚å®¹å™¨ä½œä¸ºå·¥å‚è´Ÿè´£å®ä¾‹åŒ–Beanå¹¶ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°†Beançš„å®ä¾‹åŒ–è¿‡ç¨‹äº¤ç»™å®¹å™¨æ¥ç®¡ç†ã€‚
- **å®¹å™¨å®ç°**ï¼šSpring IOCå®¹å™¨æ˜¯å®ç°IOCçš„æ ¸å¿ƒï¼Œé€šå¸¸ä½¿ç”¨BeanFactoryæˆ–ApplicationContextæ¥ç®¡ç†Beanã€‚BeanFactoryæ˜¯IOCå®¹å™¨çš„åŸºæœ¬å½¢å¼ï¼Œæä¾›åŸºæœ¬çš„IOCåŠŸèƒ½ï¼›ApplicationContextæ˜¯BeanFactoryçš„æ‰©å±•ï¼Œå¹¶æä¾›æ›´å¤šä¼ä¸šçº§åŠŸèƒ½ã€‚

> Spring AOP å®ç°æœºåˆ¶

Spring AOPçš„å®ç°ä¾èµ–äº**åŠ¨æ€ä»£ç†æŠ€æœ¯**ã€‚åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶æŒ‡å®šè¦ä»£ç†çš„æ¥å£å’Œè¡Œä¸ºï¼Œä»è€Œå®ç°åœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹å¢å¼ºæ–¹æ³•çš„åŠŸèƒ½ã€‚

Spring AOPæ”¯æŒä¸¤ç§åŠ¨æ€ä»£ç†ï¼š

- **åŸºäºJDKçš„åŠ¨æ€ä»£ç†**ï¼šä½¿ç”¨java.lang.reflect.Proxyç±»å’Œjava.lang.reflect.InvocationHandleræ¥å£å®ç°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä»£ç†çš„ç±»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚
- **åŸºäºCGLIBçš„åŠ¨æ€ä»£ç†**ï¼šå½“è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringä¼šä½¿ç”¨CGLIBåº“ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»ä½œä¸ºä»£ç†ã€‚CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç ç”Ÿæˆåº“ï¼Œé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚

==jdkåŠ¨æ€ä»£ç†æ˜¯å°†æ¥å£æ–¹æ³•å®ç° åœ¨é‡Œé¢å†™è‡ªå®šä¹‰é€»è¾‘ç„¶åè°ƒç”¨å®ç°ç±»æ–¹æ³• ç„¶åcglibæ˜¯ç»§æ‰¿å®ç°ç±» ç„¶åè‡ªå®šä¹‰é€»è¾‘ä¸­è°ƒç”¨å®ç°ç±»æ–¹æ³•==

------

### æ€ä¹ˆç†è§£SpringIocï¼Ÿ

**IOC**ï¼šInversion Of Controlï¼Œå³æ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚åœ¨ä¼ ç»Ÿçš„ Java SE ç¨‹åºè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ˜¯ç¨‹åºä¸»åŠ¨åˆ›å»ºä¾èµ–å¯¹è±¡ï¼›

![img](https://cdn.xiaolincoding.com//picgo/1716790809843-e520e960-fb95-4511-aa30-73966361320a.webp)

è€Œåœ¨Springç¨‹åºè®¾è®¡ä¸­ï¼ŒIOC æ˜¯æœ‰ä¸“é—¨çš„å®¹å™¨å»æ§åˆ¶å¯¹è±¡ã€‚

![img](https://cdn.xiaolincoding.com//picgo/1716790809860-74256f8b-3a96-485c-8aa1-11fa5dfb7640.webp)

**æ‰€è°“æ§åˆ¶**å°±æ˜¯å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ã€‚

- åˆ›å»ºå¯¹è±¡ï¼šåŸæ¥æ˜¯ new ä¸€ä¸ªï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨åˆ›å»ºã€‚
- åˆå§‹åŒ–å¯¹è±¡ï¼šåŸæ¥æ˜¯å¯¹è±¡è‡ªå·±é€šè¿‡æ„é€ å™¨æˆ–è€… setter æ–¹æ³•ç»™ä¾èµ–çš„å¯¹è±¡èµ‹å€¼ï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨è‡ªåŠ¨æ³¨å…¥ã€‚
- é”€æ¯å¯¹è±¡ï¼šåŸæ¥æ˜¯ç›´æ¥ç»™å¯¹è±¡èµ‹å€¼ null æˆ–åšä¸€äº›é”€æ¯æ“ä½œï¼Œç°åœ¨æ˜¯ Spring å®¹å™¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸè´Ÿè´£é”€æ¯å¯¹è±¡ã€‚

æ€»ç»“ï¼šIOC è§£å†³äº†ç¹ççš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œï¼Œè§£è€¦äº†æˆ‘ä»¬çš„ä»£ç ã€‚**æ‰€è°“åè½¬**ï¼šå…¶å®æ˜¯åè½¬çš„æ§åˆ¶æƒï¼Œå‰é¢æåˆ°æ˜¯ç”± Spring æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ§åˆ¶å°±å®Œå…¨è„±ç¦»äº†æˆ‘ä»¬çš„æ§åˆ¶ï¼Œæ§åˆ¶æƒäº¤ç»™äº† Spring ã€‚è¿™ä¸ªåè½¬æ˜¯æŒ‡ï¼š==æˆ‘ä»¬ç”±å¯¹è±¡çš„æ§åˆ¶è€…å˜æˆäº† IOC çš„è¢«åŠ¨æ§åˆ¶è€…ã€‚==

### ä¾èµ–å€’ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ§åˆ¶åè½¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

- æ§åˆ¶åè½¬ï¼šâ€œæ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œâ€œåè½¬â€æŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæµç¨‹é€šè¿‡æ¡†æ¶æ¥æ§åˆ¶ã€‚æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜â€œåè½¬â€ç»™äº†æ¡†æ¶ã€‚

- ä¾èµ–æ³¨å…¥ï¼šä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ°æ°ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚æˆ‘ä»¬ä¸é€šè¿‡ new çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–æ³¨å…¥ï¼‰ç»™ç±»æ¥ä½¿ç”¨ã€‚

- ä¾èµ–å€’ç½®ï¼šè¿™æ¡åŸåˆ™è·Ÿæ§åˆ¶åè½¬æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸»è¦ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œå®ƒä»¬å…±åŒä¾èµ–åŒä¸€ä¸ªæŠ½è±¡ã€‚æŠ½è±¡ä¸è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚

  **ä¼ ç»Ÿä¾èµ–**

  ```java
  // é«˜å±‚æ¨¡å—ï¼šä¸šåŠ¡é€»è¾‘å±‚
  public class OrderService {
      // ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆå…·ä½“å®ç°ï¼‰
      private MySQLOrderRepository orderRepository = new MySQLOrderRepository();
      
      public void createOrder() {
          orderRepository.saveOrder();
      }
  }
  
  // ä½å±‚æ¨¡å—ï¼šæ•°æ®è®¿é—®å±‚
  public class MySQLOrderRepository {
      public void saveOrder() {
          // å…·ä½“å®ç°ï¼šMySQL ä¿å­˜è®¢å•
      }
  }
  ```

  **ä¾èµ–å€’ç½®**

  ```java
  // 1. å®šä¹‰æŠ½è±¡ï¼ˆæ¥å£ï¼‰
  public interface OrderRepository {
      void saveOrder();
  }
  
  // 2. é«˜å±‚æ¨¡å—ä¾èµ–æŠ½è±¡
  public class OrderService {
      // ä¾èµ–æŠ½è±¡ï¼Œè€Œä¸æ˜¯å…·ä½“å®ç°
      private final OrderRepository orderRepository;
      
      public OrderService(OrderRepository orderRepository) {
          this.orderRepository = orderRepository;
      }
      
      public void createOrder() {
          orderRepository.saveOrder();
      }
  }
  
  // 3. ä½å±‚æ¨¡å—å®ç°æŠ½è±¡
  public class MySQLOrderRepository implements OrderRepository {
      @Override
      public void saveOrder() {
          // MySQL å®ç°
      }
  }
  
  public class MongoDBOrderRepository implements OrderRepository {
      @Override
      public void saveOrder() {
          // MongoDB å®ç°
      }
  }
  ```

------

### ä¾èµ–æ³¨å…¥äº†è§£å—ï¼Ÿæ€ä¹ˆå®ç°ä¾èµ–æ³¨å…¥çš„ï¼Ÿ

åœ¨ä¼ ç»Ÿç¼–ç¨‹ä¸­ï¼Œå½“ä¸€ä¸ªç±»éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œé€šå¸¸ä¼šåœ¨è¯¥ç±»å†…éƒ¨é€šè¿‡`new`å…³é”®å­—æ¥åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œè¿™ä½¿å¾—ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦è¾ƒé«˜ã€‚

è€Œä¾èµ–æ³¨å…¥åˆ™æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†äº¤ç»™ Spring å®¹å™¨æ¥å®Œæˆï¼Œç±»åªéœ€è¦å£°æ˜è‡ªå·±æ‰€ä¾èµ–çš„å¯¹è±¡ï¼Œå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶å°†è¿™äº›ä¾èµ–å¯¹è±¡æ³¨å…¥åˆ°ç±»ä¸­ï¼Œä»è€Œé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

å…·ä½“åˆ°Springä¸­ï¼Œå¸¸è§çš„ä¾èµ–æ³¨å…¥çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚æ„é€ å™¨æ³¨å…¥ã€Setteræ–¹æ³•æ³¨å…¥ï¼Œè¿˜æœ‰å­—æ®µæ³¨å…¥ã€‚

- **æ„é€ å™¨æ³¨å…¥ï¼š**é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ä¾èµ–å¯¹è±¡ï¼Œä¿è¯å¯¹è±¡åˆå§‹åŒ–æ—¶ä¾èµ–å·²å°±ç»ªã€‚

```java
@Service
public class UserService {
    private final UserRepository userRepository;
    
    // æ„é€ å™¨æ³¨å…¥ï¼ˆSpring 4.3+ è‡ªåŠ¨è¯†åˆ«å•æ„é€ å™¨ï¼Œæ— éœ€æ˜¾å¼@Autowiredï¼‰
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

- **Setter æ–¹æ³•æ³¨å…¥ï¼š**é€šè¿‡ Setter æ–¹æ³•è®¾ç½®ä¾èµ–ï¼Œçµæ´»æ€§é«˜ï¼Œä½†ä¾èµ–å¯èƒ½æœªå®Œå…¨åˆå§‹åŒ–ã€‚

```java
public class PaymentService {
    private PaymentGateway gateway;
    
    @Autowired
    public void setGateway(PaymentGateway gateway) {
        this.gateway = gateway;
    }
}
```

- **å­—æ®µæ³¨å…¥ï¼š**ç›´æ¥é€šè¿‡ `@Autowired` æ³¨è§£å­—æ®µï¼Œä»£ç ç®€æ´ä½†éšè—ä¾èµ–å…³ç³»ï¼Œä¸æ¨èç”Ÿäº§ä»£ç ã€‚

```java
@Service
public class OrderService {
    @Autowired
    private OrderRepository orderRepository;
}
```

------

### å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ

- Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šéœ€è¦è®¾è®¡Beançš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨==å·¥å‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼==æ¥å®ç°ã€‚

- ä¾èµ–æ³¨å…¥ï¼šéœ€è¦å®ç°ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å±æ€§æ³¨å…¥ã€æ„é€ å‡½æ•°æ³¨å…¥ã€æ–¹æ³•æ³¨å…¥ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨==åå°„æœºåˆ¶å’ŒXMLé…ç½®æ–‡ä»¶==æ¥å®ç°ã€‚

- Beançš„ä½œç”¨åŸŸï¼šéœ€è¦æ”¯æŒå¤šç§Beanä½œç”¨åŸŸï¼Œæ¯”å¦‚å•ä¾‹ã€åŸå‹ã€ä¼šè¯ã€è¯·æ±‚ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Mapæ¥å­˜å‚¨ä¸åŒä½œç”¨åŸŸçš„Beanå®ä¾‹ã€‚

  > #### â‘  Singletonï¼ˆå•ä¾‹ä½œç”¨åŸŸï¼‰ - **é»˜è®¤ä½œç”¨åŸŸ**
  >
  > - âˆ™**å«ä¹‰**ï¼šåœ¨æ•´ä¸ª Spring IoC å®¹å™¨ä¸­ï¼Œ**åªå­˜åœ¨ä¸€ä¸ª**è¯¥ Bean çš„å…±äº«å®ä¾‹ã€‚
  > - âˆ™**ç”Ÿå‘½å‘¨æœŸ**ï¼šâˆ™**åˆ›å»º**ï¼šå®¹å™¨å¯åŠ¨æ—¶ï¼ˆå¦‚æœè®¾ç½®ä¸ºæ‡’åŠ è½½åˆ™æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼‰åˆ›å»ºã€‚âˆ™**é”€æ¯**ï¼šå®¹å™¨å…³é—­æ—¶é”€æ¯ã€‚
  > - âˆ™**ç±»æ¯”**ï¼šå…¬å¸é‡Œçš„**æ‰“å°æœº**ã€‚å…¨å…¬å¸åªæœ‰è¿™ä¸€å°ï¼Œæ‰€æœ‰äººï¼ˆæ‰€æœ‰ä»£ç ã€æ‰€æœ‰è¯·æ±‚ï¼‰éƒ½å…±äº«ä½¿ç”¨è¿™ä¸€å°ã€‚èŠ‚çœèµ„æºï¼Œä½†è¦ç‰¹åˆ«æ³¨æ„çº¿ç¨‹å®‰å…¨ï¼ˆä¸èƒ½ä¸¤ä¸ªäººåŒæ—¶è®¾ç½®ä¸åŒçš„æ‰“å°è®¾ç½®ï¼‰ã€‚
  > - âˆ™**ä»£ç **ï¼š`@Scope("singleton")`æˆ– `@Scope(ConfigurableBeanFactory.SCOPE_SINGLETON)`ï¼Œæˆ–è€…ä¸å†™ï¼ˆå› ä¸ºå®ƒæ˜¯é»˜è®¤å€¼ï¼‰ã€‚
  >
  > #### â‘¡ Prototypeï¼ˆåŸå‹ä½œç”¨åŸŸï¼‰
  >
  > - âˆ™**å«ä¹‰**ï¼š**æ¯æ¬¡è¯·æ±‚**ï¼ˆé€šè¿‡ `getBean()`æˆ–æ³¨å…¥ï¼‰éƒ½ä¼šåˆ›å»ºä¸€ä¸ª**å…¨æ–°çš„** Bean å®ä¾‹ã€‚
  > - âˆ™**ç”Ÿå‘½å‘¨æœŸ**ï¼šâˆ™**åˆ›å»º**ï¼šæ¯æ¬¡è¢«è¯·æ±‚æ—¶åˆ›å»ºã€‚âˆ™**é”€æ¯**ï¼šåˆ›å»ºåï¼Œå®ä¾‹çš„ç®¡ç†æƒå°±äº¤ç»™äº†å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨å®ƒçš„ä»£ç ï¼‰ï¼Œå®¹å™¨ä¸å†è·Ÿè¸ªå…¶ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿä¸ä¼šè´Ÿè´£é”€æ¯å®ƒã€‚ç±»ä¼¼äº Java çš„ `new`å…³é”®å­—ã€‚
  > - âˆ™**ç±»æ¯”**ï¼šåŒ»é™¢æ‰“é’ˆç”¨çš„**ä¸€æ¬¡æ€§æ³¨å°„å™¨**ã€‚æ¯æ¬¡éœ€è¦æ‰“é’ˆï¼ˆæ¯æ¬¡è¯·æ±‚ï¼‰æ—¶ï¼ŒæŠ¤å£«éƒ½ä¼šç»™ä½ æ‹¿ä¸€ä¸ªå…¨æ–°çš„ã€ç‹¬ç«‹çš„æ³¨å°„å™¨ã€‚ç”¨å®Œå³å¼ƒã€‚
  > - âˆ™**ä»£ç **ï¼š`@Scope("prototype")`æˆ– `@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)`
  >
  > #### â‘¢ Requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰ - **Web åº”ç”¨ç‰¹æœ‰**
  >
  > - âˆ™**å«ä¹‰**ï¼šåœ¨ä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œåªåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚ä¸åŒçš„ HTTP è¯·æ±‚ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„ Bean å®ä¾‹ï¼Œå®ƒä»¬ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚
  > - âˆ™**ç”Ÿå‘½å‘¨æœŸ**ï¼šâˆ™**åˆ›å»º**ï¼šæ¯æ¬¡ HTTP è¯·æ±‚å¼€å§‹æ—¶åˆ›å»ºã€‚âˆ™**é”€æ¯**ï¼šæœ¬æ¬¡ HTTP è¯·æ±‚ç»“æŸæ—¶é”€æ¯ã€‚
  > - âˆ™**é€‚ç”¨åœºæ™¯**ï¼šéå¸¸é€‚åˆç”¨æ¥å­˜å‚¨ä¸å½“å‰è¯·æ±‚ç›¸å…³çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è¡¨å•æ•°æ®ã€è¯·æ±‚å‚æ•°ç­‰ã€‚
  > - âˆ™**ä»£ç **ï¼š`@Scope("request")`æˆ– `@Scope(WebApplicationContext.SCOPE_REQUEST)`
  > - âˆ™**å‰æ**ï¼šå¿…é¡»åœ¨ Web ç¯å¢ƒçš„ Spring åº”ç”¨ä¸­ï¼ˆå¦‚ Spring MVCï¼‰æ‰èƒ½ä½¿ç”¨ã€‚
  >
  > #### â‘£ Sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰ - **Web åº”ç”¨ç‰¹æœ‰**
  >
  > - âˆ™**å«ä¹‰**ï¼šåœ¨ä¸€ä¸ª HTTP Session ä¸­ï¼Œåªåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚åŒä¸€ä¸ªç”¨æˆ·ï¼ˆåŒä¸€ä¸ª Sessionï¼‰çš„å¤šæ¬¡è¯·æ±‚ä¼šå…±äº«è¿™ä¸ª Beanï¼Œä¸åŒç”¨æˆ·çš„ Session æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ Beanã€‚
  > - âˆ™**ç”Ÿå‘½å‘¨æœŸ**ï¼šâˆ™**åˆ›å»º**ï¼šç¬¬ä¸€æ¬¡æœ‰è¯·æ±‚æ¥è‡ªæŸä¸ª Session æ—¶åˆ›å»ºã€‚âˆ™**é”€æ¯**ï¼šè¯¥ HTTP Session è¶…æ—¶æˆ–å¤±æ•ˆæ—¶é”€æ¯ã€‚
  > - âˆ™**é€‚ç”¨åœºæ™¯**ï¼šå­˜å‚¨ç”¨æˆ·çº§åˆ«çš„ä¿¡æ¯ï¼Œæœ€å…¸å‹çš„å°±æ˜¯**ç”¨æˆ·ç™»å½•çŠ¶æ€**ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆç”¨æˆ·åã€IDç­‰ï¼‰æ”¾å…¥ä¸€ä¸ª Session ä½œç”¨åŸŸçš„ Bean ä¸­ï¼Œåœ¨æ•´ä¸ªä¼šè¯æœŸé—´éƒ½å¯ä»¥æ–¹ä¾¿åœ°è·å–ã€‚
  > - âˆ™**ä»£ç **ï¼š`@Scope("session")`æˆ– `@Scope(WebApplicationContext.SCOPE_SESSION)`
  > - âˆ™**å‰æ**ï¼šåŒæ ·ï¼Œå¿…é¡»åœ¨ Web ç¯å¢ƒçš„ Spring åº”ç”¨ä¸­æ‰èƒ½ä½¿ç”¨ã€‚

- AOPåŠŸèƒ½çš„æ”¯æŒï¼šéœ€è¦æ”¯æŒAOPåŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘==ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶å’Œåˆ‡é¢ç¼–ç¨‹==æ¥å®ç°ã€‚

- å¼‚å¸¸å¤„ç†ï¼šéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬==Beanåˆ›å»ºå¼‚å¸¸ã€ä¾èµ–æ³¨å…¥å¼‚å¸¸==ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨try-catchæœºåˆ¶æ¥å¤„ç†å¼‚å¸¸ã€‚

- é…ç½®æ–‡ä»¶åŠ è½½ï¼šéœ€è¦æ”¯æŒ==ä»ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­åŠ è½½Beançš„ç›¸å…³ä¿¡æ¯==ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨XMLã€æ³¨è§£æˆ–è€…Javaé…ç½®ç±»æ¥å®ç°ã€‚

------

### SpringAOPä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜

å®ƒçš„ç›®çš„æ˜¯å¯¹äºé¢å‘å¯¹è±¡æ€ç»´çš„ä¸€ç§è¡¥å……ï¼Œè€Œä¸æ˜¯åƒå¼•å…¥å‘½ä»¤å¼ã€å‡½æ•°å¼ç¼–ç¨‹æ€ç»´è®©ä»–é¡ºåº”å¦ä¸€ç§å¼€å‘åœºæ™¯ã€‚åœ¨æˆ‘ä¸ªäººçš„ç†è§£ä¸‹==AOPæ›´åƒæ˜¯ä¸€ç§å¯¹äºä¸æ”¯æŒå¤šç»§æ‰¿çš„å¼¥è¡¥==ï¼Œé™¤å¼€å¯¹è±¡çš„ä¸»è¦ç‰¹å¾ï¼ˆæˆ‘æ›´å–œæ¬¢å«â€œå¼ºå…±æ€§â€ï¼‰è¢«æŠ½è±¡ä¸ºäº†ä¸€æ¡ç»§æ‰¿é“¾è·¯ï¼Œ==å¯¹äºä¸€äº›â€œå¼±å…±æ€§â€ï¼ŒAOPå¯ä»¥ç»Ÿä¸€å¯¹ä»–ä»¬è¿›è¡ŒæŠ½è±¡å’Œé›†ä¸­å¤„ç†ã€‚==

ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ‰“å°æ—¥å¿—ã€‚éœ€è¦æ‰“å°æ—¥å¿—å¯èƒ½æ˜¯è®¸å¤šå¯¹è±¡çš„ä¸€ä¸ªå…±æ€§ï¼Œè¿™åœ¨ä¼ä¸šçº§å¼€å‘ä¸­ååˆ†å¸¸è§ï¼Œä½†æ˜¯æ—¥å¿—çš„æ‰“å°å¹¶ä¸ååº”è¿™ä¸ªå¯¹è±¡çš„ä¸»è¦å…±æ€§ã€‚è€Œæ—¥å¿—çš„æ‰“å°åˆæ˜¯ä¸€ä¸ªå…·ä½“çš„å†…å®¹ï¼Œå®ƒå¹¶ä¸æŠ½è±¡ï¼Œæ‰€ä»¥å®ƒçš„å·¥ä½œä¹Ÿä¸å¯ä»¥ç”¨æ¥å£æ¥å®Œæˆã€‚è€Œå¦‚æœåˆ©ç”¨ç»§æ‰¿ï¼Œæ‰“å°æ—¥å¿—çš„å·¥ä½œåˆæ¨ªè·¨ç»§æ‰¿æ ‘ä¸‹é¢çš„å¤šä¸ªåŒçº§å­èŠ‚ç‚¹ï¼Œå¼ºè¡Œä¾µå…¥åˆ°ç»§æ‰¿æ ‘å†…è¿›è¡Œå½’çº³ä¼šå¹²æ‰°è¿™äº›å¼ºå…±æ€§çš„åŒºåˆ†ã€‚

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦AOPäº†ã€‚AOPé¦–å…ˆåœ¨ä¸€ä¸ªAspectï¼ˆåˆ‡é¢ï¼‰é‡Œå®šä¹‰äº†ä¸€äº›Adviceï¼ˆå¢å¼ºï¼‰ï¼Œå…¶ä¸­åŒ…å«å…·ä½“å®ç°çš„ä»£ç ï¼ŒåŒæ—¶æ•´ç†äº†åˆ‡å…¥ç‚¹ï¼Œåˆ‡å…¥ç‚¹çš„ç²’åº¦æ˜¯æ–¹æ³•ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›Adviceç»‡å…¥åˆ°å¯¹è±¡çš„æ–¹æ³•ä¸Šï¼Œå½¢æˆäº†æœ€åæ‰§è¡Œæ–¹æ³•æ—¶é¢å¯¹çš„å®Œæ•´æ–¹æ³•ã€‚

![img](https://cdn.xiaolincoding.com//picgo/1716791217083-132fe2ba-706a-4d8d-aef3-1617a2046585.png)

------

### åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ

Javaçš„åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡çš„æœºåˆ¶ï¼Œä¸»è¦ç”¨äºåœ¨ä¸ä¿®æ”¹åŸå§‹ç±»çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹¦æˆªå’Œå¢å¼ºã€‚

JavaåŠ¨æ€ä»£ç†ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š

- **åŸºäºæ¥å£çš„ä»£ç†**ï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰ï¼š è¿™ç§ç±»å‹çš„ä»£ç†è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£ã€‚JavaåŠ¨æ€ä»£ç†ä¼šåˆ›å»ºä¸€ä¸ªå®ç°äº†ç›¸åŒæ¥å£çš„ä»£ç†ç±»ï¼Œç„¶ååœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆè¯¥ç±»çš„å®ä¾‹ã€‚è¿™ç§ä»£ç†çš„å®ç°æ ¸å¿ƒæ˜¯`java.lang.reflect.Proxy`ç±»å’Œ`java.lang.reflect.InvocationHandler`æ¥å£ã€‚æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»å®ç°`InvocationHandler`æ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®ä¾‹éƒ½å…³è”åˆ°ä¸€ä¸ª`handler`ã€‚å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¼šè¢«è½¬å‘ä¸ºç”±`InvocationHandler`æ¥å£çš„`invoke()`æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚
- **åŸºäºç±»çš„ä»£ç†**ï¼ˆCGLIBåŠ¨æ€ä»£ç†ï¼‰ï¼š CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜æ€§èƒ½çš„ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç›®æ ‡ç±»çš„å­ç±»ã€‚CGLIBä»£ç†ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼åˆ›å»ºä»£ç†ç±»ã€‚å› æ­¤ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨CGLIBæ¥åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚==**Byte Buddy**é€æ¸å–ä»£==

------

### åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«

ä»£ç†æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç›®çš„æ˜¯ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå°†ä¸¤ä¸ªç±»çš„å…³ç³»è§£è€¦ã€‚ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½è¦å®ç°ç›¸åŒçš„æ¥å£ï¼Œå› ä¸ºä»£ç†çœŸæ­£è°ƒç”¨çš„æ˜¯å§”æ‰˜ç±»çš„æ–¹æ³•ã€‚

åŒºåˆ«ï¼š

- é™æ€ä»£ç†ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–è€…æ˜¯ç”±ç‰¹å®šå·¥å…·åˆ›å»ºï¼Œåœ¨ä»£ç ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è¢«ä»£ç†çš„ç±»æ˜¯ä¸€ä¸ªé™æ€ä»£ç†ã€‚é™æ€ä»£ç†é€šå¸¸åªä»£ç†ä¸€ä¸ªç±»ï¼›

  ```java
  // é™æ€ä»£ç†ç±»
  public class UserServiceProxy implements UserService {
      private UserService target; // æŒæœ‰ç›®æ ‡å¯¹è±¡
  
      public UserServiceProxy(UserService target) {
          this.target = target;
      }
  
      @Override
      public void addUser(String name) {
          System.out.println("[ä»£ç†] å‰ç½®å¢å¼º: å¼€å§‹æ·»åŠ ç”¨æˆ·");
          target.addUser(name); // è°ƒç”¨ç›®æ ‡æ–¹æ³•
          System.out.println("[ä»£ç†] åç½®å¢å¼º: æ·»åŠ å®Œæˆ");
      }
  
      @Override
      public void deleteUser(int id) {
          System.out.println("[ä»£ç†] å‰ç½®å¢å¼º: å¼€å§‹åˆ é™¤ç”¨æˆ·");
          target.deleteUser(id);
          System.out.println("[ä»£ç†] åç½®å¢å¼º: åˆ é™¤å®Œæˆ");
      }
  }
  ```

  ```java
  public class Main {
      public static void main(String[] args) {
          // åˆ›å»ºç›®æ ‡å¯¹è±¡
          UserService target = new UserServiceImpl();
          
          // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ‰‹åŠ¨åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼‰
          UserService proxy = new UserServiceProxy(target);
          
          // é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³•
          proxy.addUser("Alice");
          proxy.deleteUser(123);
      }
  }
  ```

- åŠ¨æ€ä»£ç†ï¼šåœ¨ä»£ç è¿è¡ŒæœŸé—´ï¼Œè¿ç”¨åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºç”Ÿæˆã€‚åŠ¨æ€ä»£ç†ä»£ç†çš„æ˜¯ä¸€ä¸ªæ¥å£ä¸‹çš„å¤šä¸ªå®ç°ç±»ã€‚

------

### èƒ½ä½¿ç”¨é™æ€ä»£ç†çš„æ–¹å¼å®ç°AOPå—ï¼Ÿ

å½“ç„¶**å¯ä»¥**ç”¨é™æ€ä»£ç†å®ç° AOP çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ¯”å¦‚ä½ åœ¨ä»£ç é‡Œæ‰‹åŠ¨å†™ä¸ªä»£ç†ç±»ï¼Œåœ¨ç›®æ ‡æ–¹æ³•å‰ååŠ æ—¥å¿—æˆ–è€…äº‹åŠ¡æ§åˆ¶ï¼ŒæŠ€æœ¯ä¸Šå®Œå…¨å¯è¡Œã€‚ä½†é—®é¢˜æ˜¯ï¼Œé™æ€ä»£ç†åœ¨å®é™…ç”Ÿäº§ä¸­åŸºæœ¬æ²¡äººç”¨ï¼Œå› ä¸ºå®ƒæœ‰ä¸‰å¤§ç¡¬ä¼¤ï¼š

- **ç¬¬ä¸€æ˜¯ä»£ç çˆ†ç‚¸**ã€‚æ¯”å¦‚ä½ æœ‰ 100 ä¸ª Service ç±»éœ€è¦åŠ äº‹åŠ¡ï¼Œå°±å¾—å†™ 100 ä¸ªå¯¹åº”çš„é™æ€ä»£ç†ç±»ï¼Œé‡Œé¢å…¨æ˜¯é‡å¤çš„ `try-catch` æäº¤å›æ»šä»£ç ï¼Œç»´æŠ¤èµ·æ¥ç®€ç›´æ˜¯ç¾éš¾ã€‚
- **ç¬¬äºŒæ˜¯åƒµåŒ–**ã€‚ä¸€æ—¦ä¸šåŠ¡æ¥å£æ”¹äº†ä¸ªæ–¹æ³•åï¼Œæ‰€æœ‰ç›¸å…³çš„ä»£ç†ç±»éƒ½å¾—è·Ÿç€æ”¹ï¼Œè€ŒåŠ¨æ€ä»£ç†é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œæ ¹æœ¬ä¸æ€•è¿™ç§å˜åŠ¨ã€‚
- **ç¬¬ä¸‰æ˜¯æ— æ³•åŠ¨æ€ç­›é€‰**ã€‚æ¯”å¦‚ä½ æƒ³åªç»™å¸¦ `@Transactional` æ³¨è§£çš„æ–¹æ³•åŠ äº‹åŠ¡ï¼Œé™æ€ä»£ç†åªèƒ½å†™æ­»é€»è¾‘ï¼Œè€Œ Spring AOP å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åˆ‡ç‚¹è¡¨è¾¾å¼ç²¾å‡†åŒ¹é…éœ€è¦å¢å¼ºçš„æ–¹æ³•ã€‚

æ‰€ä»¥ Spring æ‰é€‰äº† JDK åŠ¨æ€ä»£ç†å’Œ CGLIBï¼šå®ƒä»¬èƒ½åœ¨**è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»**ï¼Œä¸€ä¸ªåˆ‡é¢é…ç½®å°±èƒ½è¦†ç›–æˆç™¾ä¸Šåƒä¸ªæ–¹æ³•ã€‚åƒäº‹åŠ¡ç®¡ç†è¿™ç§å…¨å±€éœ€æ±‚ï¼Œç”¨é™æ€ä»£ç†æ‰‹åŠ¨ç»‘å®šæ ¹æœ¬ä¸å¯è¡Œã€‚

------

### AOPå®ç°æœ‰å“ªäº›æ³¨è§£ï¼Ÿ

å¸¸ç”¨çš„æ³¨è§£åŒ…æ‹¬ï¼š

- @Aspectï¼šç”¨äºå®šä¹‰åˆ‡é¢ï¼Œæ ‡æ³¨åœ¨åˆ‡é¢ç±»ä¸Šã€‚
- @Pointcutï¼šå®šä¹‰åˆ‡ç‚¹ï¼Œæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œç”¨äºæŒ‡å®šè¿æ¥ç‚¹ã€‚
- @Beforeï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œé€šçŸ¥ã€‚
- @Afterï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œé€šçŸ¥ã€‚
- @Aroundï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åéƒ½æ‰§è¡Œé€šçŸ¥ã€‚
- @AfterReturningï¼šåœ¨æ–¹æ³•æ‰§è¡Œåè¿”å›ç»“æœåæ‰§è¡Œé€šçŸ¥ã€‚
- @AfterThrowingï¼šåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œé€šçŸ¥ã€‚
- @Adviceï¼šé€šç”¨çš„é€šçŸ¥ç±»å‹ï¼Œå¯ä»¥æ›¿ä»£@Beforeã€@Afterç­‰ã€‚

------

### ä»€ä¹ˆæ˜¯åå°„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ

åå°„æœºåˆ¶æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡ŒçŠ¶æ€ä¸‹ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿ==è·å–è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•==ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„==ä»»æ„å±æ€§å’Œæ–¹æ³•==ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava åå°„å…è®¸åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯å¹¶åŠ¨æ€æ“ä½œå¯¹è±¡ï¼Œå³ä½¿åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»ä¹Ÿèƒ½å®ç°ã€‚

åå°„å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. **è¿è¡Œæ—¶ç±»ä¿¡æ¯è®¿é—®**ï¼šåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è·å–ç±»çš„å®Œæ•´ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå­—æ®µç­‰ã€‚
2. **åŠ¨æ€å¯¹è±¡åˆ›å»º**ï¼šå¯ä»¥ä½¿ç”¨åå°„APIåŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œå³ä½¿åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»åã€‚è¿™æ˜¯é€šè¿‡Classç±»çš„newInstance()æ–¹æ³•æˆ–Constructorå¯¹è±¡çš„newInstance()æ–¹æ³•å®ç°çš„ã€‚
3. **åŠ¨æ€æ–¹æ³•è°ƒç”¨**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰æ–¹æ³•ã€‚è¿™é€šè¿‡Methodç±»çš„invoke()æ–¹æ³•å®ç°ï¼Œå…è®¸ä½ ä¼ å…¥å¯¹è±¡å®ä¾‹å’Œå‚æ•°å€¼æ¥æ‰§è¡Œæ–¹æ³•ã€‚
4. **è®¿é—®å’Œä¿®æ”¹å­—æ®µå€¼**ï¼šåå°„è¿˜å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼ï¼Œå³ä½¿æ˜¯ç§æœ‰çš„ã€‚è¿™æ˜¯é€šè¿‡Fieldç±»çš„get()å’Œset()æ–¹æ³•å®Œæˆçš„ã€‚

![img](https://cdn.xiaolincoding.com//picgo/1718957173277-863d2ec6-a754-423b-9066-9f28610d1a31-20240725232406027.png)

Javaåå°„æœºåˆ¶åœ¨springæ¡†æ¶ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†åå°„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹Springçš„IoCå’ŒAOPæ˜¯å¦‚ä½•ä½¿ç”¨åå°„æŠ€æœ¯çš„ã€‚

> 1ã€Springæ¡†æ¶çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œæ§åˆ¶åè½¬ï¼ˆIoCï¼‰

==Spring ä½¿ç”¨åå°„æ¥å®ç°å…¶æ ¸å¿ƒç‰¹æ€§ï¼šä¾èµ–æ³¨å…¥ã€‚==

åœ¨Springä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡XMLé…ç½®æ–‡ä»¶æˆ–è€…åŸºäºæ³¨è§£çš„æ–¹å¼å£°æ˜ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpringå®¹å™¨ä¼šæ‰«æè¿™äº›é…ç½®æˆ–æ³¨è§£ï¼Œç„¶ååˆ©ç”¨åå°„æ¥å®ä¾‹åŒ–Beanï¼ˆå³Javaå¯¹è±¡ï¼‰ï¼Œå¹¶æ ¹æ®é…ç½®è‡ªåŠ¨è£…é…å®ƒä»¬çš„ä¾èµ–ã€‚

ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªServiceç±»éœ€è¦ä¾èµ–å¦ä¸€ä¸ªDAOç±»æ—¶ï¼Œå¼€å‘è€…å¯ä»¥åœ¨Serviceç±»ä¸­ä½¿ç”¨@Autowiredæ³¨è§£ï¼Œè€Œæ— éœ€è‡ªå·±ç¼–å†™åˆ›å»ºDAOå®ä¾‹çš„ä»£ç ã€‚Springå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶è§£æè¿™ä¸ªæ³¨è§£ï¼Œé€šè¿‡åå°„æ‰¾åˆ°å¯¹åº”çš„DAOç±»ï¼Œå®ä¾‹åŒ–å®ƒï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°Serviceç±»ä¸­ã€‚è¿™æ ·ä¸ä»…é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä¹Ÿæå¤§åœ°å¢å¼ºäº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

> 2ã€åŠ¨æ€ä»£ç†çš„å®ç°

åœ¨éœ€è¦å¯¹ç°æœ‰ç±»çš„æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹¦æˆªã€è®°å½•æ—¥å¿—ã€æƒé™æ§åˆ¶æˆ–æ˜¯äº‹åŠ¡ç®¡ç†ç­‰åœºæ™¯ä¸­ï¼Œåå°„ç»“åˆåŠ¨æ€ä»£ç†æŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨ã€‚

ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„å®ç°ã€‚Spring AOPå…è®¸å¼€å‘è€…å®šä¹‰åˆ‡é¢ï¼ˆAspectï¼‰ï¼Œè¿™äº›åˆ‡é¢å¯ä»¥æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ï¼‰ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚

ä¾‹å¦‚ï¼Œä¸ºäº†ç»™æ‰€æœ‰çš„æœåŠ¡å±‚æ–¹æ³•æ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨è¿™ä¸ªåˆ‡é¢ä¸­ï¼ŒSpringä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†æˆ–CGLIBï¼ˆå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼‰æ¥åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚==è¿™ä¸ªä»£ç†å¯¹è±¡åœ¨è°ƒç”¨ä»»ä½•æ–¹æ³•å‰æˆ–åï¼Œéƒ½ä¼šæ‰§è¡Œåˆ‡é¢ä¸­å®šä¹‰çš„ä»£ç é€»è¾‘ï¼ˆå¦‚è®°å½•æ—¥å¿—ï¼‰==ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æ¥åŠ¨æ€æ„å»ºå’Œæ‰§è¡Œçš„ï¼Œæ— éœ€ç¡¬ç¼–ç åˆ°æ¯ä¸ªæ–¹æ³•è°ƒç”¨ä¸­ã€‚

è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†åå°„æœºåˆ¶å¦‚ä½•åœ¨å®é™…å·¥ç¨‹ä¸­ä¿ƒè¿›**æ¾è€¦åˆã€é«˜å†…èš**çš„è®¾è®¡ï¼Œä»¥åŠå¦‚ä½•æä¾›åŠ¨æ€ã€çµæ´»çš„ç¼–ç¨‹èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡†æ¶å±‚é¢å’Œè§£å†³è·¨åˆ‡é¢é—®é¢˜æ—¶ã€‚

------

### Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ï¼Ÿ

å¾ªç¯ä¾èµ–æŒ‡çš„æ˜¯ä¸¤ä¸ªç±»ä¸­çš„å±æ€§ç›¸äº’ä¾èµ–å¯¹æ–¹ï¼šä¾‹å¦‚ A ç±»ä¸­æœ‰ B å±æ€§ï¼ŒB ç±»ä¸­æœ‰ Aå±æ€§ï¼Œä»è€Œå½¢æˆäº†ä¸€ä¸ªä¾èµ–é—­ç¯ï¼Œå¦‚ä¸‹å›¾ã€‚

![img](https://cdn.xiaolincoding.com//picgo/1720684589425-d06727ba-bf03-484a-b656-c225554b5b49.png)

å¾ªç¯ä¾èµ–é—®é¢˜åœ¨Springä¸­ä¸»è¦æœ‰ä¸‰ç§æƒ…å†µï¼š

- ç¬¬ä¸€ç§ï¼šé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚
- ç¬¬äºŒç§ï¼šé€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å¤šä¾‹ï¼ˆåŸå‹ï¼‰æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚
- ç¬¬ä¸‰ç§ï¼šé€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å•ä¾‹æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

åªæœ‰ã€ç¬¬ä¸‰ç§æ–¹å¼ã€‘çš„å¾ªç¯ä¾èµ–é—®é¢˜è¢« Spring è§£å†³äº†ï¼Œå…¶ä»–ä¸¤ç§æ–¹å¼åœ¨é‡åˆ°å¾ªç¯ä¾èµ–é—®é¢˜æ—¶ï¼ŒSpringéƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚

Spring åœ¨ `DefaultSingletonBeanRegistry` ç±»ä¸­ç»´æŠ¤äº†ä¸‰ä¸ªé‡è¦çš„ç¼“å­˜ (Map)ï¼Œç§°ä¸ºâ€œä¸‰çº§ç¼“å­˜â€ï¼š

- `singletonObjects` (ä¸€çº§ç¼“å­˜)ï¼š==å­˜æ”¾çš„æ˜¯å®Œå…¨åˆå§‹åŒ–å¥½çš„ã€å¯ç”¨çš„ Bean å®ä¾‹==ï¼Œ`getBean()` æ–¹æ³•æœ€ç»ˆè¿”å›çš„å°±æ˜¯è¿™é‡Œé¢çš„ Beanã€‚æ­¤æ—¶ Bean å·²å®ä¾‹åŒ–ã€å±æ€§å·²å¡«å……ã€åˆå§‹åŒ–æ–¹æ³•å·²æ‰§è¡Œã€==AOP ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰ä¹Ÿå·²ç”Ÿæˆã€‚==
- `earlySingletonObjects` (äºŒçº§ç¼“å­˜)ï¼šå­˜æ”¾çš„æ˜¯æå‰==æš´éœ²çš„ Bean çš„åŸå§‹å¯¹è±¡å¼•ç”¨ æˆ– æ—©æœŸä»£ç†å¯¹è±¡å¼•ç”¨==ï¼Œ==ä¸“é—¨ç”¨æ¥å¤„ç†å¾ªç¯ä¾èµ–==ã€‚==å½“ä¸€ä¸ª Bean è¿˜åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼ˆå°šæœªå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–ï¼‰==ï¼Œä½†å®ƒçš„å¼•ç”¨éœ€è¦è¢«æ³¨å…¥åˆ°å¦ä¸€ä¸ª Bean æ—¶ï¼Œå°±æš‚æ—¶æ”¾åœ¨è¿™é‡Œã€‚æ­¤æ—¶ Bean å·²å®ä¾‹åŒ–ï¼ˆè°ƒç”¨äº†æ„é€ å‡½æ•°ï¼‰ï¼Œä½†å±æ€§å°šæœªå¡«å……ï¼Œåˆå§‹åŒ–æ–¹æ³•å°šæœªæ‰§è¡Œï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªä¸ºäº†è§£å†³ AOP ä»£ç†é—®é¢˜è€Œæå‰ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ã€‚
- `singletonFactories` (ä¸‰çº§ç¼“å­˜)ï¼šå­˜æ”¾çš„æ˜¯ Bean çš„ `ObjectFactory` å·¥å‚å¯¹è±¡ã€‚ï¼Œè¿™æ˜¯==è§£å†³å¾ªç¯ä¾èµ–å’Œ AOP ä»£ç†ååŒå·¥ä½œçš„å…³é”®==ã€‚==å½“ Bean è¢«å®ä¾‹åŒ–åï¼ˆåˆšè°ƒå®Œæ„é€ å‡½æ•°ï¼‰ï¼ŒSpring ä¼šåˆ›å»ºä¸€ä¸ª `ObjectFactory` å¹¶å°†å…¶æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚==è¿™ä¸ªå·¥å‚çš„ `getObject()` æ–¹æ³•è´Ÿè´£è¿”å›è¯¥ Bean çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯æå‰ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼‰ï¼Œå½“æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–éœ€è¦æ³¨å…¥ä¸€ä¸ªå°šæœªå®Œå…¨åˆå§‹åŒ–çš„ Bean æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå·¥å‚æ¥è·å–==æ—©æœŸå¼•ç”¨==ã€‚

| **ç¼“å­˜çº§åˆ«** | **åç§°**                | **å­˜å‚¨å†…å®¹**                                   | **ç›®çš„**                              |
| :----------- | :---------------------- | :--------------------------------------------- | :------------------------------------ |
| **ä¸€çº§ç¼“å­˜** | `singletonObjects`      | å®Œå…¨åˆå§‹åŒ–åçš„å•ä¾‹ Bean                        | æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„æœ€ç»ˆæˆå“              |
| **äºŒçº§ç¼“å­˜** | `earlySingletonObjects` | æå‰æš´éœ²çš„â€œåŠæˆå“â€Beanï¼ˆå·²å®ä¾‹åŒ–ä½†æœªæ³¨å…¥ä¾èµ–ï¼‰ | è§£å†³å¾ªç¯ä¾èµ–æ—¶ä¸´æ—¶å­˜æ”¾                |
| **ä¸‰çº§ç¼“å­˜** | `singletonFactories`    | Bean çš„å·¥å‚å¯¹è±¡ï¼ˆ`ObjectFactory`ï¼‰             | ç”¨äºç”Ÿæˆæ—©æœŸå¼•ç”¨ï¼ˆè§£å†³ AOP ä»£ç†é—®é¢˜ï¼‰ |

Spring é€šè¿‡ ä¸‰çº§ç¼“å­˜ å’Œ æå‰æš´éœ²æœªå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡å¼•ç”¨ çš„æœºåˆ¶æ¥è§£å†³å•ä¾‹ä½œç”¨åŸŸ Bean çš„ setteæ³¨å…¥æ–¹å¼çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

å‡è®¾å­˜åœ¨ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„å•ä¾‹Beanï¼š`BeanA` ä¾èµ– `BeanB`ï¼ŒåŒæ—¶ `BeanB` ä¹Ÿä¾èµ– `BeanA`ã€‚å½“Springå®¹å™¨å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§ä»¥ä¸‹æµç¨‹å¤„ç†ï¼š

- ç¬¬ä¸€æ­¥ï¼šåˆ›å»º`BeanA`çš„å®ä¾‹å¹¶æå‰æš´éœ²å·¥å‚ã€‚

Springé¦–å…ˆè°ƒç”¨`BeanA`çš„æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ­¤æ—¶å¾—åˆ°ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼ˆå°šæœªå¡«å……å±æ€§ï¼‰ã€‚ç´§æ¥ç€ï¼ŒSpringä¼šå°†ä¸€ä¸ªç‰¹æ®Šçš„`ObjectFactory`å·¥å‚å¯¹è±¡å­˜å…¥ç¬¬ä¸‰çº§ç¼“å­˜ï¼ˆ`singletonFactories`ï¼‰ã€‚è¿™ä¸ªå·¥å‚çš„ä½¿å‘½æ˜¯ï¼šå½“å…¶ä»–Beanéœ€è¦å¼•ç”¨`BeanA`æ—¶ï¼Œå®ƒèƒ½åŠ¨æ€è¿”å›å½“å‰è¿™ä¸ªåŠæˆå“çš„`BeanA`ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸ºåº”å¯¹AOPè€Œæå‰ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼‰ã€‚æ­¤æ—¶`BeanA`çš„çŠ¶æ€æ˜¯"å·²å®ä¾‹åŒ–ä½†æœªåˆå§‹åŒ–"ï¼Œåƒä¸€åº§åˆšæ­å¥½é’¢ç­‹éª¨æ¶çš„å¤§æ¥¼ã€‚

- ç¬¬äºŒæ­¥ï¼šå¡«å……`BeanA`çš„å±æ€§æ—¶è§¦å‘`BeanB`çš„åˆ›å»ºã€‚

Springå¼€å§‹ä¸º`BeanA`æ³¨å…¥å±æ€§ï¼Œå‘ç°å®ƒä¾èµ–`BeanB`ã€‚äºæ˜¯å®¹å™¨è½¬å‘åˆ›å»º`BeanB`ï¼ŒåŒæ ·å…ˆè°ƒç”¨å…¶æ„é€ å‡½æ•°å®ä¾‹åŒ–ï¼Œå¹¶å°†`BeanB`å¯¹åº”çš„`ObjectFactory`å·¥å‚å­˜å…¥ä¸‰çº§ç¼“å­˜ã€‚è‡³æ­¤ï¼Œä¸‰çº§ç¼“å­˜ä¸­åŒæ—¶å­˜åœ¨`BeanA`å’Œ`BeanB`çš„å·¥å‚ï¼Œå®ƒä»¬éƒ½ä»£è¡¨æœªå®Œæˆåˆå§‹åŒ–çš„åŠæˆå“ã€‚

- ç¬¬ä¸‰æ­¥ï¼š`BeanB`å±æ€§æ³¨å…¥æ—¶å‘ç°å¾ªç¯ä¾èµ–ã€‚

å½“Springè¯•å›¾å¡«å……`BeanB`çš„å±æ€§æ—¶ï¼Œæ£€æµ‹åˆ°å®ƒéœ€è¦æ³¨å…¥`BeanA`ã€‚æ­¤æ—¶å®¹å™¨å¯åŠ¨ä¾èµ–æŸ¥æ‰¾ï¼š

1. åœ¨ä¸€çº§ç¼“å­˜ï¼ˆå­˜æ”¾å®Œæ•´Beanï¼‰ä¸­æœªæ‰¾åˆ°`BeanA`ï¼›
2. åœ¨äºŒçº§ç¼“å­˜ï¼ˆå­˜æ”¾å·²æš´éœ²çš„æ—©æœŸå¼•ç”¨ï¼‰ä¸­åŒæ ·æœªå‘½ä¸­ï¼›
3. æœ€ç»ˆåœ¨ä¸‰çº§ç¼“å­˜ä¸­å®šä½åˆ°`BeanA`çš„å·¥å‚ã€‚

Springç«‹å³è°ƒç”¨è¯¥å·¥å‚çš„`getObject()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œå…³é”®å†³ç­–ï¼šè‹¥`BeanA`éœ€è¦AOPä»£ç†ï¼Œåˆ™åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆå³ä½¿`BeanA`è¿˜æœªåˆå§‹åŒ–ï¼‰ï¼›è‹¥æ— éœ€ä»£ç†ï¼Œåˆ™ç›´æ¥è¿”å›åŸå§‹å¯¹è±¡ã€‚å¾—åˆ°çš„è¿™ä¸ªæ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯ä»£ç†ï¼‰è¢«æ”¾å…¥äºŒçº§ç¼“å­˜ï¼ˆ`earlySingletonObjects`ï¼‰ï¼ŒåŒæ—¶ä»ä¸‰çº§ç¼“å­˜æ¸…ç†å·¥å‚æ¡ç›®ã€‚æœ€åï¼ŒSpringå°†è¿™ä¸ªæ—©æœŸå¼•ç”¨æ³¨å…¥åˆ°`BeanB`çš„å±æ€§ä¸­ã€‚è‡³æ­¤ï¼Œ`BeanB`æˆåŠŸæŒæœ‰`BeanA`çš„å¼•ç”¨â€”â€”å°½ç®¡`BeanA`æ­¤æ—¶ä»æ˜¯ä¸ªåŠæˆå“ã€‚

- ç¬¬å››æ­¥ï¼šå®Œæˆ`BeanB`çš„ç”Ÿå‘½å‘¨æœŸã€‚

`BeanB`è·å¾—æ‰€æœ‰ä¾èµ–åï¼ŒSpringæ‰§è¡Œå…¶åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚`@PostConstruct`ï¼‰ï¼Œå°†å…¶è½¬åŒ–ä¸ºå®Œæ•´å¯ç”¨çš„Beanã€‚éšåï¼Œ`BeanB`è¢«æå‡è‡³ä¸€çº§ç¼“å­˜ï¼ˆ`singletonObjects`ï¼‰ï¼ŒäºŒçº§å’Œä¸‰çº§ç¼“å­˜ä¸­å…³äº`BeanB`çš„ä¸´æ—¶æ¡ç›®å‡è¢«æ¸…é™¤ã€‚æ­¤æ—¶`BeanB`å·²å‡†å¤‡å°±ç»ªï¼Œå¯è¢«å…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚

- ç¬¬äº”æ­¥ï¼šå›æº¯å®Œæˆ`BeanA`çš„æ„å»ºã€‚

éšç€`BeanB`åˆ›å»ºå®Œæ¯•ï¼Œæµç¨‹å›æº¯åˆ°æœ€åˆä¸­æ–­çš„`BeanA`å±æ€§æ³¨å…¥ç¯èŠ‚ã€‚Springå°†å·²å®Œå¤‡çš„`BeanB`å®ä¾‹æ³¨å…¥`BeanA`ï¼Œæ¥ç€æ‰§è¡Œ`BeanA`çš„åˆå§‹åŒ–æ–¹æ³•ã€‚è¿™é‡Œæœ‰ä¸ªç²¾å¦™ç»†èŠ‚ï¼šè‹¥ä¹‹å‰ä¸º`BeanA`ç”Ÿæˆè¿‡æ—©æœŸä»£ç†ï¼ŒSpringä¼šç›´æ¥å¤ç”¨äºŒçº§ç¼“å­˜ä¸­çš„ä»£ç†å¯¹è±¡ä½œä¸ºæœ€ç»ˆBeanï¼Œè€Œéé‡å¤åˆ›å»ºã€‚æœ€ç»ˆï¼Œå®Œå…¨åˆå§‹åŒ–çš„`BeanA`ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡æˆ–ä»£ç†ï¼‰å…¥é©»ä¸€çº§ç¼“å­˜ï¼Œå…¶æ—©æœŸå¼•ç”¨ä»äºŒçº§ç¼“å­˜ç§»é™¤ã€‚è‡³æ­¤å¾ªç¯é—­ç¯å®Œæˆï¼Œä¸¤ä¸ªBeançš†å¯ç”¨ã€‚

ä¸‰çº§ç¼“å­˜çš„è®¾è®¡çš„ç²¾é«“ï¼š

- **ä¸‰çº§ç¼“å­˜å·¥å‚**ï¼ˆ`singletonFactories`ï¼‰è´Ÿè´£åœ¨å®ä¾‹åŒ–åç«‹åˆ»æš´éœ²å¯¹è±¡ç”Ÿæˆèƒ½åŠ›ï¼Œå…¼é¡¾AOPä»£ç†çš„æå‰ç”Ÿæˆï¼›
- **äºŒçº§ç¼“å­˜**ï¼ˆ`earlySingletonObjects`ï¼‰ä¸´æ—¶å­˜å‚¨å·²ç¡®å®šçš„æ—©æœŸå¼•ç”¨ï¼Œé¿å…é‡å¤ç”Ÿæˆä»£ç†ï¼› ==(ä¿è¯å•ä¾‹)==
- **ä¸€çº§ç¼“å­˜**ï¼ˆ`singletonObjects`ï¼‰æœ€ç»ˆäº¤ä»˜å®Œæ•´Beanã€‚

æ•´ä¸ªæœºåˆ¶é€šè¿‡**ä¸­æ–­åˆå§‹åŒ–æµç¨‹ã€é€†å‘æ³¨å…¥åŠæˆå“ã€å»¶è¿Ÿä»£ç†ç”Ÿæˆ**ä¸‰å¤§ç­–ç•¥ï¼Œå°†å¾ªç¯ä¾èµ–çš„æ­»ç»“è½¬åŒ–ä¸ºæœ‰åºçš„æ¥åŠ›åä½œã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ–¹æ¡ˆä»…é€‚ç”¨äºSetter/Fieldæ³¨å…¥çš„**å•ä¾‹Bean**ï¼›æ„é€ å™¨æ³¨å…¥å› å¿…é¡»åœ¨å®ä¾‹åŒ–å‰è·å¾—ä¾èµ–ï¼Œä»ä¼šå¯¼è‡´æ— è§£çš„æ­»é”ã€‚

```
åˆ›å»º A â†’ ä¸‰çº§ç¼“å­˜ï¼ˆAå·¥å‚ï¼‰
   â†“
æ³¨å…¥ B â†’ åˆ›å»º B â†’ ä¸‰çº§ç¼“å­˜ï¼ˆBå·¥å‚ï¼‰
   â†“
æ³¨å…¥ A â†’ ä»ä¸‰çº§ç¼“å­˜æ‹¿åˆ° A çš„æ—©æœŸå¼•ç”¨ â†’ å‡çº§åˆ°äºŒçº§ç¼“å­˜
   â†“
å®Œæˆ B â†’ ç§»å…¥ä¸€çº§ç¼“å­˜
   â†“
å®Œæˆ A â†’ ç§»å…¥ä¸€çº§ç¼“å­˜
```

==**äºŒçº§ç¼“å­˜å‡çº§æ—¶æœº**ï¼šå½“å…¶ä»– Beanï¼ˆå¦‚ `B`ï¼‰éœ€è¦æ³¨å…¥å½“å‰ Beanï¼ˆå¦‚ `A`ï¼‰æ—¶ï¼Œ`A`çš„æ—©æœŸå¼•ç”¨ä¼šä»ä¸‰çº§ç¼“å­˜å‡çº§åˆ°äºŒçº§ç¼“å­˜ã€‚==

------

### Springä¸ºä»€ä¹ˆç”¨3çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿç”¨2çº§ç¼“å­˜ä¸è¡Œå—ï¼Ÿ

Spring å¿…é¡»ç”¨ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œæ ¸å¿ƒæ˜¯ä¸ºäº†**æ­£ç¡®å¤„ç†éœ€è¦ AOP ä»£ç†çš„ Bean**ã€‚å¦‚æœåªç”¨äºŒçº§ç¼“å­˜ï¼Œä¼šå¯¼è‡´æ³¨å…¥çš„å¯¹è±¡å½¢æ€é”™è¯¯ï¼Œç”šè‡³ç ´åå•ä¾‹åŸåˆ™ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ Bean A ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œä¸” A éœ€è¦è¢«åŠ¨æ€ä»£ç†ï¼ˆæ¯”å¦‚åŠ äº† `@Transactional`ï¼‰ã€‚==å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜ï¼Œå½“ B åˆ›å»ºæ—¶å»æ³¨å…¥ Aï¼Œæ‹¿åˆ°çš„æ˜¯ A çš„åŸå§‹å¯¹è±¡ã€‚ä½† A åœ¨åç»­åˆå§‹åŒ–å®Œæˆåæ‰ä¼šç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç»“æœå°±æ˜¯ï¼šB æ‹¿ç€åŸå§‹å¯¹è±¡ Aï¼Œè€Œ Spring å®¹å™¨é‡Œå­˜çš„æ˜¯ä»£ç†å¯¹è±¡ A== â€”â€” åŒä¸€ä¸ª Bean å‡ºç°äº†ä¸¤ä¸ªä¸åŒå®ä¾‹ï¼Œè¿™ç›´æ¥è¿åäº†å•ä¾‹çš„æ ¸å¿ƒçº¦æŸã€‚

ä¸‰çº§ç¼“å­˜ä¸­çš„ `ObjectFactory` å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®ã€‚å®ƒä¸æ˜¯ç›´æ¥ç¼“å­˜å¯¹è±¡ï¼Œè€Œæ˜¯å­˜äº†ä¸€ä¸ªèƒ½ç”Ÿäº§å¯¹è±¡çš„å·¥å‚ã€‚å½“å‘ç”Ÿå¾ªç¯ä¾èµ–æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå·¥å‚çš„ `getObject()` æ–¹æ³•ï¼Œ==è¿™æ—¶ Spring ä¼šæ™ºèƒ½åˆ¤æ–­ï¼šå¦‚æœè¿™ä¸ª Bean æœ€ç»ˆéœ€è¦ä»£ç†ï¼Œå°±æå‰ç”Ÿæˆä»£ç†å¯¹è±¡å¹¶æ”¾å…¥äºŒçº§ç¼“å­˜ï¼›==å¦‚æœä¸éœ€è¦ä»£ç†ï¼Œå°±è¿”å›åŸå§‹å¯¹è±¡ã€‚è¿™æ ·ä¸€æ¥ï¼ŒB æ³¨å…¥çš„ A å°±æ˜¯æœ€ç»ˆå½¢æ€ï¼ˆå¯èƒ½æ˜¯ä»£ç†å¯¹è±¡ï¼‰ï¼Œåç»­ A åˆå§‹åŒ–å®Œæˆåä¹Ÿä¸ä¼šå†åˆ›å»ºæ–°ä»£ç†ï¼Œä¿è¯äº†å¯¹è±¡å…¨å±€å”¯ä¸€ã€‚

ç®€å•è¯´ï¼Œä¸‰çº§ç¼“å­˜çš„æœ¬è´¨æ˜¯ **â€œæŒ‰éœ€å»¶è¿Ÿç”Ÿæˆæ­£ç¡®å¼•ç”¨â€** ã€‚å®ƒæ—¢ç»´æŒäº† Bean ç”Ÿå‘½å‘¨æœŸçš„å®Œæ•´æ€§ï¼ˆæ­£å¸¸æµç¨‹åœ¨åˆå§‹åŒ–åç”Ÿæˆä»£ç†ï¼‰ï¼Œåˆåœ¨å¾ªç¯ä¾èµ–æ—¶ç‰¹æ®Šå¤„ç†ï¼Œé¿å…é€»è¾‘çŸ›ç›¾ã€‚è€ŒäºŒçº§ç¼“å­˜ç¼ºä¹è¿™ç§åŠ¨æ€å†³ç­–èƒ½åŠ›ï¼Œå› æ­¤æ— æ³•æ›¿ä»£ä¸‰çº§ç¼“å­˜ã€‚

------

### springä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ

éƒ½æ˜¯ Mapç±»å‹çš„ç¼“å­˜ï¼Œæ¯”å¦‚Map {k:name; v:bean}ã€‚

1. **ä¸€çº§ç¼“å­˜ï¼ˆSingleton Objectsï¼‰**ï¼šè¿™æ˜¯ä¸€ä¸ªMapç±»å‹çš„ç¼“å­˜ï¼Œ==å­˜å‚¨çš„æ˜¯å·²ç»å®Œå…¨åˆå§‹åŒ–å¥½çš„bean==ï¼Œå³å®Œå…¨å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨çš„beanå®ä¾‹ã€‚==é”®æ˜¯beançš„åç§°ï¼Œå€¼æ˜¯beançš„å®ä¾‹==ã€‚è¿™ä¸ªç¼“å­˜åœ¨`DefaultSingletonBeanRegistry`ç±»ä¸­çš„`singletonObjects`å±æ€§ä¸­ã€‚
2. **äºŒçº§ç¼“å­˜ï¼ˆEarly Singleton Objectsï¼‰**ï¼šè¿™åŒæ ·æ˜¯ä¸€ä¸ªMapç±»å‹çš„ç¼“å­˜ï¼Œå­˜å‚¨çš„æ˜¯æ—©æœŸçš„beanå¼•ç”¨ï¼Œå³==å·²ç»å®ä¾‹åŒ–ä½†è¿˜æœªå®Œå…¨åˆå§‹åŒ–çš„bean==ã€‚è¿™äº›beanå·²ç»è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯å¯èƒ½è¿˜æ²¡æœ‰è¿›è¡Œå±æ€§æ³¨å…¥ç­‰æ“ä½œã€‚è¿™ä¸ªç¼“å­˜åœ¨`DefaultSingletonBeanRegistry`ç±»ä¸­çš„`earlySingletonObjects`å±æ€§ä¸­ã€‚
3. **ä¸‰çº§ç¼“å­˜ï¼ˆSingleton Factoriesï¼‰**ï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªMapç±»å‹çš„ç¼“å­˜ï¼Œå­˜å‚¨çš„æ˜¯==ObjectFactory==å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡==å¯ä»¥ç”Ÿæˆæ—©æœŸçš„beanå¼•ç”¨==ã€‚å½“ä¸€ä¸ªbeanæ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®ƒè¢«å…¶ä»–beanä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ­£åœ¨åˆ›å»ºçš„beanå°±ä¼šé€šè¿‡è¿™ä¸ªObjectFactoryæ¥åˆ›å»ºä¸€ä¸ªæ—©æœŸå¼•ç”¨ï¼Œä»è€Œè§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚è¿™ä¸ªç¼“å­˜åœ¨`DefaultSingletonBeanRegistry`ç±»ä¸­çš„`singletonFactories`å±æ€§ä¸­ã€‚





**åˆ†ä¸ºæœ‰aop æ— aop åˆ›å»ºä»£ç†æ—¶æœºåˆ†ç±» äºŒçº§ç¼“å­˜ï¼šå¤šä¸ªå¾ªç¯ä¾èµ–å‘ç”Ÿæ—¶**

**ä¸ºä»€ä¹ˆä¸èƒ½ä¸€å¼€å§‹å°±æ£€æŸ¥ä»£ç†ï¼Ÿ å¦‚æœæ‰€æœ‰ Bean åœ¨å®ä¾‹åŒ–æ—¶éƒ½æ£€æŸ¥æ˜¯å¦éœ€è¦ä»£ç†ï¼Ÿ**

â€‹	**æ­£å¸¸æƒ…å†µ**ï¼šA åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰è¢« `AbstractAutoProxyCreator` åˆ¤æ–­æ˜¯å¦è¦ä»£ç†ã€‚

â€‹	**å¾ªç¯ä¾èµ–æƒ…å†µ**ï¼šå½“ B éœ€è¦ A æ—¶ï¼Œä¼šä»ä¸‰çº§ç¼“å­˜è§¦å‘ `getEarlyBeanReference()`ï¼Œæ­¤æ—¶å°±ä¼šè°ƒç”¨ `AbstractAutoProxyCreator` æå‰åˆ¤æ–­å¹¶ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚	

- AOP ä»£ç†æ˜¯é€šè¿‡ `AbstractAutoProxyCreator` è¿™æ ·çš„ **BeanPostProcessor** æ¥å†³å®šçš„ã€‚
- `BeanPostProcessor` çš„è°ƒç”¨æ—¶æœºæ˜¯åœ¨ **Bean å®ä¾‹åŒ–ä¹‹åã€åˆå§‹åŒ–ä¹‹å‰**ã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring åœ¨æœ€æ—© `doCreateBean` é˜¶æ®µè¿˜æ²¡æ³•çŸ¥é“ã€Œè¿™ä¸ª Bean éœ€ä¸éœ€è¦ä»£ç†ã€ã€‚

ğŸ‘‰ å¦‚æœä½ åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°±ç”Ÿæˆä»£ç†ï¼Œä¼šè·³è¿‡ `BeanPostProcessor` çš„é€»è¾‘ï¼Œå¯¼è‡´å¾ˆå¤š AOP/äº‹åŠ¡/å¢å¼ºåŠŸèƒ½å…¨éƒ½å¤±æ•ˆã€‚

**å¦‚æœæ”¹ä¸ºåœ¨ åˆ›å»º Bean æ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦ä»£ç†**

çœ‹ä¼¼å¯ä»¥å‡å°‘ä¸€æ¬¡ç¼“å­˜ç©¿é€ï¼Œä½†ä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜ï¼š

1. **ä¾èµ–æ³¨å…¥æ—¶æœºé”™ä¹±**
   - å¦‚æœåœ¨å®ä¾‹åŒ–åç«‹åˆ»ä»£ç†ï¼Œæ³¨å…¥å±æ€§æ—¶å¯èƒ½æ‰“åˆ°ä»£ç†å¯¹è±¡èº«ä¸Šã€‚
   - ä»£ç†å¯¹è±¡é‡Œä¸€èˆ¬æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼ˆæ¯”å¦‚ JDK åŠ¨æ€ä»£ç†çš„ `InvocationHandler`ï¼ŒCGLIB çš„ `target` å­—æ®µï¼‰ï¼Œæ­¤æ—¶ç›®æ ‡å¯¹è±¡å¯èƒ½è¿˜æ²¡æ³¨å…¥å®Œä¾èµ–ï¼Œè°ƒç”¨æ–¹æ³•å°±ä¼š NPE æˆ–å‡ºé”™ã€‚
2. **BeanPostProcessor çš„æ—¶æœºå¤±æ•ˆ**
   - å¾ˆå¤š BPP éœ€è¦åœ¨å±æ€§æ³¨å…¥åæ‰èƒ½å†³å®šæ˜¯å¦å¢å¼ºï¼ˆä¾‹å¦‚äº‹åŠ¡å¢å¼ºå™¨è¦çœ‹ `@Transactional` æ˜¯å¦ç”Ÿæ•ˆï¼‰ã€‚
   - å¦‚æœåœ¨å®ä¾‹åŒ–é˜¶æ®µå°±ä»£ç†ï¼Œåç½®å¤„ç†å™¨è¿˜æ²¡è·‘åˆ°å°±å¤±æ•ˆäº†ã€‚
3. **å¾ªç¯ä¾èµ–æ›´éº»çƒ¦**
   - åœ¨ä¸‰çº§ç¼“å­˜é‡Œï¼ŒSpring æ”¾çš„æ˜¯â€œæ—©æœŸæš´éœ²å¯¹è±¡â€ï¼Œå®ƒå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½åŒ…äº†ä¸€å±‚ä»£ç†å·¥å‚ã€‚
   - å¦‚æœä½ åœ¨ä¸€å¼€å§‹å°±ç”Ÿæˆä»£ç†ï¼Œé‚£ä¹ˆå½“ A å’Œ B å¾ªç¯ä¾èµ–æ—¶ï¼ŒB æ³¨å…¥çš„å¯èƒ½æ˜¯ä¸€ä¸ªâ€œè¿˜æ²¡å‡†å¤‡å¥½çš„ä»£ç†å¯¹è±¡â€ï¼Œè€Œä¸æ˜¯ Spring æƒ³è¦çš„åŠæˆå“åŸå§‹å¯¹è±¡ï¼Œè¿™å¯èƒ½å¯¼è‡´æå‰è°ƒç”¨ä»£ç†é€»è¾‘å‡ºé”™ã€‚

> è¦å›ç­”æ¸…æ¥šï¼Œå¾—åˆ†ä¸¤ä¸ªå±‚æ¬¡ï¼š
>
> ------
>
> ### 1. Spring ç›®å‰çš„è®¾è®¡ï¼ˆä¸ºä»€ä¹ˆæ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µæ£€æŸ¥æ˜¯å¦éœ€è¦ä»£ç†ï¼‰
>
> Spring çš„ä»£ç†åˆ›å»ºæ˜¯ç”± **`BeanPostProcessor`** å®Œæˆçš„ï¼Œç‰¹åˆ«æ˜¯ `AbstractAutoProxyCreator`ã€‚
>
> - **æ—¶æœº**ï¼š`BeanPostProcessor#postProcessAfterInitialization` â†’ åœ¨ **Bean å®ä¾‹åŒ– + å±æ€§æ³¨å…¥å®Œæˆ** ä¹‹åã€‚
> - **åŸå› **ï¼š
>   1. ä»£ç†é€»è¾‘ä¾èµ–äº **å®Œæ•´çš„ Bean ä¿¡æ¯**ï¼ˆå¦‚ AOP åˆ‡ç‚¹åŒ¹é…ã€äº‹åŠ¡æ³¨è§£ã€@Async ç­‰ï¼‰ï¼Œè¿™äº›å…ƒæ•°æ®æœ‰æ—¶éœ€è¦ä¾èµ–äº **æ³¨å…¥å®Œæˆçš„ä¸Šä¸‹æ–‡**ã€‚
>   2. å¦‚æœè¿‡æ—©åˆ›å»ºä»£ç†ï¼ˆæ¯”å¦‚åœ¨å®ä¾‹åŒ–æ—¶ï¼‰ï¼Œå¯èƒ½ç¼ºå°‘å…³é”®ä¿¡æ¯ï¼Œå¯¼è‡´åŒ¹é…ä¸å‡†ç¡®ã€‚
>
> æ‰€ä»¥ Spring é»˜è®¤åªèƒ½åœ¨åˆå§‹åŒ–é˜¶æ®µå†³å®šæ˜¯å¦åŒ…è£…æˆä»£ç†ã€‚
>  è¿™å°±å¯¼è‡´ï¼š
>
> - å®ä¾‹åŒ–å‡ºæ¥çš„â€œåŠæˆå“â€ Bean åªèƒ½å…ˆæ”¾åˆ° **ä¸‰çº§ç¼“å­˜ï¼ˆObjectFactoryï¼‰**ï¼Œä»¥ä¾¿å¾ªç¯ä¾èµ–æ—¶è¿”å›ã€‚
> - çœŸæ­£çš„ä»£ç†æ›¿æ¢è¦ç­‰åˆ° `postProcessAfterInitialization` æ‰èƒ½å‘ç”Ÿã€‚
>
> ------
>
> ### 2. ä½ æåˆ°çš„æ”¹é€ æ€è·¯ï¼ˆåœ¨åˆ›å»º Bean é˜¶æ®µå°±æ£€æŸ¥ä»£ç†éœ€æ±‚ï¼‰
>
> ç†è®ºä¸Š **æ˜¯å¯è¡Œçš„**ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªå‰æå’Œé—®é¢˜ï¼š
>
> âœ… **å¥½å¤„**ï¼š
>
> - åªéœ€è¦äºŒçº§ç¼“å­˜ï¼ˆä¸ç”¨ ObjectFactory å»¶è¿Ÿä»£ç†ï¼‰ï¼Œå¾ªç¯ä¾èµ–æ—¶å°±èƒ½ç›´æ¥è¿”å›ä»£ç†å¯¹è±¡ã€‚
> - å¯ä»¥å‡å°‘ä¸€å±‚ç¼“å­˜å¸¦æ¥çš„å¤æ‚åº¦ã€‚
>
> âŒ **é—®é¢˜**ï¼š
>
> 1. **å…ƒä¿¡æ¯æ˜¯å¦è¶³å¤Ÿ**
>
>    - å¦‚æœä»£ç†é€»è¾‘åªä¾èµ–äº Bean çš„ **ç±»ä¿¡æ¯ï¼ˆClassï¼‰å’Œ BeanDefinition**ï¼Œé‚£ä¹ˆç¡®å®å¯ä»¥åœ¨å®ä¾‹åŒ–é˜¶æ®µå°±å†³å®šæ˜¯å¦è¦ä»£ç†ã€‚
>    - ä½†æ˜¯å¦‚æœä»£ç†é€»è¾‘ä¾èµ–äº **æ³¨è§£å±æ€§ã€BeanFactory ç¯å¢ƒç”šè‡³ä¾èµ–æ³¨å…¥çš„ç»“æœ**ï¼Œé‚£å®ä¾‹åŒ–å‰ä¸ä¸€å®šèƒ½è·å–å…¨ã€‚
>
>    ğŸ‘‰ ä¸¾ä¸ªä¾‹å­ï¼š
>
>    - `@Transactional` â†’ äº‹åŠ¡ä»£ç†å…¶å®åªéœ€è¦æ–¹æ³•å’Œæ³¨è§£ä¿¡æ¯ï¼Œç†è®ºä¸Šå¯ä»¥æå‰å†³å®šã€‚
>    - `@Async` â†’ ä¹Ÿåªéœ€è¦æ–¹æ³•çº§åˆ«å…ƒæ•°æ®ï¼Œå¯ä»¥æå‰ã€‚
>    - ä½†æ˜¯ä¸€äº›è‡ªå®šä¹‰ `BeanPostProcessor` å¯èƒ½éœ€è¦ Bean åˆå§‹åŒ–åçš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦ä»£ç†ï¼Œé‚£å°±æ²¡æ³•æå‰ã€‚
>
> 2. **å’Œ Spring çš„æ‰©å±•æœºåˆ¶è€¦åˆ**
>     Spring çš„ `BeanPostProcessor` æ˜¯æ’ä»¶åŒ–çš„ï¼Œä½ æ²¡åŠæ³•åœ¨å®ä¾‹åŒ–é˜¶æ®µå°±æå‰çŸ¥é“æ‰€æœ‰åç½®å¤„ç†å™¨çš„é€»è¾‘ï¼ˆé™¤éç¡¬æ”¹ Spring é€»è¾‘ï¼‰ã€‚
>
> 3. **ç”Ÿæ€å…¼å®¹æ€§**
>     ç»å¤§å¤šæ•° Spring ç”Ÿæ€ä¾èµ– `postProcessAfterInitialization` çš„ AOP æ‰©å±•ç‚¹ï¼Œå¦‚æœä½ æ”¹æˆå®ä¾‹åŒ–é˜¶æ®µï¼Œå¾ˆå¤šä¸‰æ–¹åº“å¯èƒ½è¡Œä¸ºå¼‚å¸¸ã€‚
>
> ------
>
> ### 3. ç»“è®º
>
> - **å¦‚æœåªè€ƒè™‘è‡ªå·±é¡¹ç›®çš„ä»£ç†é€»è¾‘**ï¼ˆä¾‹å¦‚åªåŸºäºæ³¨è§£ `@Transactional` / `@Async`ï¼‰ï¼Œå®Œå…¨å¯ä»¥åœ¨ **å®ä¾‹åŒ–é˜¶æ®µ**å°±å†³å®šæ˜¯å¦ä»£ç† â†’ è¿™æ ·å°±èƒ½çœå»ä¸‰çº§ç¼“å­˜ï¼Œç›´æ¥äºŒçº§ç¼“å­˜ä»£ç†å¯¹è±¡ã€‚
> - **ä½†åœ¨ Spring æ¡†æ¶çš„é€šç”¨æœºåˆ¶é‡Œ**ï¼Œç”±äºè¦æ”¯æŒå„ç§ `BeanPostProcessor` å’Œç”Ÿæ€å…¼å®¹ï¼Œæ‰€ä»¥å¿…é¡»ä¿ç•™ä¸‰çº§ç¼“å­˜æœºåˆ¶ã€‚

å…³é”®ç‚¹åœ¨äºï¼š

- **æå‰ä»£ç†åªåœ¨å¾ªç¯ä¾èµ–æ—¶æ‰ä¼šè§¦å‘**ï¼Œå±äºä¸€ç§ã€Œå¦¥åã€æœºåˆ¶ã€‚

- è¿™ç§æƒ…å†µä¸‹ï¼ŒSpring çš„å‡è®¾æ˜¯ï¼š

  > â€œè™½ç„¶ä»£ç†å¯èƒ½ä¸å®Œæ•´ï¼Œä½†æ¯”èµ·æŠ›å‡ºå¼‚å¸¸ï¼ˆæ— æ³•è§£å†³å¾ªç¯ä¾èµ–ï¼‰ï¼Œè¿˜æ˜¯å…ˆç»™ä½ ä¸€ä¸ªä»£ç†å¯¹è±¡é¡¶ç€ç”¨ã€‚â€

ä¹Ÿå°±æ˜¯è¯´ï¼Œ**æ­£å¸¸è·¯å¾„å¿…é¡»ä¿è¯ä»£ç†é€»è¾‘æ˜¯å®Œæ•´çš„ï¼ˆafterInitialization é˜¶æ®µï¼‰**ï¼Œä½†å¾ªç¯ä¾èµ–æ˜¯ä¸ªä¾‹å¤–ã€‚



> ### 4. å¦‚æœæ”¹æˆä½ æè®®çš„ã€Œå®ä¾‹åŒ–é˜¶æ®µå°±ç»Ÿä¸€ä»£ç†ã€
>
> å¥½å¤„ï¼š
>
> - é€»è¾‘æ›´ç®€å•ï¼Œä¸ç”¨ä¸‰çº§ç¼“å­˜äº†ï¼Œç›´æ¥äºŒçº§ç¼“å­˜å­˜ä»£ç†å¯¹è±¡å°±è¡Œã€‚
>
> é£é™©ï¼š
>
> 1. æœ‰äº› `BeanPostProcessor` å¿…é¡»ä¾èµ– **åˆå§‹åŒ–åçš„çŠ¶æ€** æ‰èƒ½å†³å®šæ˜¯å¦ä»£ç†ï¼Œä½ æå‰ç”Ÿæˆå°±ä¼šä¸¢å¤±æ­£ç¡®æ€§ã€‚
> 2. æå‰ä»£ç†ä¼šè¦†ç›–æ‰â€œåˆå§‹åŒ–è¿‡ç¨‹ä¸­å¯èƒ½åŠ¨æ€æ”¹å˜ Bean è¡Œä¸ºâ€çš„åœºæ™¯ï¼ˆæ¯”å¦‚æŸäº›æ¡†æ¶ä¼šåœ¨ init æ–¹æ³•é‡ŒåŠ æ ‡è®°ï¼Œç„¶åæŸä¸ª PostProcessor æ ¹æ®æ ‡è®°å†³å®šæ˜¯å¦åšä»£ç†ï¼‰ã€‚
> 3. Spring ç”Ÿæ€ï¼ˆå¾ˆå¤šä¸‰æ–¹åº“ï¼‰å·²ç»é»˜è®¤ä»£ç†æ—¶æœºæ˜¯ **afterInitialization**ï¼Œä½ æå‰åšå¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜ã€‚
>
> ------
>
> ### 5. æ€»ç»“
>
> - **ç°åœ¨çš„è®¾è®¡**ï¼š
>   - é»˜è®¤åœ¨ **åˆå§‹åŒ–å®Œæˆå** å†å†³å®šæ˜¯å¦ä»£ç†ï¼ˆä¿è¯å‡†ç¡®æ€§ï¼‰ã€‚
>   - å¾ªç¯ä¾èµ–æ—¶ï¼Œå…è®¸â€œæå‰ä»£ç†â€ä½œä¸ºç‰¹ä¾‹ï¼ˆä¿è¯å¯ç”¨æ€§ï¼‰ã€‚
> - **ä½ çš„æ€è·¯**ï¼š
>   - å¦‚æœåœºæ™¯å•ä¸€ã€å¯æ§ï¼ˆæ¯”å¦‚åªä¾èµ–æ³¨è§£ä¿¡æ¯ï¼Œä¸ä¾èµ–åˆå§‹åŒ–çŠ¶æ€ï¼‰ï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–é˜¶æ®µå°±ä»£ç†ï¼Œä»è€Œç®€åŒ–ç¼“å­˜ç»“æ„ã€‚
>   - ä½†é€šç”¨æ¡†æ¶å±‚é¢ï¼Œå¿…é¡»ä¿ç•™ä¸‰çº§ç¼“å­˜ï¼Œå› ä¸ºæœ‰å¤ªå¤šæ‰©å±•ç‚¹éœ€è¦ **åˆå§‹åŒ–å®Œæˆåçš„ä¿¡æ¯**ã€‚

Spring æ€ä¹ˆç¼“å’Œ / è§£å†³ä»£ç†ä¸å®Œæ•´è¿™ä¸ªé—®é¢˜

> **ä¿ç•™ `postProcessAfterInitialization` æµç¨‹**
>
> - å³ä½¿æ—©æœŸè¿”å›äº†ä»£ç†ï¼ŒSpring ä»ç„¶ä¼šåœ¨è¯¥ Bean åç»­å®Œæˆåˆå§‹åŒ–æ—¶èµ° `postProcessAfterInitialization`ã€‚
> - ä½† `AbstractAutoProxyCreator` å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªæ ‡è®°ï¼ˆä¾‹å¦‚ `earlyProxyReferences`ï¼‰ï¼Œè®°å½•å“ªäº› Bean å·²ç»è¢«æå‰ä»£ç†è¿‡ã€‚`postProcessAfterInitialization` åœ¨çœ‹åˆ°è¯¥æ ‡è®°åé€šå¸¸**ä¸ä¼šå†åˆ›å»ºæ–°çš„ä»£ç†**ï¼Œä»¥é¿å…é‡å¤åŒ…è£…ï¼ˆåŒé‡ä»£ç†ï¼‰ã€‚

------

### Springçš„äº‹åŠ¡ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ

è™½ç„¶è§£å†³äº†å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œä½†å…¶å®æˆ‘ä»¬çš„æ”¹é€ å´åŸ‹ä¸‹äº†å¦ä¸€ä¸ªéšæ‚£ã€‚ä¸€èµ·æµ‹è¯•ä¸€ä¸‹ã€‚

æˆ‘ä»¬åœ¨é¢†åˆ¸ä¸šåŠ¡çš„æœ€åæ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š

![img](https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTA2MTA3NmNmNDYwOTFmM2MwZTNiZWQ5NTM0NDJiMmZfRndETDg5VW53S2xqVkFtcXN6M2FralhPUHdHakVXOVNfVG9rZW46QTRvWGJuQ2lVb2ZuMmd4bGFib2NsT3FubllmXzE3NTc1NTQyOTQ6MTc1NzU1Nzg5NF9WNA)

ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è™½ç„¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯åº“å­˜ã€ç”¨æˆ·åˆ¸éƒ½æ²¡æœ‰å›æ»šï¼äº‹åŠ¡å¤±æ•ˆäº†ï¼

#### 3.4.1.1.äº‹åŠ¡æ–¹æ³•épublicä¿®é¥°

ç”±äºSpringçš„äº‹åŠ¡æ˜¯åŸºäºAOPçš„æ–¹å¼ç»“åˆåŠ¨æ€ä»£ç†æ¥å®ç°çš„ã€‚å› æ­¤äº‹åŠ¡æ–¹æ³•ä¸€å®šè¦æ˜¯publicçš„ï¼Œè¿™æ ·æ‰èƒ½ä¾¿äºè¢«Springåšäº‹åŠ¡çš„ä»£ç†å’Œå¢å¼ºã€‚

è€Œä¸”ï¼Œåœ¨Springå†…éƒ¨ä¹Ÿä¼šæœ‰ä¸€ä¸ª `org.springframework.transaction.interceptor.AbstractFallbackTransactionAttributeSource`ç±»ï¼Œå»æ£€æŸ¥äº‹åŠ¡æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼š

```Java
@Nullable
 protected TransactionAttribute computeTransactionAttribute(
  Method method, @Nullable Class<?> targetClass) {
   // Don't allow non-public methods, as configured.
   if (allowPublicMethodsOnly() && 
  !Modifier.isPublic(method.getModifiers())) {
      return null;
   }

    // ... ç•¥

   return null;
 }
```

æ‰€ä»¥ï¼Œäº‹åŠ¡æ–¹æ³•ä¸€å®šè¦è¢«publicä¿®é¥°ï¼

#### 3.4.1.2.éäº‹åŠ¡æ–¹æ³•è°ƒç”¨äº‹åŠ¡æ–¹æ³•

æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```Java
@Service
public class OrderService {
    
    public void createOrder(){
        // ... å‡†å¤‡è®¢å•æ•°æ®
        
        // ç”Ÿæˆè®¢å•å¹¶æ‰£å‡åº“å­˜
        insertOrderAndReduceStock();
    }
    
    @Transactional
    public void insertOrderAndReduceStock(){
        // ç”Ÿæˆè®¢å•
        insertOrder();
        // æ‰£å‡åº“å­˜
        reduceStock();
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œ`insertOrderAndReduceStock`æ–¹æ³•æ˜¯ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œè‚¯å®šä¼šè¢«Springäº‹åŠ¡ç®¡ç†ã€‚Springä¼šç»™`OrderService`ç±»ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¯¹`insertOrderAndReduceStock`æ–¹æ³•åšå¢åŠ ï¼Œå®ç°äº‹åŠ¡æ•ˆæœã€‚

ä½†æ˜¯ç°åœ¨`createOrder`æ–¹æ³•æ˜¯ä¸€ä¸ªéäº‹åŠ¡æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº†`insertOrderAndReduceStock`æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨å…¶å®éšå«äº†ä¸€ä¸ª`this.`çš„å‰ç¼€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯ç›´æ¥è°ƒç”¨åŸå§‹çš„OrderServiceä¸­çš„æ™®é€šæ–¹æ³•ï¼Œè€Œéè¢«Springä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•ã€‚é‚£äº‹åŠ¡è‚¯å®šå°±å¤±æ•ˆäº†ï¼

#### 3.4.1.3.äº‹åŠ¡æ–¹æ³•çš„å¼‚å¸¸è¢«æ•è·äº†

ç¤ºä¾‹ï¼š

```Java
 @Service
 public class OrderService {

    @Transactional
    public void createOrder(){
        // ... å‡†å¤‡è®¢å•æ•°æ®
        // ç”Ÿæˆè®¢å•
        insertOrder();
        // æ‰£å‡åº“å­˜
        reduceStock();
    }

    private void reduceStock() {
        try {
            // ...æ‰£åº“å­˜
        } catch (Exception e) {
            // å¤„ç†å¼‚å¸¸
        }
    }

 }
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒreduceStockæ–¹æ³•å†…éƒ¨ç›´æ¥æ•è·äº†Exceptionç±»å‹çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å³ä¾¿å‡ºç°äº†å¼‚å¸¸ä¹Ÿä¸ä¼šå‘å¤–æŠ›å‡ºã€‚

è€ŒSpringçš„äº‹åŠ¡ç®¡ç†å°±æ˜¯è¦æ„ŸçŸ¥ä¸šåŠ¡æ–¹æ³•çš„å¼‚å¸¸ï¼Œå½“æ•è·åˆ°å¼‚å¸¸åæ‰ä¼šå›æ»šäº‹åŠ¡ã€‚

ç°åœ¨äº‹åŠ¡è¢«æ•è·ï¼Œå°±ä¼šå¯¼è‡´Springæ— æ³•æ„ŸçŸ¥äº‹åŠ¡å¼‚å¸¸ï¼Œè‡ªç„¶ä¸ä¼šå›æ»šï¼Œäº‹åŠ¡å°±å¤±æ•ˆäº†ã€‚

#### 3.4.1.4.äº‹åŠ¡å¼‚å¸¸ç±»å‹ä¸å¯¹

ç¤ºä¾‹ä»£ç ï¼š

```Java
@Service
 public class OrderService {

    @Transactional(rollbackFor = RuntimeException.class)
    public void createOrder() throws IOException {
        // ... å‡†å¤‡è®¢å•æ•°æ®
        
        // ç”Ÿæˆè®¢å•
        insertOrder();
        // æ‰£å‡åº“å­˜
        reduceStock();

        throw new IOException();
    }
 }
```

Springçš„äº‹åŠ¡ç®¡ç†é»˜è®¤æ„ŸçŸ¥çš„å¼‚å¸¸ç±»å‹æ˜¯`RuntimeException`ï¼Œå½“äº‹åŠ¡æ–¹æ³•å†…éƒ¨æŠ›å‡ºäº†ä¸€ä¸ª`IOException`æ—¶ï¼Œä¸ä¼šè¢«Springæ•è·ï¼Œå› æ­¤å°±ä¸ä¼šè§¦å‘äº‹åŠ¡å›æ»šï¼Œäº‹åŠ¡å°±å¤±æ•ˆäº†ã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ä¼šæŠ›å‡ºRuntimeExceptionä»¥å¤–çš„å¼‚å¸¸æ—¶ï¼Œåº”è¯¥é€šè¿‡`@Transactional`æ³¨è§£ä¸­çš„`rollbackFor`å±æ€§æ¥æŒ‡å®šå¼‚å¸¸ç±»å‹ï¼š

```Java
@Transactional(rollbackFor = Exception.class)
```

#### 3.4.1.5.äº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸å¯¹

ç¤ºä¾‹ä»£ç ï¼š

```Java
@Service
 public class OrderService {
    @Transactional
    public void createOrder(){
        // ç”Ÿæˆè®¢å•
        insertOrder();
        // æ‰£å‡åº“å­˜
        reduceStock();
        throw new RuntimeException("ä¸šåŠ¡å¼‚å¸¸");
    }
    @Transactional
    public void insertOrder() {
    }
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void reduceStock() {
    }
 }
```

åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œäº‹åŠ¡çš„å…¥å£æ˜¯`createOrder()`æ–¹æ³•ï¼Œä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥æˆä¸ºå¤–éƒ¨äº‹åŠ¡ã€‚åœ¨createOrder()æ–¹æ³•å†…éƒ¨åˆè°ƒç”¨äº†`insertOrder()`æ–¹æ³•å’Œ`reduceStock()`æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªéƒ½æ˜¯äº‹åŠ¡æ–¹æ³•ã€‚

ä¸è¿‡ï¼Œ`reduceStock()`æ–¹æ³•çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯`REQUIRES_NEW`ï¼Œè¿™ä¼šå¯¼è‡´åœ¨è¿›å…¥`reduceStock()`æ–¹æ³•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¯ä»¥æˆä¸ºå­äº‹åŠ¡ã€‚`insertOrder()`åˆ™æ˜¯é»˜è®¤ï¼Œå› æ­¤ä¼šä¸`createOrder()`åˆå¹¶äº‹åŠ¡ã€‚

å› æ­¤ï¼Œå½“`createOrder`æ–¹æ³•æœ€åæŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œåªä¼šå¯¼è‡´`insertOrder`æ–¹æ³•å›æ»šï¼Œè€Œä¸ä¼šå¯¼è‡´`reduceStock`æ–¹æ³•å›æ»šï¼Œå› ä¸º`reduceStock`æ˜¯ä¸€ä¸ªç‹¬ç«‹äº‹åŠ¡ã€‚

æ‰€ä»¥ï¼Œä¸€å®šè¦æ…ç”¨ä¼ æ’­è¡Œä¸ºï¼Œæ³¨æ„å¤–éƒ¨äº‹åŠ¡ä¸å†…éƒ¨äº‹åŠ¡ä¹‹é—´çš„å…³ç³»ã€‚

#### 3.4.1.6.æ²¡æœ‰è¢«Springç®¡ç†

ç¤ºä¾‹ä»£ç ï¼š

```Java
//  @Service
 public class OrderService {
    @Transactional
    public void createOrder(){
        // ç”Ÿæˆè®¢å•
        insertOrder();
        // æ‰£å‡åº“å­˜
        reduceStock();
        throw new RuntimeException("ä¸šåŠ¡å¼‚å¸¸");
    }
    @Transactional
    public void insertOrder() {
    }
    @Transactional
    public void reduceStock() {
    }
 }
```

è¿™ä¸ªç¤ºä¾‹å±äºæ¯”è¾ƒä½çº§çš„é”™è¯¯ï¼Œ`OrderService`ç±»æ²¡æœ‰æ·»åŠ `@Service`æ³¨è§£ï¼Œå› æ­¤å°±æ²¡æœ‰è¢«Springç®¡ç†ã€‚ä½ åœ¨æ–¹æ³•ä¸Šæ·»åŠ çš„`@Transactional`æ³¨è§£æ ¹æœ¬ä¸ä¼šæœ‰äººå¸®ä½ åŠ¨æ€ä»£ç†ï¼Œäº‹åŠ¡è‡ªç„¶å¤±æ•ˆã€‚

å½“ç„¶ï¼Œæœ‰åŒå­¦ä¼šè¯´ï¼Œæˆ‘ä¸ä¼šçŠ¯è¿™ä¹ˆä½çº§çš„é”™è¯¯ã€‚è¿™å¯ä¸ä¸€å®šï¼Œæœ‰çš„æ—¶å€™ä½ æ²¡æœ‰å¿˜äº†åŠ `@Service`æ³¨è§£ï¼Œä½†æ˜¯ä½ åœ¨è·å–æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯èƒ½å¹¶ä¸æ˜¯è·å–çš„Springç®¡ç†çš„å¯¹è±¡ï¼Œæœ‰å¯èƒ½æ˜¯å…¶å®ƒæ–¹å¼åˆ›å»ºçš„ã€‚è¿™åŒæ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚

------

### Beançš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€ä¸‹ï¼Ÿ

![img](https://cdn.xiaolincoding.com//picgo/1719570477922-ad595a67-be98-4272-9e13-8ad73dd75c13.png)

1. Springå¯åŠ¨ï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½éœ€è¦è¢«Springç®¡ç†çš„beanï¼Œè¿›è¡ŒBeançš„å®ä¾‹åŒ–
2. Beanå®ä¾‹åŒ–åå¯¹å°†Beançš„å¼•å…¥å’Œå€¼æ³¨å…¥åˆ°Beançš„å±æ€§ä¸­
3. å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£çš„è¯ï¼ŒSpringå°†Beançš„Idä¼ é€’ç»™setBeanName()æ–¹æ³•
4. å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£çš„è¯ï¼ŒSpringå°†è°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œå°† å®¹å™¨å®ä¾‹ä¼ å…¥
5. å¦‚æœBeanå®ç°äº†ApplicationContextAwareæ¥å£çš„è¯ï¼ŒSpringå°†è°ƒç”¨Beançš„setApplicationContext()æ–¹æ³•ï¼Œå°†beanæ‰€åœ¨åº”ç”¨ä¸Šä¸‹æ–‡å¼•ç”¨ä¼ å…¥è¿›æ¥ã€‚
6. å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£ï¼ŒSpringå°±å°†è°ƒç”¨ä»–ä»¬çš„postProcessBeforeInitialization()æ–¹æ³•ã€‚
7. å¦‚æœBean å®ç°äº†InitializingBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨ä»–ä»¬çš„afterPropertiesSet()æ–¹æ³•ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœbeanä½¿ç”¨init-methodå£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨
8. å¦‚æœBean å®ç°äº†BeanPostProcessoræ¥å£ï¼ŒSpringå°±å°†è°ƒç”¨ä»–ä»¬çš„postProcessAfterInitialization()æ–¹æ³•ã€‚
9. æ­¤æ—¶ï¼ŒBeanå·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†ã€‚ä»–ä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚
10. å¦‚æœbeanå®ç°äº†DisposableBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨å®ƒçš„destory()æ¥å£æ–¹æ³•ï¼ŒåŒæ ·ï¼Œå¦‚æœbeanä½¿ç”¨äº†destory-method å£°æ˜é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚

```
å®¹å™¨å¯åŠ¨
   â†“
è¯»å–é…ç½®ç±» / XML
   â†“
æ³¨å†Œ BeanDefinitionï¼ˆåªæ˜¯æè¿°ä¿¡æ¯ï¼‰
   â†“
ã€BeanFactoryPostProcessorã€‘ç”Ÿæ•ˆï¼ˆå¯ä»¥ä¿®æ”¹ BeanDefinitionï¼‰
   â†“
å®ä¾‹åŒ– Beanï¼ˆnewï¼‰
   â†“
ä¾èµ–æ³¨å…¥ï¼ˆ@Autowired ç­‰ï¼‰
   â†“
ã€BeanPostProcessor.beforeInitializationã€‘ï¼ˆBean åˆå§‹åŒ–å‰ï¼‰
   â†“
è°ƒç”¨ @PostConstruct / init-method
   â†“
ã€BeanPostProcessor.afterInitializationã€‘ï¼ˆBean åˆå§‹åŒ–åï¼‰
   â†“
Bean å¯ç”¨
```



------

### Beanæ˜¯å¦å•ä¾‹ï¼Ÿ

Spring ä¸­çš„ Bean ==é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„==ã€‚

å°±æ˜¯è¯´ï¼Œæ¯ä¸ªBeançš„å®ä¾‹åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼šè¢«å­˜å‚¨åœ¨Springå®¹å™¨çš„ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿åœ¨åç»­çš„è¯·æ±‚ä¸­é‡å¤ä½¿ç”¨ã€‚è¿™ç§å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚

ä½†æ˜¯ï¼ŒSpringä¹Ÿæ”¯æŒå°†Beanè®¾ç½®ä¸ºå¤šä¾‹æ¨¡å¼ï¼Œå³æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚è¦å°†Beanè®¾ç½®ä¸ºå¤šä¾‹æ¨¡å¼ï¼Œ==å¯ä»¥åœ¨Beanå®šä¹‰ä¸­é€šè¿‡è®¾ç½®scopeå±æ€§ä¸º"prototype"æ¥å®ç°ã€‚==

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶Springçš„é»˜è®¤è¡Œä¸ºæ˜¯å°†Beanè®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼Œä½†åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¤šä¾‹æ¨¡å¼æ˜¯æ›´ä¸ºåˆé€‚çš„ï¼Œä¾‹å¦‚åœ¨åˆ›å»ºçŠ¶æ€ä¸å¯å˜çš„Beanæˆ–æœ‰çŠ¶æ€Beanæ—¶ã€‚æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœBeanå•ä¾‹æ˜¯æœ‰çŠ¶æ€çš„ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ—¶éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚

------

### Beançš„å•ä¾‹å’Œéå•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸€æ ·

ä¸ä¸€æ ·çš„ï¼ŒSpring Bean çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨ç”± IoC å®¹å™¨æ§åˆ¶ã€‚==Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ==ï¼Œå¯¹äº `prototype` çš„ Beanï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹åï¼Œåˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚

å…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š

| **é˜¶æ®µ**       | **å•ä¾‹ï¼ˆSingletonï¼‰**                                       | **éå•ä¾‹ï¼ˆå¦‚Prototypeï¼‰**                                    |
| :------------- | :---------------------------------------------------------- | :----------------------------------------------------------- |
| **åˆ›å»ºæ—¶æœº**   | å®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼ˆæˆ–é¦–æ¬¡è¯·æ±‚æ—¶ï¼Œå–å†³äºé…ç½®ï¼‰ã€‚                | æ¯æ¬¡è¯·æ±‚æ—¶åˆ›å»ºæ–°å®ä¾‹ã€‚                                       |
| **åˆå§‹åŒ–æµç¨‹** | å®Œæ•´æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼ˆå±æ€§æ³¨å…¥ã€Awareæ¥å£ã€åˆå§‹åŒ–æ–¹æ³•ç­‰ï¼‰ã€‚ | æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹æ—¶éƒ½ä¼šå®Œæ•´æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼ˆä»…åˆ°åˆå§‹åŒ–å®Œæˆï¼‰ã€‚ |
| **é”€æ¯æ—¶æœº**   | å®¹å™¨å…³é—­æ—¶é”€æ¯ï¼Œè§¦å‘`DisposableBean`æˆ–`destroy-method`ã€‚    | **å®¹å™¨ä¸ç®¡ç†é”€æ¯**ï¼Œéœ€ç”±è°ƒç”¨è€…è‡ªè¡Œé‡Šæ”¾èµ„æºï¼ˆSpringä¸è·Ÿè¸ªå®ä¾‹ï¼‰ã€‚ |
| **å†…å­˜å ç”¨**   | å•å®ä¾‹å¸¸é©»å†…å­˜ï¼Œé«˜æ•ˆä½†éœ€æ³¨æ„çº¿ç¨‹å®‰å…¨ã€‚                      | æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°å®ä¾‹ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†èµ„æºé‡Šæ”¾ã€‚       |
| **é€‚ç”¨åœºæ™¯**   | æ— çŠ¶æ€æœåŠ¡ï¼ˆå¦‚Serviceã€DAOå±‚ï¼‰ã€‚                            | æœ‰çŠ¶æ€å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·ä¼šè¯ã€ä¸´æ—¶è®¡ç®—å¯¹è±¡ï¼‰ã€‚                     |

==å•ä¾‹ç”Ÿå‘½å‘¨æœŸè·ŸéšIOCå³ä½¿æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ä¹Ÿä¸ä¼šè¢«gcå¤„ç†ï¼Œéå•ä¾‹Beanå¯ä»¥è¢«gcå¤„ç†ï¼Œä½†è¦æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•é‡Šæ”¾èµ„æº==

------

### Spring beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ

Springæ¡†æ¶ä¸­çš„Beanä½œç”¨åŸŸï¼ˆScopeï¼‰å®šä¹‰äº†Beançš„ç”Ÿå‘½å‘¨æœŸå’Œå¯è§æ€§ã€‚ä¸åŒçš„ä½œç”¨åŸŸå½±å“ç€Springå®¹å™¨å¦‚ä½•ç®¡ç†è¿™äº›Beançš„å®ä¾‹ï¼ŒåŒ…æ‹¬å®ƒä»¬å¦‚ä½•è¢«åˆ›å»ºã€å¦‚ä½•è¢«é”€æ¯ä»¥åŠå®ƒä»¬æ˜¯å¦å¯ä»¥è¢«å¤šä¸ªç”¨æˆ·å…±äº«ã€‚

Springæ”¯æŒå‡ ç§ä¸åŒçš„ä½œç”¨åŸŸï¼Œä»¥æ»¡è¶³ä¸åŒçš„åº”ç”¨åœºæ™¯éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦çš„Beanä½œç”¨åŸŸï¼š

- **Singletonï¼ˆå•ä¾‹ï¼‰**ï¼šåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ã€‚é»˜è®¤ä½œç”¨åŸŸï¼ŒSpring å®¹å™¨ä¸­åªä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ï¼Œå¹¶åœ¨å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å…±äº«è¯¥å®ä¾‹ã€‚
- **Prototypeï¼ˆåŸå‹ï¼‰**ï¼šæ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚æ¬¡ä»å®¹å™¨ä¸­è·å–è¯¥ Bean æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œé€‚ç”¨äºçŠ¶æ€éå¸¸ç¬æ—¶çš„ Beanã€‚
- **Requestï¼ˆè¯·æ±‚ï¼‰**ï¼šæ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚ä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œæ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œé€‚ç”¨äº Web åº”ç”¨ä¸­éœ€æ±‚å±€éƒ¨æ€§çš„ Beanã€‚
- **Sessionï¼ˆä¼šè¯ï¼‰**ï¼šSession èŒƒå›´å†…åªä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚è¯¥ Bean å®ä¾‹åœ¨ç”¨æˆ·ä¼šè¯èŒƒå›´å†…å…±äº«ï¼Œä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œé€‚ç”¨äºä¸ç”¨æˆ·ä¼šè¯ç›¸å…³çš„ Beanã€‚
- **Application**ï¼šå½“å‰ ServletContext ä¸­åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ã€‚ä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œè¯¥ Bean å®ä¾‹åœ¨æ•´ä¸ª ServletContext èŒƒå›´å†…å…±äº«ï¼Œé€‚ç”¨äºåº”ç”¨ç¨‹åºèŒƒå›´å†…å…±äº«çš„ Beanã€‚
- **WebSocketï¼ˆWebå¥—æ¥å­—ï¼‰**ï¼šåœ¨ WebSocket èŒƒå›´å†…åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ã€‚ä»…åœ¨æ”¯æŒ WebSocket çš„åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œè¯¥ Bean å®ä¾‹åœ¨ WebSocket ä¼šè¯èŒƒå›´å†…å…±äº«ï¼Œé€‚ç”¨äº WebSocket ä¼šè¯èŒƒå›´å†…å…±äº«çš„ Beanã€‚
- **Custom scopesï¼ˆè‡ªå®šä¹‰ä½œç”¨åŸŸï¼‰**ï¼šSpring å…è®¸å¼€å‘è€…å®šä¹‰è‡ªå®šä¹‰çš„ä½œç”¨åŸŸï¼Œé€šè¿‡å®ç° Scope æ¥å£æ¥åˆ›å»ºæ–°çš„ Bean ä½œç”¨åŸŸã€‚

åœ¨Springé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡`<bean>`æ ‡ç­¾çš„scopeå±æ€§æ¥æŒ‡å®šBeançš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š

```xml
<bean id="myBean" class="com.example.MyBeanClass" scope="singleton"/>
```

åœ¨Spring Bootæˆ–åŸºäºJavaçš„é…ç½®ä¸­ï¼Œå¯ä»¥é€šè¿‡@Scopeæ³¨è§£æ¥æŒ‡å®šBeançš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š

```java
@Bean  
@Scope("prototype")  
public MyBeanClass myBean() {  
    return new MyBeanClass();  
}
```

> ------
>
> ## 1. **Sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰**
>
> - **ç‰¹å¾**ï¼šåŒä¸€ä¸ªç”¨æˆ·ä¼šè¯ï¼ˆSessionï¼‰é‡Œå…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒç”¨æˆ·ä¹‹é—´äº’ä¸å½±å“ã€‚
> - **åº”ç”¨åœºæ™¯**ï¼šç”¨æˆ·ç›¸å…³çš„ä¸´æ—¶æ•°æ®ï¼Œä¾‹å¦‚è´­ç‰©è½¦ã€ç”¨æˆ·åå¥½ã€è¡¨å•å‘å¯¼ã€‚
>
> ### ç¤ºä¾‹ï¼šè´­ç‰©è½¦
>
> ```java
> @Component
> @Scope(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)
> public class ShoppingCart {
>     private final List<String> items = new ArrayList<>();
>     public void addItem(String item) { items.add(item); }
>     public List<String> getItems() { return items; }
> }
> ```
>
> - ç”¨æˆ· A çš„è´­ç‰©è½¦é‡Œæ˜¯ `["Apple", "Banana"]`
> - ç”¨æˆ· B çš„è´­ç‰©è½¦é‡Œæ˜¯ `[]`
> - **è¯´æ˜ï¼šæ¯ä¸ª Session ä¸€ä¸ªç‹¬ç«‹ Bean å®ä¾‹**
>
> ------
>
> ## 2. **Applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰**
>
> - **ç‰¹å¾**ï¼šæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ª Bean å®ä¾‹ï¼Œå­˜æ´»äº `ServletContext` èŒƒå›´ï¼Œæ‰€æœ‰è¯·æ±‚å…±äº«ã€‚
> - **åº”ç”¨åœºæ™¯**ï¼šå…¨å±€é…ç½®ã€ç¼“å­˜ã€ç»Ÿè®¡ä¿¡æ¯ã€‚
>
> ### ç¤ºä¾‹ï¼šè®¿é—®ç»Ÿè®¡å™¨
>
> ```java
> @Component
> @Scope(value = WebApplicationContext.SCOPE_APPLICATION, proxyMode = ScopedProxyMode.TARGET_CLASS)
> public class AppStatistics {
>     private final AtomicInteger counter = new AtomicInteger();
>     public int increment() { return counter.incrementAndGet(); }
> }
> ```
>
> - æ‰€æœ‰ç”¨æˆ·çš„è¯·æ±‚éƒ½ä¼šå…±äº«åŒä¸€ä¸ª `AppStatistics` Beanã€‚
> - æ¯”å¦‚ï¼š
>   - ç”¨æˆ· A è®¿é—® â†’ è®¡æ•°å™¨=1
>   - ç”¨æˆ· B è®¿é—® â†’ è®¡æ•°å™¨=2
>   - ç”¨æˆ· C è®¿é—® â†’ è®¡æ•°å™¨=3
>
> ------
>
> ## 3. **WebSocketï¼ˆWebSocket ä½œç”¨åŸŸï¼‰**
>
> - **ç‰¹å¾**ï¼šåœ¨æ¯ä¸ª WebSocket è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…åˆ›å»ºä¸€ä¸ª Beanï¼Œæ¯æ¡è¿æ¥ç‹¬ç«‹ã€‚
> - **åº”ç”¨åœºæ™¯**ï¼šå®æ—¶é€šä¿¡ä¼šè¯æ•°æ®ï¼Œæ¯”å¦‚èŠå¤©å®¤é‡Œæ¯ä¸ªç”¨æˆ·çš„ä¸Šä¸‹æ–‡ã€‚
>
> ### ç¤ºä¾‹ï¼šèŠå¤©ä¼šè¯ä¸Šä¸‹æ–‡
>
> ```java
> @Component
> @Scope(value = "websocket", proxyMode = ScopedProxyMode.TARGET_CLASS)
> public class ChatSessionContext {
>     private String username;
>     private final List<String> messages = new ArrayList<>();
>     // getter & setter
> }
> ```
>
> - ç”¨æˆ· A å»ºç«‹ WebSocket è¿æ¥ â†’ æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ `ChatSessionContext`ã€‚
> - ç”¨æˆ· B è¿æ¥ â†’ æ‹¥æœ‰è‡ªå·±çš„ `ChatSessionContext`ï¼Œäº’ä¸å¹²æ‰°ã€‚
> - å½“ WebSocket å…³é—­æ—¶ï¼ŒBean ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚
>
> ------
>
> ## 4. **Custom Scopesï¼ˆè‡ªå®šä¹‰ä½œç”¨åŸŸï¼‰**
>
> - **ç‰¹å¾**ï¼šä½ å¯ä»¥å®ç° `Scope` æ¥å£ï¼Œå®Œå…¨è‡ªå®šä¹‰ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚
> - **åº”ç”¨åœºæ™¯**ï¼šä¾‹å¦‚ã€Œæ¯æ¬¡ä¸šåŠ¡äº‹åŠ¡ã€ã€ã€Œæ¯æ¬¡ API è°ƒç”¨ã€ã€ã€Œç§Ÿæˆ·éš”ç¦»ã€ç­‰ç‰¹æ®Šéœ€æ±‚ã€‚
>
> ### ç¤ºä¾‹ï¼šå®šä¹‰ä¸€ä¸ªâ€œè¯·æ±‚ç”¨æˆ·çº§åˆ«â€çš„ä½œç”¨åŸŸ
>
> æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨ **å½“å‰è¯·æ±‚çš„ç”¨æˆ·ä¸Šä¸‹æ–‡** ä¸­å…±äº«ä¸€ä¸ª Beanï¼Œè€Œä¸æ˜¯æ•´ä¸ª Sessionï¼š
>
> ```java
> public class UserScope implements Scope {
>     private final ThreadLocal<Map<String, Object>> beans = ThreadLocal.withInitial(HashMap::new);
> 
>     @Override
>     public Object get(String name, ObjectFactory<?> objectFactory) {
>         return beans.get().computeIfAbsent(name, k -> objectFactory.getObject());
>     }
>     @Override public Object remove(String name) { return beans.get().remove(name); }
>     @Override public void registerDestructionCallback(String name, Runnable callback) {}
>     @Override public Object resolveContextualObject(String key) { return null; }
>     @Override public String getConversationId() { return Thread.currentThread().getName(); }
> }
> ```
>
> ç„¶åæ³¨å†Œè‡ªå®šä¹‰ scopeï¼š
>
> ```java
> @Configuration
> public class ScopeConfig {
>     @Bean
>     public static CustomScopeConfigurer configurer() {
>         CustomScopeConfigurer configurer = new CustomScopeConfigurer();
>         configurer.addScope("user", new UserScope());
>         return configurer;
>     }
> }
> ```
>
> å†ä½¿ç”¨ï¼š
>
> ```java
> @Component
> @Scope("user")
> public class UserContext {
>     private String username;
>     // ...
> }
> ```
>
> Bean çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåˆ° **ç”¨æˆ· ID**ï¼Œè€Œä¸æ˜¯çº¿ç¨‹ã€‚
>
> è¿™æ ·å°±å¯ä»¥çµæ´»å®ç° **æŒ‰ç”¨æˆ·ç»´åº¦** çš„ Bean ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸æ˜¯ç»‘å®šåœ¨æ ‡å‡†çš„ Session æˆ– Application ä¸Šã€‚
>
> ------
>
> ğŸ“Œ æ€»ç»“å¯¹æ¯”ï¼š
>
> - **Session**ï¼šæ¯ä¸ªç”¨æˆ·ä¼šè¯ç‹¬ç«‹ï¼ˆå¦‚è´­ç‰©è½¦ï¼‰ã€‚
> - **Application**ï¼šå…¨åº”ç”¨å…±äº«ä¸€ä¸ªï¼ˆå¦‚å…¨å±€ç»Ÿè®¡å™¨ï¼‰ã€‚
> - **WebSocket**ï¼šæ¯ä¸ª WebSocket è¿æ¥ç‹¬ç«‹ï¼ˆå¦‚èŠå¤©ä¸Šä¸‹æ–‡ï¼‰ã€‚
> - **Custom**ï¼šè‡ªå·±å®šä¹‰ï¼Œæ¯”å¦‚ã€Œæ¯ä¸ªç§Ÿæˆ·ã€ã€Œæ¯ä¸ªäº‹åŠ¡ã€çš„ä½œç”¨åŸŸã€‚

------

### åœ¨Springä¸­ï¼Œåœ¨beanåŠ è½½/é”€æ¯å‰åï¼Œå¦‚æœæƒ³å®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥æ€ä¹ˆåš

åœ¨Springæ¡†æ¶ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨BeanåŠ è½½ï¼ˆå³å®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹å®Œæˆåï¼‰æˆ–é”€æ¯å‰åæ‰§è¡ŒæŸäº›é€»è¾‘ï¼Œä½ å¯ä»¥ä½¿ç”¨Springçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥å£æˆ–æ³¨è§£ã€‚è¿™äº›æ¥å£å’Œæ³¨è§£å…è®¸ä½ å®šä¹‰åœ¨Beanç”Ÿå‘½å‘¨æœŸçš„å…³é”®ç‚¹æ‰§è¡Œçš„ä»£ç ã€‚

> ä½¿ç”¨init-methodå’Œdestroy-method

åœ¨XMLé…ç½®ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡init-methodå’Œdestroy-methodå±æ€§æ¥æŒ‡å®šBeanåˆå§‹åŒ–åå’Œé”€æ¯å‰éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚

```xml
<bean id="myBean" class="com.example.MyBeanClass"  
      init-method="init" destroy-method="destroy"/>
```

ç„¶åï¼Œåœ¨ä½ çš„Beanç±»ä¸­å®ç°è¿™äº›æ–¹æ³•ï¼š

```java
public class MyBeanClass {  
  
    public void init() {  
        // åˆå§‹åŒ–é€»è¾‘  
    }  
  
    public void destroy() {  
        // é”€æ¯é€»è¾‘  
    }  
}
```

> å®ç°InitializingBeanå’ŒDisposableBeanæ¥å£

ä½ çš„Beanç±»å¯ä»¥==å®ç°org.springframework.beans.factory.InitializingBeanå’Œorg.springframework.beans.factory.DisposableBeanæ¥==å£ï¼Œå¹¶åˆ†åˆ«å®ç°==afterPropertiesSetå’Œdestroy==æ–¹æ³•ã€‚

```java
import org.springframework.beans.factory.DisposableBean;  
import org.springframework.beans.factory.InitializingBean;  
  
public class MyBeanClass implements InitializingBean, DisposableBean {  
  
    @Override  
    public void afterPropertiesSet() throws Exception {  
        // åˆå§‹åŒ–é€»è¾‘  
    }  
  
    @Override  
    public void destroy() throws Exception {  
        // é”€æ¯é€»è¾‘  
    }  
}
```

> ä½¿ç”¨@PostConstructå’Œ@PreDestroyæ³¨è§£

```java
import javax.annotation.PostConstruct;  
import javax.annotation.PreDestroy;  
  
public class MyBeanClass {  
  
    @PostConstruct  
    public void init() {  
        // åˆå§‹åŒ–é€»è¾‘  
    }  
  
    @PreDestroy  
    public void destroy() {  
        // é”€æ¯é€»è¾‘  
    }  
}
```

> ä½¿ç”¨@Beanæ³¨è§£çš„initMethodå’ŒdestroyMethodå±æ€§

åœ¨åŸºäºJavaçš„é…ç½®ä¸­ï¼Œä½ è¿˜å¯ä»¥åœ¨@Beanæ³¨è§£ä¸­æŒ‡å®šinitMethodå’ŒdestroyMethodå±æ€§ã€‚

```java
@Configuration  
public class AppConfig {  
  
    @Bean(initMethod = "init", destroyMethod = "destroy")  
    public MyBeanClass myBean() {  
        return new MyBeanClass();  
    }  
}
```

------

### Springç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œè¿™äº›æœ‰äº†è§£å—ï¼Ÿ

Springæ¡†æ¶æä¾›äº†è®¸å¤šæ‰©å±•ç‚¹ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚å®šåˆ¶å’Œæ‰©å±•Springçš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ‰©å±•ç‚¹ï¼š

1. BeanFactoryPostProcessorï¼šå…è®¸åœ¨Springå®¹å™¨å®ä¾‹åŒ–beanä¹‹å‰ä¿®æ”¹beançš„å®šä¹‰ã€‚å¸¸ç”¨äºä¿®æ”¹beanå±æ€§æˆ–æ”¹å˜beançš„ä½œç”¨åŸŸã€‚
2. BeanPostProcessorï¼šå¯ä»¥åœ¨beanå®ä¾‹åŒ–ã€é…ç½®ä»¥åŠåˆå§‹åŒ–ä¹‹åå¯¹å…¶è¿›è¡Œé¢å¤–å¤„ç†ã€‚å¸¸ç”¨äºä»£ç†beanã€ä¿®æ”¹beanå±æ€§ç­‰ã€‚
3. PropertySourceï¼šç”¨äºå®šä¹‰ä¸åŒçš„å±æ€§æºï¼Œå¦‚æ–‡ä»¶ã€æ•°æ®åº“ç­‰ï¼Œä»¥ä¾¿åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨ã€‚
4. ImportSelectorå’ŒImportBeanDefinitionRegistrarï¼šç”¨äºæ ¹æ®æ¡ä»¶åŠ¨æ€æ³¨å†Œbeanå®šä¹‰ï¼Œå®ç°é…ç½®ç±»çš„æ¨¡å—åŒ–ã€‚
5. Spring MVCä¸­çš„HandlerInterceptorï¼šç”¨äºæ‹¦æˆªå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤„ç†å‰ã€å¤„ç†ä¸­å’Œå¤„ç†åæ‰§è¡Œç‰¹å®šé€»è¾‘ã€‚
6. Spring MVCä¸­çš„ControllerAdviceï¼šç”¨äºå…¨å±€å¤„ç†æ§åˆ¶å™¨çš„å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œæ•°æ®æ ¡éªŒã€‚
7. Spring Bootçš„è‡ªåŠ¨é…ç½®ï¼šé€šè¿‡åˆ›å»ºè‡ªå®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¯ä»¥å®ç°å¯¹æ¡†æ¶å’Œç¬¬ä¸‰æ–¹åº“çš„è‡ªåŠ¨é…ç½®ã€‚
8. è‡ªå®šä¹‰æ³¨è§£ï¼šåˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºå®ç°ç‰¹å®šåŠŸèƒ½æˆ–çº¦å®šï¼Œå¦‚æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰ã€‚

> Spring æ¡†æ¶æä¾›äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œå…è®¸å¼€å‘è€…åœ¨å®¹å™¨çš„ä¸åŒç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯ **10 ä¸ªæ ¸å¿ƒæ‰©å±•ç‚¹**çš„è¯¦ç»†è¯´æ˜å’Œä»£ç ç¤ºä¾‹ï¼š
>
> ------
>
> ### **1. BeanFactoryPostProcessor**
>
> **ä½œç”¨**ï¼šåœ¨ Bean å®šä¹‰åŠ è½½åã€å®ä¾‹åŒ–å‰ä¿®æ”¹ Bean çš„å®šä¹‰ï¼ˆå¦‚ä¿®æ”¹å±æ€§ã€ä½œç”¨åŸŸï¼‰ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šåŠ¨æ€ä¿®æ”¹é…ç½®ã€æ›¿æ¢å ä½ç¬¦ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šæ›¿æ¢æ‰€æœ‰ Bean çš„ `scope` ä¸ºåŸå‹æ¨¡å¼
>
> ```
> @Component
> public class CustomBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
>     @Override
>     public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
>         for (String beanName : beanFactory.getBeanDefinitionNames()) {
>             BeanDefinition definition = beanFactory.getBeanDefinition(beanName);
>             definition.setScope(BeanDefinition.SCOPE_PROTOTYPE); // å¼ºåˆ¶æ”¹ä¸ºåŸå‹
>         }
>     }
> }
> ```
>
> ------
>
> ### **2. BeanPostProcessor**
>
> **ä½œç”¨**ï¼šåœ¨ Bean åˆå§‹åŒ–å‰åæ‰§è¡Œé€»è¾‘ï¼ˆå¦‚ä»£ç†ã€ç›‘æ§ï¼‰ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šAOP ä»£ç†ã€æ€§èƒ½ç›‘æ§ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šç»Ÿè®¡ Bean åˆå§‹åŒ–è€—æ—¶
>
> ```
> @Component
> public class TimingBeanPostProcessor implements BeanPostProcessor {
>     @Override
>     public Object postProcessBeforeInitialization(Object bean, String beanName) {
>         return bean; // åˆå§‹åŒ–å‰ä¸åšå¤„ç†
>     }
> 
>     @Override
>     public Object postProcessAfterInitialization(Object bean, String beanName) {
>         System.out.println("Bean [" + beanName + "] åˆå§‹åŒ–å®Œæˆ");
>         return bean;
>     }
> }
> ```
>
> ------
>
> ### **3. PropertySource**
>
> **ä½œç”¨**ï¼šè‡ªå®šä¹‰å±æ€§æºï¼ˆå¦‚æ•°æ®åº“ã€è¿œç¨‹é…ç½®ï¼‰ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šä»æ•°æ®åº“åŠ è½½é…ç½®ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šåŠ¨æ€æ·»åŠ å†…å­˜å±æ€§æº
>
> ```
> @Configuration
> public class CustomPropertySourceConfig {
>     @Bean
>     public static PropertySourcesPlaceholderConfigurer propertySources() {
>         PropertySourcesPlaceholderConfigurer configurer = new PropertySourcesPlaceholderConfigurer();
>         Map<String, Object> customProperties = Map.of("app.version", "1.0.0");
>         configurer.setPropertiesArray(new Properties() {{
>             putAll(customProperties);
>         }});
>         return configurer;
>     }
> }
> ```
>
> ------
>
> ### **4. ImportSelector & ImportBeanDefinitionRegistrar**
>
> **ä½œç”¨**ï¼šåŠ¨æ€æ³¨å†Œ Bean å®šä¹‰ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šæ¡ä»¶åŒ–åŠ è½½æ¨¡å—ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šæ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹©é…ç½®ç±»
>
> ```
> public class EnvAwareImportSelector implements ImportSelector {
>     @Override
>     public String[] selectImports(AnnotationMetadata metadata) {
>         String env = System.getProperty("spring.profiles.active", "dev");
>         return env.equals("prod") ? 
>             new String[] { ProdConfig.class.getName() } : 
>             new String[] { DevConfig.class.getName() };
>     }
> }
> 
> // ä½¿ç”¨ï¼š@Import(EnvAwareImportSelector.class)
> ```
>
> ------
>
> ### **5. HandlerInterceptor (Spring MVC)**
>
> **ä½œç”¨**ï¼šæ‹¦æˆª HTTP è¯·æ±‚ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šæƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šè®°å½•è¯·æ±‚è€—æ—¶
>
> ```
> public class TimingInterceptor implements HandlerInterceptor {
>     @Override
>     public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
>         request.setAttribute("startTime", System.currentTimeMillis());
>         return true;
>     }
> 
>     @Override
>     public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
>         long duration = System.currentTimeMillis() - (long) request.getAttribute("startTime");
>         System.out.println("è¯·æ±‚è€—æ—¶: " + duration + "ms");
>     }
> }
> 
> // æ³¨å†Œï¼šWebMvcConfigurer.addInterceptors()
> ```
>
> ------
>
> ### **6. @ControllerAdvice (Spring MVC)**
>
> **ä½œç”¨**ï¼šå…¨å±€å¤„ç†æ§åˆ¶å™¨å¼‚å¸¸/æ•°æ®ç»‘å®šã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šæ•è·æ‰€æœ‰æ§åˆ¶å™¨å¼‚å¸¸
>
> ```
> @ControllerAdvice
> public class GlobalExceptionHandler {
>     @ExceptionHandler(Exception.class)
>     public ResponseEntity<String> handleException(Exception e) {
>         return ResponseEntity.status(500).body("é”™è¯¯: " + e.getMessage());
>     }
> }
> ```
>
> ------
>
> ### **7. Spring Boot è‡ªåŠ¨é…ç½®**
>
> **ä½œç”¨**ï¼šåŸºäºæ¡ä»¶è‡ªåŠ¨é…ç½® Beanã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šå¼€å‘ Starter åº“ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šå½“ç±»è·¯å¾„å­˜åœ¨ `DataSource` æ—¶è‡ªåŠ¨é…ç½®è¿æ¥æ± 
>
> ```
> @Configuration
> @ConditionalOnClass(DataSource.class)
> public class DataSourceAutoConfig {
>     @Bean
>     @ConditionalOnMissingBean
>     public DataSource dataSource() {
>         return new HikariDataSource();
>     }
> }
> ```
>
> ------
>
> ### **8. è‡ªå®šä¹‰æ³¨è§£**
>
> **ä½œç”¨**ï¼šé€šè¿‡æ³¨è§£é©±åŠ¨è¡Œä¸ºã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šæƒé™æ§åˆ¶ã€æ—¥å¿—åˆ‡é¢ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šè®°å½•æ–¹æ³•æ‰§è¡Œæ—¥å¿—
>
> ```
> @Retention(RetentionPolicy.RUNTIME)
> @Target(ElementType.METHOD)
> public @interface LogExecution {}
> 
> @Aspect
> @Component
> public class LogAspect {
>     @Around("@annotation(LogExecution)")
>     public Object log(ProceedingJoinPoint pjp) throws Throwable {
>         System.out.println("å¼€å§‹æ‰§è¡Œ: " + pjp.getSignature());
>         Object result = pjp.proceed();
>         System.out.println("æ‰§è¡Œå®Œæˆ");
>         return result;
>     }
> }
> ```
>
> ------
>
> ### **9. ApplicationListener**
>
> **ä½œç”¨**ï¼šç›‘å¬ Spring äº‹ä»¶ï¼ˆå¦‚å®¹å™¨åˆ·æ–°ã€Bean åˆ›å»ºï¼‰ã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šå¯åŠ¨æ—¶åˆå§‹åŒ–ç¼“å­˜ã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šå®¹å™¨å¯åŠ¨ååŠ è½½æ•°æ®
>
> ```
> @Component
> public class CacheInitializer implements ApplicationListener<ContextRefreshedEvent> {
>     @Override
>     public void onApplicationEvent(ContextRefreshedEvent event) {
>         System.out.println("å®¹å™¨å·²åˆ·æ–°ï¼Œåˆå§‹åŒ–ç¼“å­˜...");
>     }
> }
> ```
>
> ------
>
> ### **10. SmartInitializingSingleton**
>
> **ä½œç”¨**ï¼šæ‰€æœ‰å•ä¾‹ Bean åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œã€‚
>  â€‹**â€‹å…¸å‹åœºæ™¯â€‹**â€‹ï¼šä¾èµ–æ£€æŸ¥ã€å¯åŠ¨åæ“ä½œã€‚
>  â€‹**â€‹ç¤ºä¾‹â€‹**â€‹ï¼šéªŒè¯æ‰€æœ‰ Service æ˜¯å¦æ³¨å…¥æˆåŠŸ
>
> ```
> @Component
> public class DependencyChecker implements SmartInitializingSingleton {
>     @Autowired
>     private List<MyService> services; // æ”¶é›†æ‰€æœ‰MyService
> 
>     @Override
>     public void afterSingletonsInstantiated() {
>         if (services.isEmpty()) {
>             throw new IllegalStateException("æœªæ‰¾åˆ°ä»»ä½•MyServiceå®ç°ï¼");
>         }
>     }
> }
> ```
>
> ------
>
> ### **æ‰©å±•ç‚¹å¯¹æ¯”æ€»ç»“**
>
> | **æ‰©å±•ç‚¹**                   | **è§¦å‘æ—¶æœº**               | **å…¸å‹åº”ç”¨**           |
> | ---------------------------- | -------------------------- | ---------------------- |
> | `BeanFactoryPostProcessor`   | Bean å®šä¹‰åŠ è½½å            | åŠ¨æ€ä¿®æ”¹ Bean é…ç½®     |
> | `BeanPostProcessor`          | Bean åˆå§‹åŒ–å‰å            | AOP ä»£ç†ã€ç›‘æ§         |
> | `PropertySource`             | ç¯å¢ƒå‡†å¤‡é˜¶æ®µ               | è‡ªå®šä¹‰é…ç½®æº           |
> | `ImportSelector`             | é…ç½®ç±»åŠ è½½æ—¶               | æ¡ä»¶åŒ–æ¨¡å—å¯¼å…¥         |
> | `HandlerInterceptor`         | HTTP è¯·æ±‚å¤„ç†å‰å          | æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•     |
> | `@ControllerAdvice`          | æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå           | å…¨å±€å¼‚å¸¸å¤„ç†           |
> | `@Conditional`               | è‡ªåŠ¨é…ç½®æ¡ä»¶åˆ¤æ–­           | Starter åº“å¼€å‘         |
> | è‡ªå®šä¹‰æ³¨è§£ + AOP             | æ–¹æ³•è°ƒç”¨æ—¶                 | å£°æ˜å¼äº‹åŠ¡ã€æ—¥å¿—       |
> | `ApplicationListener`        | ç‰¹å®šäº‹ä»¶å‘å¸ƒæ—¶             | å¯åŠ¨ä»»åŠ¡ã€äº‹ä»¶å“åº”     |
> | `SmartInitializingSingleton` | æ‰€æœ‰å•ä¾‹ Bean åˆå§‹åŒ–å®Œæˆå | ä¾èµ–æ£€æŸ¥ã€å¯åŠ¨ååˆå§‹åŒ– |

------

## SpringMVC

### MVCåˆ†å±‚ä»‹ç»ä¸€ä¸‹

MVCå…¨åæ˜¯Model View Controllerï¼Œæ˜¯æ¨¡å‹(model)ï¼è§†å›¾(view)ï¼æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡å…¸èŒƒï¼Œç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå°†ä¸šåŠ¡é€»è¾‘èšé›†åˆ°ä¸€ä¸ªéƒ¨ä»¶é‡Œé¢ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚==	==

- **è§†å›¾(view)ï¼š ä¸ºç”¨æˆ·æä¾›ä½¿ç”¨ç•Œé¢ï¼Œä¸ç”¨æˆ·ç›´æ¥è¿›è¡Œäº¤äº’ã€‚**
- **æ¨¡å‹(model)ï¼š ä»£è¡¨ä¸€ä¸ªå­˜å–æ•°æ®çš„å¯¹è±¡æˆ– JAVA POJOï¼ˆPlain Old Java Objectï¼Œç®€å•javaå¯¹è±¡ï¼‰ã€‚å®ƒä¹Ÿå¯ä»¥å¸¦æœ‰é€»è¾‘ï¼Œä¸»è¦ç”¨äºæ‰¿è½½æ•°æ®ï¼Œå¹¶å¯¹ç”¨æˆ·æäº¤è¯·æ±‚è¿›è¡Œè®¡ç®—çš„æ¨¡å—ã€‚æ¨¡å‹åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»ç§°ä¸ºæ•°æ®æ‰¿è½½ Beanï¼Œä¸€ç±»ç§°ä¸ºä¸šåŠ¡å¤„ç†Beanã€‚æ‰€è°“æ•°æ®æ‰¿è½½ Bean æ˜¯æŒ‡å®ä½“ç±»ï¼ˆå¦‚ï¼šUserç±»ï¼‰ï¼Œä¸“é—¨ä¸ºç”¨æˆ·æ‰¿è½½ä¸šåŠ¡æ•°æ®çš„ï¼›è€Œä¸šåŠ¡å¤„ç† Bean åˆ™æ˜¯æŒ‡Service æˆ– Dao å¯¹è±¡ï¼Œ ä¸“é—¨ç”¨äºå¤„ç†ç”¨æˆ·æäº¤è¯·æ±‚çš„ã€‚**
- **æ§åˆ¶å™¨(controller)ï¼š ç”¨äºå°†ç”¨æˆ·è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„ Model è¿›è¡Œå¤„ç†ï¼Œå¹¶æ ¹æ® Model çš„è®¡ç®—ç»“æœå‘ç”¨æˆ·æä¾›ç›¸åº”å“åº”ã€‚å®ƒä½¿è§†å›¾ä¸æ¨¡å‹åˆ†ç¦»ã€‚**

![img](https://cdn.xiaolincoding.com//picgo/1713944902120-e35c2b4f-e290-4973-aa1a-3193af3bb371.png)

æµç¨‹æ­¥éª¤ï¼š

1. **ç”¨æˆ·é€šè¿‡View é¡µé¢å‘æœåŠ¡ç«¯æå‡ºè¯·æ±‚ï¼Œå¯ä»¥æ˜¯è¡¨å•è¯·æ±‚ã€è¶…é“¾æ¥è¯·æ±‚ã€AJAX è¯·æ±‚ç­‰ï¼›**
2. **æœåŠ¡ç«¯ Controller æ§åˆ¶å™¨æ¥æ”¶åˆ°è¯·æ±‚åå¯¹è¯·æ±‚è¿›è¡Œè§£æï¼Œæ‰¾åˆ°ç›¸åº”çš„Modelï¼Œå¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†Model å¤„ç†ï¼›**
3. **å°†å¤„ç†ç»“æœå†äº¤ç»™ Controllerï¼ˆæ§åˆ¶å™¨å…¶å®åªæ˜¯èµ·åˆ°äº†æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼‰ï¼›**
4. **æ ¹æ®å¤„ç†ç»“æœæ‰¾åˆ°è¦ä½œä¸ºå‘å®¢æˆ·ç«¯å‘å›çš„å“åº”View é¡µé¢ï¼Œé¡µé¢ç»æ¸²æŸ“åå‘é€ç»™å®¢æˆ·ç«¯ã€‚**

------

### äº†è§£SpringMVCçš„å¤„ç†æµç¨‹å—ï¼Ÿ

![img](https://cdn.xiaolincoding.com//picgo/1716791047520-ac0d9673-be0a-4005-8732-30bdedc8f1af.webp)

Spring MVCçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. ç”¨æˆ·å‘é€è¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨DispatcherServlet
2. DispatcherServletæ”¶åˆ°è¯·æ±‚è°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingã€‚
3. å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®è¯·æ±‚urlæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ï¼Œç”Ÿæˆå¤„ç†å™¨==æ‰§è¡Œé“¾HandlerExecutionChain(åŒ…æ‹¬å¤„ç†å™¨å¯¹è±¡å’Œå¤„ç†å™¨æ‹¦æˆªå™¨)==ä¸€å¹¶è¿”å›ç»™DispatcherServletã€‚
4. ==DispatcherServlet==æ ¹æ®å¤„ç†å™¨Handlerè·å–å¤„ç†å™¨é€‚é…å™¨HandlerAdapteræ‰§è¡ŒHandlerAdapterå¤„ç†ä¸€ç³»åˆ—çš„æ“ä½œï¼Œå¦‚ï¼š==å‚æ•°å°è£…ï¼Œæ•°æ®æ ¼å¼è½¬æ¢ï¼Œæ•°æ®éªŒè¯ç­‰æ“ä½œ==
5. æ‰§è¡Œå¤„ç†å™¨Handler(Controllerï¼Œä¹Ÿå«é¡µé¢æ§åˆ¶å™¨)ã€‚
6. Handleræ‰§è¡Œå®Œæˆè¿”å›ModelAndView
7. HandlerAdapterå°†Handleræ‰§è¡Œç»“æœModelAndViewè¿”å›åˆ°DispatcherServlet
8. DispatcherServletå°†ModelAndViewä¼ ç»™ViewResloverè§†å›¾è§£æå™¨
9. ViewResloverè§£æåè¿”å›å…·ä½“View
10. DispatcherServletå¯¹Viewè¿›è¡Œæ¸²æŸ“è§†å›¾ï¼ˆå³å°†æ¨¡å‹æ•°æ®modelå¡«å……è‡³è§†å›¾ä¸­ï¼‰ã€‚
11. DispatcherServletå“åº”ç”¨æˆ·ã€‚

> ##  SpringMVC è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
>
> 1. **è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨ (Tomcat ç­‰)**
> 2. **Filter é“¾ (javax.servlet.Filter)**
>    - å±äº **Servlet è§„èŒƒ**ï¼Œåœ¨ **DispatcherServlet ä¹‹å‰**æ‰§è¡Œã€‚
> 3. **DispatcherServlet**
>    - SpringMVC çš„æ ¸å¿ƒå‰ç«¯æ§åˆ¶å™¨ã€‚
> 4. **HandlerMapping**
>    - æ‰¾åˆ°èƒ½å¤„ç†è¯·æ±‚çš„ Handlerï¼ˆé€šå¸¸æ˜¯ Controller æ–¹æ³•ï¼‰ã€‚
> 5. **HandlerAdapter**
>    - è´Ÿè´£è°ƒç”¨å…·ä½“çš„ Handlerï¼ˆController æ–¹æ³•ï¼‰ã€‚
> 6. **HandlerInterceptor**
>    - SpringMVC çš„æ‹¦æˆªå™¨ï¼Œåœ¨ **HandlerAdapter è°ƒç”¨ Handler å‰å**æ‰§è¡Œã€‚
>    - å…¸å‹å›è°ƒï¼š`preHandle -> handler -> postHandle -> afterCompletion`ã€‚

------

### Handlermapping å’Œ handleradapteræœ‰äº†è§£å—ï¼Ÿ

HandlerMappingï¼š

- **ä½œç”¨**ï¼šHandlerMappingè´Ÿè´£å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼ˆControllerï¼‰ã€‚
- **åŠŸèƒ½**ï¼šæ ¹æ®è¯·æ±‚çš„URLã€è¯·æ±‚å‚æ•°ç­‰ä¿¡æ¯ï¼Œæ‰¾åˆ°å¤„ç†è¯·æ±‚çš„ Controllerã€‚
- **ç±»å‹**ï¼šSpringæä¾›äº†å¤šç§HandlerMappingå®ç°ï¼Œå¦‚BeanNameUrlHandlerMappingã€RequestMappingHandlerMappingç­‰ã€‚
- **å·¥ä½œæµç¨‹**ï¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯ç¡®==å®šè¦è¯·æ±‚çš„å¤„ç†å™¨(Controller)ã€‚HandlerMappingå¯ä»¥æ ¹æ®URLã€è¯·æ±‚å‚æ•°ç­‰è§„åˆ™ç¡®å®šå¯¹åº”çš„å¤„ç†å™¨ã€‚==

HandlerAdapterï¼š

- **ä½œç”¨**ï¼šHandlerAdapterè´Ÿè´£==è°ƒç”¨å¤„ç†å™¨(Controller)==æ¥å¤„ç†è¯·æ±‚ã€‚==é€‚é…å¤šç§é£æ ¼(**æ³¨è§£å¼ã€æ¥å£å¼ã€å‡½æ•°å¼ï¼‰**)==
- **åŠŸèƒ½**ï¼šå¤„ç†å™¨(Controller)å¯èƒ½æœ‰ä¸åŒçš„æ¥å£ç±»å‹ï¼ˆControlleræ¥å£ã€HttpRequestHandleræ¥å£ç­‰ï¼‰ï¼ŒHandlerAdapteræ ¹æ®å¤„ç†å™¨çš„ç±»å‹æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥è°ƒç”¨å¤„ç†å™¨ã€‚
- **ç±»å‹**ï¼šSpringæä¾›äº†å¤šä¸ªHandlerAdapterå®ç°ï¼Œç”¨äºé€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚
- **å·¥ä½œæµç¨‹**ï¼šæ ¹æ®å¤„ç†å™¨çš„æ¥å£ç±»å‹ï¼Œé€‰æ‹©ç›¸åº”çš„HandlerAdapteræ¥è°ƒç”¨å¤„ç†å™¨ã€‚

å·¥ä½œæµç¨‹ï¼š

1. å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒHandlerMappingæ ¹æ®è¯·æ±‚ä¿¡æ¯æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨(Controller)ã€‚
2. HandlerAdapteræ ¹æ®å¤„ç†å™¨çš„ç±»å‹é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥è°ƒç”¨å¤„ç†å™¨ã€‚
3. å¤„ç†å™¨æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”ŸæˆModelAndViewã€‚
4. HandlerAdapterå°†å¤„ç†å™¨çš„æ‰§è¡Œç»“æœåŒ…è£…æˆModelAndViewã€‚
5. è§†å›¾è§£æå™¨æ ¹æ®ModelAndViewæ‰¾åˆ°å¯¹åº”çš„è§†å›¾è¿›è¡Œæ¸²æŸ“ã€‚
6. å°†æ¸²æŸ“åçš„è§†å›¾è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

HandlerMappingå’ŒHandlerAdapterååŒå·¥ä½œï¼Œé€šè¿‡å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼Œå¹¶è°ƒç”¨å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå®ç°äº†è¯·æ±‚å¤„ç†çš„æµç¨‹ã€‚å®ƒä»¬çš„çµæ´»æ€§ä½¿å¾—åœ¨Spring MVCä¸­å¯ä»¥æ”¯æŒå¤šç§å¤„ç†å™¨å’Œå¤„ç†æ–¹å¼ï¼Œæé«˜äº†æ¡†æ¶çš„æ‰©å±•æ€§å’Œé€‚åº”æ€§ã€‚

------

## SpringBoot

### SpringBootæ¯”Springå¥½åœ¨å“ªé‡Œ

- Spring Boot æä¾›äº†==è‡ªåŠ¨åŒ–é…ç½®==ï¼Œå¤§å¤§ç®€åŒ–äº†é¡¹ç›®çš„é…ç½®è¿‡ç¨‹ã€‚é€šè¿‡çº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ï¼Œå¾ˆå¤šå¸¸ç”¨çš„é…ç½®å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚

  ==Beanè‡ªåŠ¨è£…é…ï¼šæ•°æ®åº“ç›¸å…³ã€ Web / MVC ç›¸å…³ã€ç¼“å­˜ / Redisã€æ¶ˆæ¯é˜Ÿåˆ— / RabbitMQ / Kafkaç­‰Template==

- Spring Boot æä¾›äº†å¿«é€Ÿçš„é¡¹ç›®å¯åŠ¨å™¨ï¼Œ==é€šè¿‡å¼•å…¥ä¸åŒçš„ Starterï¼Œå¯ä»¥å¿«é€Ÿé›†æˆå¸¸ç”¨çš„æ¡†æ¶å’Œåº“==ï¼ˆå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Web å¼€å‘ç­‰ï¼‰ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚

- Spring Boot é»˜è®¤é›†æˆäº†å¤šç§==å†…åµŒæœåŠ¡å™¨==ï¼ˆå¦‚Tomcatã€Jettyã€Undertowï¼‰ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼Œå³å¯å°†åº”ç”¨æ‰“åŒ…æˆå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œè¿è¡Œã€‚==ä¸éœ€è¦é¢å¤–ä¸‹è½½å¹¶é…ç½®å¯ç”¨==

| ç‰¹æ€§                                           | å±äºSpring | å±äºSpringBoot | è¯´æ˜                                                         |
| ---------------------------------------------- | ---------- | -------------- | :----------------------------------------------------------- |
| **IoC å®¹å™¨ï¼ˆBean ç®¡ç†ï¼‰**                      | âœ… æ˜¯       | âŒ å¦           | æ ¸å¿ƒåŠŸèƒ½ï¼ŒSpring ä» 1.x å°±æä¾›`ApplicationContext`ã€`@Component`ã€`@Service`ç­‰ |
| **AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰**                        | âœ… æ˜¯       | âŒ å¦           | Spring æä¾›`@Aspect`ã€`@Around`ç­‰ï¼ŒåŸºäºä»£ç†å®ç°              |
| **äº‹åŠ¡ç®¡ç†ï¼ˆ@Transactionalï¼‰**                 | âœ… æ˜¯       | âŒ å¦           | Spring ä»æ—©æœŸå°±æ”¯æŒå£°æ˜å¼äº‹åŠ¡ç®¡ç†                            |
| **MVC æ¡†æ¶ï¼ˆ@Controller, @RequestMappingï¼‰**   | âœ… æ˜¯       | âŒ å¦           | `spring-webmvc`æ˜¯ Spring Framework çš„æ¨¡å—                    |
| **JDBC / ORM æ”¯æŒï¼ˆJdbcTemplate, Hibernateï¼‰** | âœ… æ˜¯       | âŒ å¦           | Spring æä¾›`JdbcTemplate`ã€`LocalSessionFactoryBean`ç­‰æ¨¡æ¿å’Œé›†æˆç±» |
| **è‡ªåŠ¨è£…é…ï¼ˆ@Autowired, @Resourceï¼‰**          | âœ… æ˜¯       | âŒ å¦           | Spring 2.5+ å¼•å…¥æ³¨è§£é©±åŠ¨ä¾èµ–æ³¨å…¥ï¼Œæ˜¯æ ¸å¿ƒç‰¹æ€§                 |
| **äº‹ä»¶æœºåˆ¶ï¼ˆApplicationEventï¼‰**               | âœ… æ˜¯       | âŒ å¦           | Spring æä¾›äº‹ä»¶å‘å¸ƒ/ç›‘å¬æœºåˆ¶                                 |
| **SpELï¼ˆSpring Expression Languageï¼‰**         | âœ… æ˜¯       | âŒ å¦           | Spring 3.0 å¼•å…¥ï¼Œç”¨äºåŠ¨æ€è¡¨è¾¾å¼æ±‚å€¼                          |
| **@Configuration + @Bean**                     | âœ… æ˜¯       | âŒ å¦           | Spring 3.0 å¼•å…¥ Java Config æ›¿ä»£ XML                         |
| **@Profileï¼ˆç¯å¢ƒé…ç½®ï¼‰**                       | âœ… æ˜¯       | âŒ å¦           | Spring 3.1 å¼•å…¥ï¼Œæ”¯æŒå¤šç¯å¢ƒ Bean æ³¨å†Œ                        |
| **å¤–éƒ¨åŒ–é…ç½®ï¼ˆ@PropertySource, @Valueï¼‰**      | âœ… æ˜¯       | âŒ å¦           | Spring æ”¯æŒåŠ è½½`.properties`æ–‡ä»¶å’Œæ³¨å…¥å±æ€§å€¼                 |
| **æµ‹è¯•æ”¯æŒï¼ˆ@ContextConfiguration, @Testï¼‰**   | âœ… æ˜¯       | âŒ å¦           | Spring Test æ¨¡å—æä¾›é›†æˆæµ‹è¯•æ”¯æŒ                             |

| ç‰¹æ€§                                                 | å±äºSpring   | å±äºSpringBoot | è¯´æ˜                                                         |
| ---------------------------------------------------- | ------------ | -------------- | ------------------------------------------------------------ |
| **è‡ªåŠ¨é…ç½®ï¼ˆAuto-configurationï¼‰**                   | âŒ å¦         | âœ… æ˜¯           | åŸºäº`@Conditional`+`META-INF/spring.factories`è‡ªåŠ¨æ³¨å†Œ Beanï¼ˆå¦‚ DataSourceã€RedisTemplateï¼‰ |
| **èµ·æ­¥ä¾èµ–ï¼ˆStarter Dependenciesï¼‰**                 | âŒ å¦         | âœ… æ˜¯           | `spring-boot-starter-web`,`spring-boot-starter-data-jpa`ç­‰ï¼Œç®€åŒ–ä¾èµ–ç®¡ç† |
| **å†…åµŒæœåŠ¡å™¨ï¼ˆTomcat/Jetty/Undertowï¼‰**              | âŒ å¦         | âœ… æ˜¯           | æ— éœ€éƒ¨ç½² WARï¼Œç›´æ¥è¿è¡Œ JARï¼Œå†…ç½® Servlet å®¹å™¨                |
| **å¤–éƒ¨é…ç½®ä¼˜å…ˆçº§ä½“ç³»ï¼ˆapplication.yml/propertiesï¼‰** | âš ï¸ åŸºç¡€æ”¯æŒ   | âœ… å¢å¼ºå®ç°     | Spring Boot ç»Ÿä¸€ç®¡ç† 17+ ç§é…ç½®æºï¼ˆå‘½ä»¤è¡Œã€ç¯å¢ƒå˜é‡ã€Profile ç­‰ï¼‰ |
| **Actuatorï¼ˆå¥åº·æ£€æŸ¥ã€ç›‘æ§ç«¯ç‚¹ï¼‰**                   | âŒ å¦         | âœ… æ˜¯           | `/actuator/health`,`/metrics`,`/info`ç­‰ç”Ÿäº§çº§ç›‘æ§ç«¯ç‚¹        |
| **SpringApplication ç±»ï¼ˆä¸€é”®å¯åŠ¨ï¼‰**                 | âŒ å¦         | âœ… æ˜¯           | `SpringApplication.run(App.class, args)`å¯åŠ¨æ•´ä¸ªä¸Šä¸‹æ–‡ + Web å®¹å™¨ |
| **DevToolsï¼ˆå¼€å‘çƒ­éƒ¨ç½²ï¼‰**                           | âŒ å¦         | âœ… æ˜¯           | ä¿®æ”¹ä»£ç è‡ªåŠ¨é‡å¯ã€LiveReloadã€å±æ€§é‡è½½ç­‰å¼€å‘å¢å¼º             |
| **Banner / å¯åŠ¨æ—¥å¿—ç¾åŒ–**                            | âŒ å¦         | âœ… æ˜¯           | è‡ªå®šä¹‰å¯åŠ¨ ASCII Bannerï¼Œå¢å¼ºä½“éªŒ                            |
| **è‡ªåŠ¨è£…é…æŠ¥å‘Šï¼ˆ--debug æˆ– /actuator/conditionsï¼‰**  | âŒ å¦         | âœ… æ˜¯           | æŸ¥çœ‹å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ/æœªç”Ÿæ•ˆï¼Œä¾¿äºè°ƒè¯•                      |
| **é»˜è®¤é…ç½®ï¼ˆçº¦å®šä¼˜äºé…ç½®ï¼‰**                         | âŒ å¦         | âœ… æ˜¯           | å¦‚é»˜è®¤ç«¯å£ 8080ã€é»˜è®¤ DataSource HikariCPã€é»˜è®¤ JSON Jackson ç­‰ |
| **YAML æ”¯æŒï¼ˆapplication.ymlï¼‰**                     | âš ï¸ å¯æ‰©å±•æ”¯æŒ | âœ… åŸç”Ÿé›†æˆ     | Spring Boot å†…ç½® YAML è§£æå™¨ï¼Œå¼€ç®±å³ç”¨                       |
| **Profile æ¿€æ´»ç®€åŒ–ï¼ˆspring.profiles.activeï¼‰**       | âš ï¸ åŸºç¡€æ”¯æŒ   | âœ… å¢å¼ºæ”¯æŒ     | æ”¯æŒå‘½ä»¤è¡Œã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶å¤šç§æ–¹å¼æ¿€æ´» Profile           |
| **å‘½ä»¤è¡Œè¿è¡Œï¼ˆjava -jar app.jarï¼‰**                  | âŒ å¦         | âœ… æ˜¯           | å¯æ‰§è¡Œ JAR + å†…åµŒå®¹å™¨ï¼Œæ— éœ€å¤–éƒ¨éƒ¨ç½²ç¯å¢ƒ                      |
| **å¥åº·æ£€æŸ¥ä¸æŒ‡æ ‡ï¼ˆMicrometer é›†æˆï¼‰**                | âŒ å¦         | âœ… æ˜¯           | ä¸ Prometheusã€Graphite ç­‰ç›‘æ§ç³»ç»Ÿé›†æˆ                       |

------

### SpringBootçš„é¡¹ç›®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ

ä¸€ä¸ªæ­£å¸¸çš„ä¼ä¸šé¡¹ç›®é‡Œä¸€ç§é€šç”¨çš„é¡¹ç›®ç»“æ„å’Œä»£ç å±‚çº§åˆ’åˆ†çš„æŒ‡å¯¼æ„è§ã€‚æŒ‰è¿™ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹æ—¶æœ¬ä¹¦ä¸Šè¯´çš„ï¼Œä¸€èˆ¬åˆ†ä¸ºå¦‚ä¸‹å‡ å±‚ï¼š

![img](https://cdn.xiaolincoding.com//picgo/1721712085278-f25ffdd1-26bc-4a7c-928a-42e48501b285.png)

- å¼€æ”¾æ¥å£å±‚ï¼šå¯ç›´æ¥å°è£… Service æ¥å£æš´éœ²æˆ RPC æ¥å£ï¼›é€šè¿‡ Web å°è£…æˆ http æ¥å£ï¼›ç½‘å…³æ§åˆ¶å±‚ç­‰ã€‚
- ç»ˆç«¯æ˜¾ç¤ºå±‚ï¼šå„ä¸ªç«¯çš„æ¨¡æ¿æ¸²æŸ“å¹¶æ‰§è¡Œæ˜¾ç¤ºçš„å±‚ã€‚å½“å‰ä¸»è¦æ˜¯ velocity æ¸²æŸ“ï¼ŒJS æ¸²æŸ“ï¼ŒJSP æ¸²æŸ“ï¼Œç§»åŠ¨ç«¯å±•ç¤ºç­‰ã€‚
- Web å±‚ï¼šä¸»è¦æ˜¯å¯¹è®¿é—®æ§åˆ¶è¿›è¡Œè½¬å‘ï¼Œå„ç±»åŸºæœ¬å‚æ•°æ ¡éªŒï¼Œæˆ–è€…ä¸å¤ç”¨çš„ä¸šåŠ¡ç®€å•å¤„ç†ç­‰ã€‚
- Service å±‚ï¼šç›¸å¯¹å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ã€‚
- Manager å±‚ï¼šé€šç”¨ä¸šåŠ¡å¤„ç†å±‚ï¼Œå®ƒæœ‰å¦‚ä¸‹ç‰¹å¾ï¼š
  - 1ï¼‰å¯¹ç¬¬ä¸‰æ–¹å¹³å°å°è£…çš„å±‚ï¼Œé¢„å¤„ç†è¿”å›ç»“æœåŠè½¬åŒ–å¼‚å¸¸ä¿¡æ¯ï¼Œé€‚é…ä¸Šå±‚æ¥å£ã€‚
  - 2ï¼‰å¯¹ Service å±‚é€šç”¨èƒ½åŠ›çš„ä¸‹æ²‰ï¼Œå¦‚ç¼“å­˜æ–¹æ¡ˆã€ä¸­é—´ä»¶é€šç”¨å¤„ç†ã€‚
  - 3ï¼‰ä¸ DAO å±‚äº¤äº’ï¼Œå¯¹å¤šä¸ª DAO çš„ç»„åˆå¤ç”¨ã€‚
- DAO å±‚ï¼šæ•°æ®è®¿é—®å±‚ï¼Œä¸åº•å±‚ MySQLã€Oracleã€Hbaseã€OceanBase ç­‰è¿›è¡Œæ•°æ®äº¤äº’ã€‚
- ç¬¬ä¸‰æ–¹æœåŠ¡ï¼šåŒ…æ‹¬å…¶å®ƒéƒ¨é—¨ RPC æœåŠ¡æ¥å£ï¼ŒåŸºç¡€å¹³å°ï¼Œå…¶å®ƒå…¬å¸çš„ HTTP æ¥å£ï¼Œå¦‚æ·˜å®å¼€æ”¾å¹³å°ã€æ”¯ä»˜å®ä»˜æ¬¾æœåŠ¡ã€é«˜å¾·åœ°å›¾æœåŠ¡ç­‰ã€‚
- å¤–éƒ¨æ¥å£ï¼šå¤–éƒ¨ï¼ˆåº”ç”¨ï¼‰æ•°æ®å­˜å‚¨æœåŠ¡æä¾›çš„æ¥å£ï¼Œå¤šè§äºæ•°æ®è¿ç§»åœºæ™¯ä¸­ã€‚

å¦‚æœä»ä¸€ä¸ªç”¨æˆ·è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æƒ…å†µæ¥çœ‹ï¼Œå¯¹åº”ç€ä¸Šé¢çš„é¡¹ç›®ä»£ç ç»“æ„æ¥åˆ†æï¼Œå¯ä»¥è´¯ç©¿æ•´ä¸ªä»£ç åˆ†å±‚ï¼š

![img](https://cdn.xiaolincoding.com//picgo/1721712159282-79195670-9acf-4bfb-93b1-47d089a4bc1c.png)

å¯¹åº”ä»£ç ç›®å½•çš„æµè½¬é€»è¾‘å°±æ˜¯ï¼š

![img](https://cdn.xiaolincoding.com//picgo/1721712166152-4774fdac-cb1e-4fb1-929e-3ae130145aa8.png)

æ‰€ä»¥ï¼Œä»¥åæ¯å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ–°çš„é¡¹ç›®åˆ°æ‰‹æ—¶ï¼Œåªè¦æŒ‰ç…§è¿™ä¸ªæ€è·¯å»çœ‹åˆ«äººé¡¹ç›®çš„ä»£ç ï¼Œåº”è¯¥åŸºæœ¬éƒ½æ˜¯èƒ½ç†å¾—é¡ºçš„ã€‚

------

### SpringBootè‡ªåŠ¨è£…é…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ

SpringBoot çš„è‡ªåŠ¨è£…é…åŸç†æ˜¯åŸºäºSpring Frameworkçš„æ¡ä»¶åŒ–é…ç½®å’Œ==@EnableAutoConfiguration==æ³¨è§£å®ç°çš„ã€‚è¿™ç§æœºåˆ¶å…è®¸å¼€å‘è€…åœ¨é¡¹ç›®ä¸­å¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼ŒSpringBoot å°†æ ¹æ®è¿™äº›ä¾èµ–è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡å’ŒåŠŸèƒ½ã€‚

SpringBoot å®šä¹‰äº†ä¸€å¥—æ¥å£è§„èŒƒï¼Œè¿™å¥—è§„èŒƒè§„å®šï¼š==SpringBoot åœ¨å¯åŠ¨æ—¶ä¼šæ‰«æå¤–éƒ¨å¼•ç”¨ jar åŒ…ä¸­çš„META-INF/spring.factoriesæ–‡ä»¶==ï¼Œå°†æ–‡ä»¶ä¸­é…ç½®çš„ç±»å‹ä¿¡æ¯åŠ è½½åˆ° Spring å®¹å™¨ï¼ˆæ­¤å¤„æ¶‰åŠåˆ° JVM ç±»åŠ è½½æœºåˆ¶ä¸ Spring çš„å®¹å™¨çŸ¥è¯†ï¼‰ï¼Œå¹¶æ‰§è¡Œç±»ä¸­å®šä¹‰çš„å„ç§æ“ä½œã€‚å¯¹äºå¤–éƒ¨ jar æ¥è¯´ï¼Œåªéœ€è¦æŒ‰ç…§ SpringBoot å®šä¹‰çš„æ ‡å‡†ï¼Œå°±èƒ½å°†è‡ªå·±çš„åŠŸèƒ½è£…ç½®è¿› SpringBootã€‚

é€šä¿—æ¥è®²ï¼Œè‡ªåŠ¨è£…é…å°±æ˜¯é€šè¿‡æ³¨è§£æˆ–ä¸€äº›ç®€å•çš„é…ç½®å°±å¯ä»¥åœ¨SpringBootçš„å¸®åŠ©ä¸‹å¼€å¯å’Œé…ç½®å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚æ•°æ®åº“è®¿é—®ã€Webå¼€å‘ã€‚

**è‡ªåŠ¨è£…é…çš„ç›®çš„**

Spring Boot çš„æ ¸å¿ƒç†å¿µä¹‹ä¸€æ˜¯ **å¼€ç®±å³ç”¨**ï¼š

- ä¸æƒ³æ¯æ¬¡éƒ½æ‰‹åŠ¨å†™ DataSourceã€MessageSourceã€RedisTemplate ç­‰é…ç½®ã€‚
- è‡ªåŠ¨è£…é…å°±æ˜¯ **æ ¹æ® classpath ä¾èµ–ã€é…ç½®æ–‡ä»¶ã€Bean å­˜åœ¨æƒ…å†µè‡ªåŠ¨åˆ›å»º Bean**ã€‚

> SpringBootè‡ªåŠ¨è£…é…åŸç†

é¦–å…ˆç‚¹è¿› `@SpringBootApplication` æ³¨è§£çš„å†…éƒ¨

![img](https://cdn.xiaolincoding.com//picgo/1719493065090-4ce24f82-8f39-4aa6-b399-671e68e9c18f.png)

æ¥ä¸‹æ¥å°†é€ä¸ªè§£é‡Šè¿™äº›æ³¨è§£çš„ä½œç”¨ï¼š

- `@Target({ElementType.TYPE})`: è¯¥æ³¨è§£æŒ‡å®šäº†è¿™ä¸ªæ³¨è§£å¯ä»¥ç”¨æ¥æ ‡è®°åœ¨ç±»ä¸Šã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œè¿™è¡¨ç¤ºè¯¥æ³¨è§£ç”¨äºæ ‡è®°é…ç½®ç±»ã€‚
- `@Retention(RetentionPolicy.RUNTIME)`: è¿™ä¸ªæ³¨è§£æŒ‡å®šäº†æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³åœ¨è¿è¡Œæ—¶ä¿ç•™ã€‚è¿™æ˜¯å› ä¸º Spring Boot åœ¨è¿è¡Œæ—¶æ‰«æç±»è·¯å¾„ä¸Šçš„æ³¨è§£æ¥å®ç°è‡ªåŠ¨é…ç½®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº† RUNTIME ä¿ç•™ç­–ç•¥ã€‚
- `@Documented`: è¯¥æ³¨è§£è¡¨ç¤ºè¿™ä¸ªæ³¨è§£åº”è¯¥è¢«åŒ…å«åœ¨ Java æ–‡æ¡£ä¸­ã€‚å®ƒæ˜¯ç”¨äºç”Ÿæˆæ–‡æ¡£çš„æ ‡è®°ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªæ³¨è§£çš„ç›¸å…³ä¿¡æ¯ã€‚
- `@Inherited`: è¿™ä¸ªæ³¨è§£æŒ‡ç¤ºä¸€ä¸ªè¢«æ ‡æ³¨çš„ç±»å‹æ˜¯è¢«ç»§æ‰¿çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè¡¨æ˜è¿™ä¸ªæ³¨è§£å¯ä»¥è¢«ç»§æ‰¿ï¼Œå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†å¸¦æœ‰è¿™ä¸ªæ³¨è§£çš„ç±»ï¼Œå®ƒä¹Ÿä¼šç»§æ‰¿è¿™ä¸ªæ³¨è§£ã€‚
- `@SpringBootConfiguration`: è¿™ä¸ªæ³¨è§£è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»ã€‚å¦‚æœç‚¹è¿›è¿™ä¸ªæ³¨è§£å†…éƒ¨ä¼šå‘ç°ä¸æ ‡å‡†çš„ @Configuration æ²¡å•¥åŒºåˆ«ï¼Œåªæ˜¯ä¸ºäº†è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äº SpringBoot çš„é…ç½®ã€‚
- `@EnableAutoConfiguration`: è¿™ä¸ªæ³¨è§£æ˜¯ Spring Boot è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒã€‚å®ƒå‘Šè¯‰ Spring oot å¯ç”¨è‡ªåŠ¨é…ç½®æœºåˆ¶ï¼Œæ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œé…ç½®è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™ä¸ªæ³¨è§£ï¼ŒSpringBoot å°†å°è¯•æ ¹æ®ç±»è·¯å¾„ä¸Šçš„ä¾èµ–è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºã€‚
- `@ComponentScan`: è¿™ä¸ªæ³¨è§£ç”¨äºé…ç½®ç»„ä»¶æ‰«æçš„è§„åˆ™ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå‘Šè¯‰ SpringBoot åœ¨æŒ‡å®šçš„åŒ…åŠå…¶å­åŒ…ä¸­æŸ¥æ‰¾ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åŒ…æ‹¬è¢«æ³¨è§£çš„ç±»ã€@Component æ³¨è§£çš„ç±»ç­‰ã€‚å…¶ä¸­çš„ excludeFilters å‚æ•°ç”¨äºæŒ‡å®šæ’é™¤å“ªäº›ç»„ä»¶ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼Œåˆ†åˆ«æ˜¯ TypeExcludeFilter å’Œ AutoConfigurationExcludeFilterã€‚

`@EnableAutoConfiguration` ==è¿™ä¸ªæ³¨è§£æ˜¯å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£==

![img](https://cdn.xiaolincoding.com//picgo/1719495511568-bc5f9e21-9e2c-4888-91a8-4048058ff408.png)

- @AutoConfigurationPackageï¼Œå°†é¡¹ç›®srcä¸­mainåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œä¾‹å¦‚æ ‡æ³¨äº†Componentæ³¨è§£çš„ç±»ç­‰
- @Import({AutoConfigurationImportSelector.class})ï¼Œæ˜¯è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ³¨è§£

AutoConfigurationImportSelector æ˜¯ Spring Boot ä¸­ä¸€ä¸ªé‡è¦çš„ç±»ï¼Œå®ƒå®ç°äº† ImportSelector æ¥å£ï¼Œç”¨äºå®ç°è‡ªåŠ¨é…ç½®çš„é€‰æ‹©å’Œå¯¼å…¥ã€‚å…·ä½“æ¥è¯´ï¼Œ==å®ƒé€šè¿‡åˆ†æé¡¹ç›®çš„ç±»è·¯å¾„å’Œæ¡ä»¶æ¥å†³å®šåº”è¯¥å¯¼å…¥å“ªäº›è‡ªåŠ¨é…ç½®ç±»ã€‚==

ä»£ç å¤ªå¤šï¼Œé€‰å–éƒ¨åˆ†ä¸»è¦åŠŸèƒ½çš„ä»£ç ï¼š

```java
public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware,
		ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered {
    
    // ... ï¼ˆå…¶ä»–æ–¹æ³•å’Œå±æ€§ï¼‰

  // è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»çš„å…¨é™å®šç±»åï¼Œä¾‹å¦‚RedisTemplateçš„å…¨é™å®šç±»å(org.springframework.data.redis.core.RedisTemplate;)ï¼Œè¿™äº›ç±»éœ€è¦è¢«åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚
	@Override
	public String[] selectImports(AnnotationMetadata annotationMetadata) {
		// æ‰«æç±»è·¯å¾„ä¸Šçš„ META-INF/spring.factories æ–‡ä»¶ï¼Œè·å–æ‰€æœ‰å®ç°äº† AutoConfiguration æ¥å£çš„è‡ªåŠ¨é…ç½®ç±»
		List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

		// è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ä¸€äº›è‡ªåŠ¨è£…é…ç±»
		configurations = filter(configurations, annotationMetadata, attributes);

		// æ’åºè‡ªåŠ¨é…ç½®ç±»ï¼Œæ ¹æ® @AutoConfigureOrder å’Œ @AutoConfigureAfter/@AutoConfigureBefore æ³¨è§£æŒ‡å®šçš„é¡ºåº
		sort(configurations, annotationMetadata, attributes);

		// å°†æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»çš„ç±»åæ•°ç»„è¿”å›ï¼Œè¿™äº›ç±»å°†è¢«å¯¼å…¥åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­
		return StringUtils.toStringArray(configurations);
	}

	// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰
	protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
		// è·å–è‡ªåŠ¨é…ç½®ç±»çš„å€™é€‰åˆ—è¡¨ï¼Œä» META-INF/spring.factories æ–‡ä»¶ä¸­è¯»å–
		// é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½æ‰€æœ‰å€™é€‰ç±»
		List<String> configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),
				getBeanClassLoader());

		// è¿‡æ»¤å‡ºå®ç°äº† AutoConfiguration æ¥å£çš„è‡ªåŠ¨é…ç½®ç±»
		configurations = configurations.stream()
				.filter(this::isEnabled)
				.collect(Collectors.toList());

		// å¯¹äº Spring Boot 1.x ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦æ·»åŠ  spring-boot-autoconfigure åŒ…ä¸­çš„è‡ªåŠ¨é…ç½®ç±»
		// configurations.addAll(getAutoConfigEntry(getAutoConfigurationEntry(metadata)));
		return configurations;
	}

	// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰
	protected List<String> filter(List<String> configurations, AnnotationMetadata metadata,
			AnnotationAttributes attributes) {
		// ä½¿ç”¨æ¡ä»¶åˆ¤æ–­æœºåˆ¶ï¼Œè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»
		configurations = configurations.stream()
				.filter(configuration -> isConfigurationCandidate(configuration, metadata, attributes))
				.collect(Collectors.toList());
		return configurations;
	}

	// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰
	protected void sort(List<String> configurations, AnnotationMetadata metadata,
			AnnotationAttributes attributes) {
		// æ ¹æ® @AutoConfigureOrder å’Œ @AutoConfigureAfter/@AutoConfigureBefore æ³¨è§£æŒ‡å®šçš„é¡ºåºå¯¹è‡ªåŠ¨é…ç½®ç±»è¿›è¡Œæ’åº
		configurations.sort((o1, o2) -> {
			int i1 = getAutoConfigurationOrder(o1, metadata, attributes);
			int i2 = getAutoConfigurationOrder(o2, metadata, attributes);
			return Integer.compare(i1, i2);
		});
	}
  
  	// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰

}
```

æ¢³ç†ä¸€ä¸‹ï¼Œä»¥ä¸‹æ˜¯`AutoConfigurationImportSelector`çš„ä¸»è¦å·¥ä½œï¼š

- æ‰«æç±»è·¯å¾„: åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œ`AutoConfigurationImportSelector` ä¼šæ‰«æç±»è·¯å¾„ä¸Šçš„ `META-INF/spring.factories` æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†å„ç§ Spring é…ç½®å’Œæ‰©å±•çš„å®šä¹‰ã€‚åœ¨è¿™é‡Œï¼Œå®ƒä¼šæŸ¥æ‰¾æ‰€æœ‰å®ç°äº† `AutoConfiguration` æ¥å£çš„ç±»,å…·ä½“çš„å®ç°ä¸º`getCandidateConfigurations`æ–¹æ³•ã€‚
- æ¡ä»¶åˆ¤æ–­: å¯¹äºæ¯ä¸€ä¸ªå‘ç°çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œ`AutoConfigurationImportSelector` ä¼šä½¿ç”¨æ¡ä»¶åˆ¤æ–­æœºåˆ¶ï¼ˆé€šå¸¸æ˜¯é€šè¿‡ `@ConditionalOnXxx`æ³¨è§£ï¼‰æ¥ç¡®å®šæ˜¯å¦æ»¡è¶³å¯¼å…¥æ¡ä»¶ã€‚è¿™äº›æ¡ä»¶å¯ä»¥æ˜¯é…ç½®å±æ€§ã€ç±»æ˜¯å¦å­˜åœ¨ã€Beanæ˜¯å¦å­˜åœ¨ç­‰ç­‰ã€‚
- æ ¹æ®æ¡ä»¶å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»: æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»å°†è¢«å¯¼å…¥åˆ°åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¼šè¢«å®ä¾‹åŒ–å¹¶åº”ç”¨äºåº”ç”¨ç¨‹åºçš„é…ç½®ã€‚

> > **ä¸æ˜¯ã€‚Spring Boot çš„â€œè‡ªåŠ¨è£…é…ï¼ˆAuto-configurationï¼‰â€ â‰  é€šè¿‡æ„é€ å™¨ / setter / `@Autowired` æ³¨å…¥ Beanã€‚**
>
> é‚£æ˜¯ **Spring Framework çš„â€œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰â€æˆ–â€œè‡ªåŠ¨è£…é…ï¼ˆAuto-wiringï¼‰â€**ã€‚
>
> ---
>
> ### âœ… æ­£ç¡®åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µï¼š
>
> ---
>
> #### 1ï¸âƒ£ Spring Framework çš„â€œè‡ªåŠ¨è£…é…ï¼ˆAuto-wiringï¼‰â€
>
> ### ğŸ“Œ å®šä¹‰ï¼š
> æŒ‡ Spring å®¹å™¨**è‡ªåŠ¨å°†ä¾èµ–çš„ Bean æ³¨å…¥åˆ°ç›®æ ‡ Bean ä¸­**ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚
>
> ### ğŸ§© å®ç°æ–¹å¼ï¼š
>
> - `@Autowired`ï¼ˆå­—æ®µã€æ„é€ å™¨ã€æ–¹æ³•ï¼‰
> - `@Resource`ï¼ˆæŒ‰åç§°æ³¨å…¥ï¼‰
> - XML ä¸­çš„ `autowire="byType"` æˆ– `byName`
>
> ### ğŸ¯ ä½œç”¨ï¼š
> **è§£å†³â€œBean ä¹‹é—´çš„ä¾èµ–å…³ç³»â€ â€”â€” å³â€œè¿çº¿â€é—®é¢˜ã€‚**
>
> #### âœ… ç¤ºä¾‹ï¼š
>
> ```java
> @Service
> public class OrderService {
> 
>     @Autowired
>     private UserService userService; // â† è¿™æ˜¯ Spring çš„â€œè‡ªåŠ¨è£…é…â€ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
> 
>     public void createOrder() {
>         userService.validate();
>     }
> }
> ```
>
> > ğŸ’¡ è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨ **Bean å®ä¾‹åŒ–ä¹‹åã€åˆå§‹åŒ–ä¹‹å‰**ï¼Œç”± `AutowiredAnnotationBeanPostProcessor` å¤„ç†ã€‚
>
> ---
>
> ### 2ï¸âƒ£ Spring Boot çš„â€œè‡ªåŠ¨è£…é…ï¼ˆAuto-configurationï¼‰â€
>
> #### ğŸ“Œ å®šä¹‰ï¼š
> æŒ‡ Spring Boot **æ ¹æ® classpathã€é…ç½®ã€æ¡ä»¶æ³¨è§£ï¼Œè‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å†Œ Bean åˆ°å®¹å™¨ä¸­**ã€‚
>
> #### ğŸ§© å®ç°æœºåˆ¶ï¼š
>
> - åŸºäº `META-INF/spring.factories` ä¸­çš„ `EnableAutoConfiguration` æ¡ç›®
> - ä½¿ç”¨ `@Conditional...` æ³¨è§£ï¼ˆå¦‚ `@ConditionalOnClass`, `@ConditionalOnMissingBean`ï¼‰æŒ‰æ¡ä»¶æ³¨å†Œ Bean
> - æ— éœ€ä½ æ‰‹åŠ¨å†™ `@Bean` æˆ– XML é…ç½®
>
> #### ğŸ¯ ä½œç”¨ï¼š
> **è§£å†³â€œBean ä»å“ªæ¥â€çš„é—®é¢˜ â€”â€” å³â€œé€ è½®å­â€é—®é¢˜ã€‚**
>
> #### âœ… ç¤ºä¾‹ï¼š
>
> ```java
> // è¿™æ˜¯ Spring Boot è‡ªåŠ¨é…ç½®ç±»ï¼ˆé€šå¸¸åœ¨ starter åŒ…é‡Œï¼‰
> @Configuration
> @ConditionalOnClass(DataSource.class)
> @ConditionalOnMissingBean(DataSource.class)
> public class DataSourceAutoConfiguration {
> 
>     @Bean
>     public DataSource dataSource() {
>         return new HikariDataSource(); // â† Spring Boot è‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å†Œè¿™ä¸ª Bean
>     }
> }
> ```
>
> > ğŸ’¡ å½“ä½ å¼•å…¥ `spring-boot-starter-jdbc`ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® `DataSource`ã€`JdbcTemplate` ç­‰ Bean â€”â€” **è¿™å°±æ˜¯â€œè‡ªåŠ¨è£…é…â€ï¼ˆAuto-configurationï¼‰**ã€‚
>
> ---
>
> ### ğŸ†š å¯¹æ¯”æ€»ç»“è¡¨
>
> | ç‰¹æ€§                  | Spring Framework è‡ªåŠ¨è£…é…ï¼ˆAuto-wiringï¼‰     | Spring Boot è‡ªåŠ¨è£…é…ï¼ˆAuto-configurationï¼‰                   |
> | --------------------- | -------------------------------------------- | ------------------------------------------------------------ |
> | ä¸­æ–‡å¸¸ç§°              | ä¾èµ–æ³¨å…¥ / è‡ªåŠ¨æ³¨å…¥                          | è‡ªåŠ¨é…ç½®                                                     |
> | è‹±æ–‡æœ¯è¯­              | Auto-wiring                                  | Auto-configuration                                           |
> | æ ¸å¿ƒç›®çš„              | **æ³¨å…¥å·²å­˜åœ¨çš„ Bean ä¾èµ–**ï¼ˆè¿çº¿ï¼‰           | **è‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å†Œ Bean**ï¼ˆé€ è½®å­ï¼‰                            |
> | è§¦å‘æ³¨è§£              | `@Autowired`, `@Resource`, `@Inject`         | `@EnableAutoConfiguration`, `@Conditional...`                |
> | é…ç½®æ–‡ä»¶              | æ— ç‰¹å®šæ–‡ä»¶                                   | `META-INF/spring.factories`                                  |
> | å‘ç”Ÿæ—¶æœº              | Bean åˆå§‹åŒ–é˜¶æ®µï¼ˆpopulate propertiesï¼‰       | Spring Boot å¯åŠ¨é˜¶æ®µï¼ˆåœ¨ refresh context ä¹‹å‰ï¼‰              |
> | æ˜¯å¦éœ€è¦æ‰‹åŠ¨å®šä¹‰ Bean | âœ… éœ€è¦ï¼ˆé€šè¿‡ `@Component`, `@Bean`, XML ç­‰ï¼‰ | âŒ ä¸éœ€è¦ï¼ˆæ¡ä»¶æ»¡è¶³æ—¶è‡ªåŠ¨åˆ›å»ºï¼‰                               |
> | ç¤ºä¾‹                  | `@Autowired UserService userService`         | è‡ªåŠ¨é…ç½® `DataSource`, `RedisTemplate`, `WebMvcConfigurer` ç­‰ |
>
> ---
>
> ### ğŸ¯ ä¸¾ä¸ªå®Œæ•´ä¾‹å­è¯´æ˜åŒºåˆ«ï¼š
>
> ```java
> // 1. Spring Boot è‡ªåŠ¨é…ç½® â€”â€” è‡ªåŠ¨åˆ›å»º RedisTemplate Bean
> // â† æ¥è‡ª spring-boot-starter-data-redis çš„è‡ªåŠ¨é…ç½®ç±»
> 
> // 2. Spring è‡ªåŠ¨è£…é… â€”â€” è‡ªåŠ¨æ³¨å…¥ä¸Šé¢åˆ›å»ºçš„ Bean
> @Service
> public class CacheService {
> 
>     @Autowired
>     private RedisTemplate redisTemplate; // â† è¿™æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆAuto-wiringï¼‰
> 
>     public void put(String key, String value) {
>         redisTemplate.opsForValue().set(key, value);
>     }
> }
> ```
>
> âœ… **Spring Boot è‡ªåŠ¨é…ç½®ï¼šåˆ›å»º `RedisTemplate` Bean**  
> âœ… **Spring è‡ªåŠ¨è£…é…ï¼šæŠŠ `RedisTemplate` æ³¨å…¥åˆ° `CacheService`**
>
> ---
>
> ### ğŸš« å¸¸è§è¯¯è§£çº æ­£ï¼š
>
> > â€œSpring Boot è‡ªåŠ¨è£…é…å°±æ˜¯ `@Autowired`â€ â†’ âŒ é”™ï¼
>
> - `@Autowired` æ˜¯ Spring Framework çš„â€œä¾èµ–æ³¨å…¥æœºåˆ¶â€ï¼Œæ—©åœ¨ Spring 2.5 å°±æœ‰äº†ã€‚
> - Spring Boot çš„â€œè‡ªåŠ¨è£…é…â€æ˜¯ Spring Boot 1.0ï¼ˆ2014ï¼‰å¼•å…¥çš„ï¼Œç”¨äº**è‡ªåŠ¨æ³¨å†Œ Bean**ï¼Œä¸æ˜¯æ³¨å…¥ã€‚
>
> ---
>
> ### âœï¸ æ€»ç»“ä¸€å¥è¯ï¼š
>
> > **Spring Boot çš„â€œè‡ªåŠ¨è£…é…â€æ˜¯â€œè‡ªåŠ¨åˆ›å»º Beanâ€ï¼ŒSpring Framework çš„â€œè‡ªåŠ¨è£…é…â€æ˜¯â€œè‡ªåŠ¨æ³¨å…¥ Beanâ€ â€”â€” å‰è€…æ˜¯â€œç”Ÿäº§è€…â€ï¼Œåè€…æ˜¯â€œæ¶ˆè´¹è€…â€ã€‚**
>
> ---
>
> ğŸ§  ç†è§£è¿™ä¸ªåŒºåˆ«ï¼Œä½ å°±å½»åº•ææ‡‚äº† Spring ç”Ÿæ€ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªâ€œè‡ªåŠ¨åŒ–â€æœºåˆ¶ï¼
>
> é¢è¯•ã€æ¶æ„è®¾è®¡ã€æºç é˜…è¯»æ—¶ï¼Œå†ä¹Ÿä¸ä¼šæ··æ·†äº†ï¼
>
> å¦‚éœ€æˆ‘ç”¨å›¾è§£æˆ–æºç æ–¹å¼è¿›ä¸€æ­¥å‰–æ `@EnableAutoConfiguration` å·¥ä½œåŸç†ï¼Œæ¬¢è¿ç»§ç»­æé—® ğŸ˜Š

------

### è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼ˆstarter)ï¼Ÿ

- **spring-boot-starter-web**ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„èµ·æ­¥ä¾èµ–ä¹‹ä¸€ï¼Œå®ƒåŒ…å«äº†Spring MVCå’ŒTomcatåµŒå…¥å¼æœåŠ¡å™¨ï¼Œç”¨äºå¿«é€Ÿæ„å»ºWebåº”ç”¨ç¨‹åºã€‚
- **spring-boot-starter-security**ï¼šæä¾›äº†Spring Securityçš„åŸºæœ¬é…ç½®ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®ç°åº”ç”¨çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬è®¤è¯å’ŒæˆæƒåŠŸèƒ½ã€‚
- **mybatis-spring-boot-starter**ï¼šè¿™ä¸ªStarteræ˜¯ç”±MyBatiså›¢é˜Ÿæä¾›çš„ï¼Œç”¨äºç®€åŒ–åœ¨Spring Bootåº”ç”¨ä¸­é›†æˆMyBatisçš„è¿‡ç¨‹ã€‚å®ƒè‡ªåŠ¨é…ç½®äº†MyBatisçš„ç›¸å…³ç»„ä»¶ï¼ŒåŒ…æ‹¬SqlSessionFactoryã€MapperScannerConfigurerç­‰ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿåœ°å¼€å§‹ä½¿ç”¨MyBatisè¿›è¡Œæ•°æ®åº“æ“ä½œã€‚
- **spring-boot-starter-data-jpa** æˆ– **spring-boot-starter-jdbc**ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯Java Persistence API (JPA)è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨spring-boot-starter-data-jpaã€‚è¿™ä¸ªStarteråŒ…å«äº†Hibernateç­‰JPAå®ç°ä»¥åŠæ•°æ®åº“è¿æ¥æ± ç­‰å¿…è¦çš„åº“ï¼Œå¯ä»¥è®©ä½ è½»æ¾åœ°ä¸MySQLæ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚ä½ éœ€è¦åœ¨application.propertiesæˆ–application.ymlä¸­é…ç½®MySQLçš„è¿æ¥ä¿¡æ¯ã€‚å¦‚æœå€¾å‘äºç›´æ¥ä½¿ç”¨JDBCè€Œä¸é€šè¿‡JPAï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨spring-boot-starter-jdbcï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„JDBCæ”¯æŒã€‚
- **spring-boot-starter-data-redis**ï¼šç”¨äºé›†æˆRedisç¼“å­˜å’Œæ•°æ®å­˜å‚¨æœåŠ¡ã€‚è¿™ä¸ªStarteråŒ…å«äº†ä¸Redisäº¤äº’æ‰€éœ€çš„å®¢æˆ·ç«¯ï¼ˆé»˜è®¤æ˜¯Jediså®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸ºLettuceå®¢æˆ·ç«¯ï¼‰ï¼Œä»¥åŠSpring Data Redisçš„æ”¯æŒï¼Œä½¿å¾—åœ¨Spring Bootåº”ç”¨ä¸­ä½¿ç”¨Rediså˜å¾—éå¸¸ä¾¿æ·ã€‚åŒæ ·åœ°ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®RedisæœåŠ¡å™¨çš„è¿æ¥è¯¦æƒ…ã€‚
- **spring-boot-starter-test**ï¼šåŒ…å«äº†å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ‰€éœ€çš„åº“ï¼Œå¦‚JUnit, Spring Test, AssertJç­‰ï¼Œä¾¿äºè¿›è¡Œæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)ã€‚

------

### SpringBoot è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨è¯´ä¸€ä¸‹ï¼Ÿ

åœ¨ Spring Boot ä¸­ï¼Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ˜¯ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„ä¸¤ç§ä¸åŒæœºåˆ¶ã€‚

| **ç‰¹æ€§**         | **è¿‡æ»¤å™¨ï¼ˆFilterï¼‰**                  | **æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰**                                    |
| ---------------- | ------------------------------------- | ------------------------------------------------------------ |
| **è§„èŒƒ/æ¡†æ¶**    | Servletè§„èŒƒï¼ˆ`javax.servlet.Filter`ï¼‰ | Spring MVCæ¡†æ¶ï¼ˆ`org.springframework.web.servlet.HandlerInterceptor`ï¼‰ |
| **ä½œç”¨èŒƒå›´**     | å…¨å±€ï¼ˆæ‰€æœ‰è¯·æ±‚ã€é™æ€èµ„æºï¼‰            | Controllerå±‚ï¼ˆä»…æ‹¦æˆªSpringç®¡ç†çš„è¯·æ±‚ï¼‰                       |
| **æ‰§è¡Œé¡ºåº**     | åœ¨Servletä¹‹å‰æ‰§è¡Œ                     | åœ¨DispatcherServletä¹‹åã€Controlleræ–¹æ³•å‰åæ‰§è¡Œ              |
| **ä¾èµ–æ³¨å…¥æ”¯æŒ** | æ— æ³•ç›´æ¥æ³¨å…¥Spring Beanï¼ˆéœ€é—´æ¥è·å–ï¼‰ | æ”¯æŒè‡ªåŠ¨æ³¨å…¥Spring Bean                                      |
| **è§¦å‘æ—¶æœº**     | `doFilter()`åœ¨è¯·æ±‚å‰/å“åº”åè¢«è°ƒç”¨     | `preHandle`ã€`postHandle`ã€`afterCompletion`åˆ†é˜¶æ®µè§¦å‘       |
| **é€‚ç”¨åœºæ™¯**     | å…¨å±€è¯·æ±‚å¤„ç†ï¼ˆç¼–ç ã€æ—¥å¿—ã€å®‰å…¨ï¼‰      | ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„å¤„ç†ï¼ˆæƒé™ã€å‚æ•°æ ¡éªŒï¼‰                         |

è¿‡æ»¤å™¨æ˜¯ Java Servlet è§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å¯¹è¿›å…¥ Servlet å®¹å™¨çš„è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ã€‚è¿‡æ»¤å™¨é€šè¿‡å®ç° `javax.servlet.Filter` æ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­çš„ `init`ã€`doFilter` å’Œ `destroy` æ–¹æ³•æ¥å®Œæˆç›¸åº”çš„é€»è¾‘ã€‚å½“è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨æ—¶ï¼Œä¼šæŒ‰ç…§é…ç½®çš„é¡ºåºä¾æ¬¡ç»è¿‡å„ä¸ªè¿‡æ»¤å™¨ï¼Œç„¶åå†åˆ°è¾¾ç›®æ ‡ Servlet æˆ–æ§åˆ¶å™¨ï¼›å“åº”è¿”å›æ—¶ï¼Œä¹Ÿä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºå†æ¬¡ç»è¿‡è¿™äº›è¿‡æ»¤å™¨ã€‚

æ‹¦æˆªå™¨æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå¯ä»¥å¯¹æ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œè¿›è¡Œæ‹¦æˆªã€‚æ‹¦æˆªå™¨é€šè¿‡å®ç° `org.springframework.web.servlet.HandlerInterceptor` æ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­çš„ `preHandle`ã€`postHandle` å’Œ `afterCompletion` æ–¹æ³•æ¥å®Œæˆç›¸åº”çš„é€»è¾‘ã€‚==å½“è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨æ—¶ï¼Œä¼šå…ˆç»è¿‡æ‹¦æˆªå™¨çš„ `preHandle` æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› `true`ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­çš„æ§åˆ¶å™¨æ–¹æ³•å’Œå…¶ä»–æ‹¦æˆªå™¨ï¼›åœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œä¼šè°ƒç”¨æ‹¦æˆªå™¨çš„ `postHandle` æ–¹æ³•ï¼›æœ€åï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œä¼šè°ƒç”¨æ‹¦æˆªå™¨çš„ `afterCompletion` æ–¹æ³•ã€‚==

è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„åŒºåˆ«å¦‚ä¸‹ï¼š

- **æ‰€å±è§„èŒƒ**ï¼šè¿‡æ»¤å™¨æ˜¯ Java Servlet è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ‹¦æˆªå™¨æ˜¯ Spring æ¡†æ¶æä¾›çš„æœºåˆ¶ã€‚
- **æ‰§è¡Œé¡ºåº**ï¼šè¿‡æ»¤å™¨åœ¨è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨åï¼Œåœ¨åˆ°è¾¾ç›®æ ‡ Servlet æˆ–æ§åˆ¶å™¨ä¹‹å‰æ‰§è¡Œï¼›æ‹¦æˆªå™¨åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹åï¼Œåœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œã€‚
- **ä½¿ç”¨èŒƒå›´**ï¼šè¿‡æ»¤å™¨å¯ä»¥å¯¹æ‰€æœ‰ç±»å‹çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼ŒåŒ…æ‹¬é™æ€èµ„æºè¯·æ±‚ï¼›æ‹¦æˆªå™¨åªèƒ½å¯¹ Spring MVC æ§åˆ¶å™¨çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚
- **åŠŸèƒ½ç‰¹æ€§**ï¼šè¿‡æ»¤å™¨ä¸»è¦ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ï¼Œå¦‚å­—ç¬¦ç¼–ç å¤„ç†ã€è¯·æ±‚æ—¥å¿—è®°å½•ç­‰ï¼›æ‹¦æˆªå™¨å¯ä»¥æ›´ç»†ç²’åº¦åœ°æ§åˆ¶æ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œï¼Œå¦‚æƒé™éªŒè¯ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚

```
Servlet å®¹å™¨
   â†“
Filterï¼ˆjavax.servlet.Filterï¼‰
   â†“
DispatcherServlet
   â†“
HandlerInterceptor.preHandle()
   â†“
Controller
   â†“
HandlerInterceptor.postHandle()
   â†“
HandlerInterceptor.afterCompletion()
   â†“
è¿”å›å“åº”
```

------

## Mybatis

### MyBatisè§‰å¾—åœ¨å“ªæ–¹é¢åšçš„æ¯”è¾ƒå¥½ï¼Ÿ

MyBatis åœ¨ **SQL çµæ´»æ€§**ã€**åŠ¨æ€ SQL æ”¯æŒ**ã€**ç»“æœé›†æ˜ å°„**å’Œ**ä¸ Spring æ•´åˆ**æ–¹é¢è¡¨ç°å“è¶Šï¼Œå°¤å…¶é€‚åˆé‡è§† SQL å¯æ§æ€§çš„é¡¹ç›®ã€‚

- SQL ä¸ä»£ç è§£è€¦ï¼Œ==çµæ´»å¯æ§ï¼šMyBatis å…è®¸å¼€å‘è€…ç›´æ¥ç¼–å†™å’Œä¼˜åŒ– SQLï¼Œç›¸æ¯”å…¨è‡ªåŠ¨ ORMï¼ˆå¦‚ Hibernateï¼‰==ï¼ŒMyBatis è®©å¼€å‘è€…æ˜ç¡®çŸ¥é“æ¯æ¡ SQL çš„æ‰§è¡Œé€»è¾‘ï¼Œä¾¿äºæ€§èƒ½è°ƒä¼˜ã€‚

```java
<!-- ç¤ºä¾‹ï¼šXML ä¸­å®šä¹‰ SQL -->
<select id="findUserWithRole" resultMap="userRoleMap">
    SELECT u.*, r.role_name 
    FROM user u 
    LEFT JOIN user_role ur ON u.id = ur.user_id
    LEFT JOIN role r ON ur.role_id = r.id 
    WHERE u.id = #{userId}
</select>
```

- ==åŠ¨æ€ SQL== çš„å¼ºå¤§æ”¯æŒï¼šæ¯”å¦‚å¯ä»¥åŠ¨æ€æ‹¼æ¥SQLï¼Œé€šè¿‡ `<if>`, `<choose>`, `<foreach>` ç­‰æ ‡ç­¾åŠ¨æ€ç”Ÿæˆ SQLï¼Œé¿å… Java ä»£ç ä¸­ç¹ççš„å­—ç¬¦ä¸²æ‹¼æ¥ã€‚

```java
<select id="searchUsers" resultType="User">
    SELECT * FROM user
    <where>
        <if test="name != null">AND name LIKE #{name}</if>
        <if test="status != null">AND status = #{status}</if>
    </where>
</select>
```

- ==è‡ªåŠ¨æ˜ å°„ä¸è‡ªå®šä¹‰æ˜ å°„ç»“åˆ==ï¼šè‡ªåŠ¨å°†æŸ¥è¯¢ç»“æœå­—æ®µåä¸å¯¹è±¡å±æ€§ååŒ¹é…ï¼ˆå¦‚é©¼å³°è½¬æ¢ï¼‰ã€‚

```java
<resultMap id="userRoleMap" type="User">
    <id property="id" column="user_id"/>
    <result property="name" column="user_name"/>
    <collection property="roles" ofType="Role">
        <result property="roleName" column="role_name"/>
    </collection>
</resultMap>
```

- æ’ä»¶æ‰©å±•æœºåˆ¶ï¼šå¯ç¼–å†™==æ’ä»¶æ‹¦æˆª SQL æ‰§è¡Œè¿‡ç¨‹ï¼Œå®ç°åˆ†é¡µã€æ€§èƒ½ç›‘æ§ã€SQL æ”¹å†™ç­‰é€šç”¨é€»è¾‘ã€‚==

```java
@Intercepts({
    @Signature(type=Executor.class, method="query", args={...})
})
public class PaginationPlugin implements Interceptor {
    // å®ç°åˆ†é¡µé€»è¾‘
}
```

- ==ä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆ==ï¼šé€šè¿‡ `@MapperScan` å¿«é€Ÿæ‰«æ Mapper æ¥å£ï¼Œç»“åˆ Spring äº‹åŠ¡ç®¡ç†ï¼Œé…ç½®ç®€æ´é«˜æ•ˆã€‚

```java
@Configuration
@MapperScan("com.example.mapper")
public class MyBatisConfig {
    // æ•°æ®æºå’Œ SqlSessionFactory é…ç½®
}
```

------

### è¿˜è®°å¾—JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤å—ï¼Ÿ

ä½¿ç”¨Java JDBCè¿æ¥æ•°æ®åº“çš„ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š

1. **åŠ è½½æ•°æ®åº“é©±åŠ¨ç¨‹åº**ï¼šåœ¨ä½¿ç”¨JDBCè¿æ¥æ•°æ®åº“ä¹‹å‰ï¼Œéœ€è¦åŠ è½½ç›¸åº”çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚==å¯ä»¥é€šè¿‡ Class.forName("com.mysql.jdbc.Driver") æ¥åŠ è½½MySQLæ•°æ®åº“çš„é©±åŠ¨ç¨‹åº==ã€‚ä¸åŒæ•°æ®åº“çš„é©±åŠ¨ç±»åä¼šæœ‰æ‰€ä¸åŒã€‚
2. **å»ºç«‹æ•°æ®åº“è¿æ¥**ï¼šä½¿ç”¨ DriverManager ç±»çš„ ==getConnection(url, username, password) æ–¹æ³•æ¥è¿æ¥æ•°æ®åº“==ï¼Œå…¶ä¸­urlæ˜¯æ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬æ•°æ®åº“ç±»å‹ã€ä¸»æœºã€ç«¯å£ç­‰ï¼‰ã€usernameæ˜¯æ•°æ®åº“ç”¨æˆ·åï¼Œpasswordæ˜¯å¯†ç ã€‚
3. **åˆ›å»º Statement å¯¹è±¡**ï¼šé€šè¿‡ Connection å¯¹è±¡çš„ createStatement() æ–¹æ³•åˆ›å»ºä¸€ä¸ª ==Statement== å¯¹è±¡ï¼Œç”¨äº==æ‰§è¡Œ SQL== æŸ¥è¯¢æˆ–æ›´æ–°æ“ä½œã€‚
4. **æ‰§è¡Œ SQL æŸ¥è¯¢æˆ–æ›´æ–°æ“ä½œ**ï¼šä½¿ç”¨ Statement å¯¹è±¡çš„ ==executeQuery(sql)== æ–¹æ³•æ¥æ‰§è¡Œ SELECT æŸ¥è¯¢æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨ executeUpdate(sql) æ–¹æ³•æ¥æ‰§è¡Œ INSERTã€UPDATE æˆ– DELETE æ“ä½œã€‚
5. **å¤„ç†æŸ¥è¯¢ç»“æœ**ï¼šå¦‚æœæ˜¯ SELECT æŸ¥è¯¢æ“ä½œï¼Œ==é€šè¿‡ ResultSet å¯¹è±¡æ¥å¤„ç†æŸ¥è¯¢ç»“æœ==ã€‚å¯ä»¥ä½¿ç”¨ ResultSet çš„ next() æ–¹æ³•éå†æŸ¥è¯¢ç»“æœé›†ï¼Œç„¶åé€šè¿‡ getXXX() æ–¹æ³•è·å–å„ä¸ªå­—æ®µçš„å€¼ã€‚
6. **å…³é—­è¿æ¥**ï¼šåœ¨å®Œæˆæ•°æ®åº“æ“ä½œåï¼Œéœ€è¦é€çº§å…³é—­æ•°æ®åº“è¿æ¥ç›¸å…³å¯¹è±¡==ï¼Œå³å…ˆå…³é—­ ResultSetï¼Œå†å…³é—­ Statementï¼Œæœ€åå…³é—­ Connectionã€‚==

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š

```java
import java.sql.*;

public class Main {
    public static void main(String[] args) {
        try {
            // åŠ è½½æ•°æ®åº“é©±åŠ¨ç¨‹åº
            Class.forName("com.mysql.cj.jdbc.Driver");

            // å»ºç«‹æ•°æ®åº“è¿æ¥
            Connection connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/mydatabase", "username", "password");

            // åˆ›å»º Statement å¯¹è±¡
            Statement statement = connection.createStatement();

            // æ‰§è¡Œ SQL æŸ¥è¯¢
            ResultSet resultSet = statement.executeQuery("SELECT * FROM mytable");

            // å¤„ç†æŸ¥è¯¢ç»“æœ
            while (resultSet.next()) {
              // å¤„ç†æ¯ä¸€è¡Œæ•°æ®
            }

            // å…³é—­èµ„æº
            resultSet.close();
            statement.close();
            connection.close();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

è¯·æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ä»¥ç¡®ä¿èµ„æºçš„æ­£ç¡®é‡Šæ”¾ï¼Œä»¥åŠä½¿ç”¨ try-with-resources æ¥ç®€åŒ–ä»£ç å’Œç¡®ä¿èµ„æºçš„åŠæ—¶å…³é—­ã€‚

------

### Mybatisé‡Œçš„ # å’Œ $ çš„åŒºåˆ«ï¼Ÿ

- Mybatis åœ¨å¤„ç† #{} æ—¶ï¼Œ==ä¼šåˆ›å»ºé¢„ç¼–è¯‘çš„ SQL è¯­å¥ï¼Œå°† SQL ä¸­çš„ #{} æ›¿æ¢ä¸º ? å·==ï¼Œåœ¨æ‰§è¡Œ SQL æ—¶ä¼šä¸ºé¢„ç¼–è¯‘ SQL ä¸­çš„å ä½ç¬¦ï¼ˆ?ï¼‰èµ‹å€¼ï¼Œè°ƒç”¨ PreparedStatement çš„ set æ–¹æ³•æ¥èµ‹å€¼ï¼Œé¢„ç¼–è¯‘çš„ SQL è¯­å¥æ‰§è¡Œæ•ˆç‡é«˜ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢SQL æ³¨å…¥ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œé€‚åˆä¼ é€’å‚æ•°å€¼ã€‚
- Mybatis åœ¨å¤„ç† ${} æ—¶ï¼Œåªæ˜¯åˆ›å»ºæ™®é€šçš„ SQL è¯­å¥ï¼Œç„¶ååœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ ==MyBatis å°†å‚æ•°ç›´æ¥æ‹¼å…¥åˆ° SQL é‡Œï¼Œä¸èƒ½é˜²æ­¢ SQL æ³¨å…¥==ï¼Œå› ä¸ºå‚æ•°ç›´æ¥æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œå¦‚æœå‚æ•°æœªç»è¿‡éªŒè¯ã€è¿‡æ»¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜

> - **`#{}` å ä½ç¬¦**
>
>   - ä¼šè¢«æ›¿æ¢æˆä¸€ä¸ª **`?`** å ä½ç¬¦ï¼ˆå³ PreparedStatement å‚æ•°ï¼‰ï¼ŒMyBatis å†æŠŠå‚æ•°å®‰å…¨åœ°ç»‘å®šè¿›å»ã€‚
>   - è¿™æ˜¯**é¢„ç¼–è¯‘å‚æ•°ç»‘å®š**ï¼Œèƒ½é˜²æ­¢ SQL æ³¨å…¥ï¼Œæ¨èä½¿ç”¨ã€‚
>
>   ä¾‹å­ï¼š
>
>   ```sql
>   SELECT * FROM user WHERE id = #{id}
>   ```
>
>   ç”Ÿæˆ SQL:
>
>   ```sql
>   SELECT * FROM user WHERE id = ?
>   ```
>
>   ç„¶åç”¨ JDBC çš„ `ps.setInt(1, id)` ç»‘å®šã€‚
>
> - **`${}` å ä½ç¬¦**
>
>   - æ˜¯**å­—ç¬¦ä¸²æ‹¼æ¥**ï¼Œç›´æ¥æŠŠå€¼æ‹¼åˆ° SQL å­—ç¬¦ä¸²é‡Œã€‚
>   - ä¸ä¼šåšè½¬ä¹‰å’Œé¢„ç¼–è¯‘ï¼Œå®¹æ˜“ SQL æ³¨å…¥ï¼Œæ‰€ä»¥è¦è°¨æ…ã€‚
>
>   ä¾‹å­ï¼š
>
>   ```sql
>   SELECT * FROM ${tableName} WHERE ${column} = '${value}'
>   ```
>
>   å¦‚æœä¼ å‚æ˜¯ `tableName="user"`, `column="name"`, `value="Alice"`
>    é‚£ä¹ˆç”Ÿæˆ SQLï¼š
>
>   ```sql
>   SELECT * FROM user WHERE name = 'Alice'
>   ```
>
> ------
>
> ==ä»€ä¹ˆæ—¶å€™ **åªèƒ½ç”¨ `${}` è€Œä¸èƒ½ç”¨ `#{}`**==
>
> å› ä¸º `#{}` åªèƒ½æ›¿æ¢å€¼ï¼Œä¸ä¼šæ›¿æ¢ **SQL å…³é”®å­— / è¡¨å / åˆ—å / è¯­æ³•ç»“æ„**ï¼Œæ‰€ä»¥åœ¨è¿™äº›åœºæ™¯ä¸‹å¿…é¡»ç”¨ `${}`ï¼š
>
> 1. **åŠ¨æ€è¡¨åã€åˆ—å**
>
>    ```xml
>    <select id="select" resultType="User">
>        SELECT * FROM ${tableName} WHERE ${columnName} = #{value}
>    </select>
>    ```
>
>    - `tableName`ã€`columnName` ä¸èƒ½ç”¨ `#{}`ï¼Œå› ä¸º JDBC å ä½ç¬¦ `?` ä¸èƒ½æ”¾åœ¨è¡¨åæˆ–åˆ—åçš„ä½ç½®ã€‚
>    - `#{value}` æ˜¯å®‰å…¨çš„ï¼Œæ­£å¸¸ä½œä¸ºå‚æ•°ç»‘å®šã€‚
>
> 2. **åŠ¨æ€æ’åºï¼ˆORDER BYï¼‰**
>
>    ```xml
>    SELECT * FROM user ORDER BY ${orderColumn} ${orderDirection}
>    ```
>
>    - æ’åºçš„åˆ—åå’Œæ–¹å‘ï¼ˆASC / DESCï¼‰ä¸èƒ½ç”¨ `#{}`ï¼Œå› ä¸º SQL è¯­æ³•é‡Œä¸å…è®¸ `ORDER BY ?`ã€‚
>
> 3. **åŠ¨æ€ SQL ç‰‡æ®µ**
>
>    - æ¯”å¦‚æ³¨å…¥ä¸€ä¸ªæ•´æ®µ where æ¡ä»¶/å‡½æ•°åï¼š
>
>    ```xml
>    SELECT * FROM user WHERE ${condition}
>    ```
>
>    å¦‚æœä¼  `condition = "age > 20 AND status = 'ACTIVE'"`
>     æ‹¼æ¥åæ‰æ˜¯åˆæ³• SQLã€‚`#{}` åœ¨è¿™é‡Œä¼šç”Ÿæˆ `WHERE ?`ï¼Œå°±ä¸å¯¹äº†ã€‚
>
> 4. **DDL åœºæ™¯ï¼ˆå»ºè¡¨ã€æ”¹è¡¨ï¼‰**
>
>    ```xml
>    CREATE TABLE ${tableName} (id INT PRIMARY KEY, name VARCHAR(100))
>    ```
>
>    - è¡¨åã€åˆ—åå¿…é¡»ç”¨ `${}`ï¼Œå› ä¸º DDL ä¸æ”¯æŒå‚æ•°å ä½ç¬¦ã€‚
>
> ------
>
> å°ç»“
>
> - **èƒ½ç”¨ `#{}` å°±ç”¨ `#{}`**ï¼ˆå®‰å…¨ï¼Œé˜² SQL æ³¨å…¥ï¼‰ã€‚
> - **å¿…é¡»ç”¨ `${}` çš„åœºæ™¯**ï¼š
>    âœ… è¡¨å / åˆ—å
>    âœ… ORDER BY åˆ—/æ–¹å‘
>    âœ… SQL å…³é”®å­—ï¼ˆå‡½æ•°åã€æ¡ä»¶ç‰‡æ®µï¼‰
>    âœ… DDL è¯­å¥

------

### MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ

- å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰ï¼Œå¦‚ï¼šSqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilderç­‰ï¼›
- å·¥å‚æ¨¡å¼ï¼Œå¦‚ï¼šSqlSessionFactoryã€ObjectFactoryã€MapperProxyFactoryï¼›
- å•ä¾‹æ¨¡å¼ï¼Œä¾‹å¦‚ErrorContextå’ŒLogFactoryï¼›
- ä»£ç†æ¨¡å¼ï¼ŒMybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœï¼›
- ç»„åˆæ¨¡å¼ï¼Œä¾‹å¦‚SqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰ï¼›
- æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œä¾‹å¦‚BaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandlerï¼›
- é€‚é…å™¨æ¨¡å¼ï¼Œä¾‹å¦‚Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°ï¼›
- è£…é¥°è€…æ¨¡å¼ï¼Œä¾‹å¦‚CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°ï¼›
- è¿­ä»£å™¨æ¨¡å¼ï¼Œä¾‹å¦‚è¿­ä»£å™¨æ¨¡å¼PropertyTokenizerï¼›

------

## SpringCloud

### äº†è§£SpringCloudå—ï¼Œè¯´ä¸€ä¸‹ä»–å’ŒSpringBootçš„åŒºåˆ«

Spring Bootæ˜¯ç”¨äºæ„å»ºå•ä¸ªSpringåº”ç”¨çš„æ¡†æ¶ï¼Œè€ŒSpring Cloudåˆ™æ˜¯ç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¾®æœåŠ¡æ¶æ„çš„å·¥å…·ï¼ŒSpring Cloudæä¾›äº†==æœåŠ¡æ³¨å†Œä¸å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€ç½‘å…³ç­‰åŠŸèƒ½ã€‚==

ä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œé€šè¿‡Spring Bootæ„å»ºå¾®æœåŠ¡åº”ç”¨ï¼Œç„¶åç”¨Spring Cloudæ¥å®ç°å¾®æœåŠ¡æ¶æ„ä¸­çš„å„ç§åŠŸèƒ½ã€‚

| åŠŸèƒ½               | Spring Cloud ç»„ä»¶                               | Spring Cloud Alibaba ç»„ä»¶             | è¯´æ˜                                                         |
| ------------------ | ----------------------------------------------- | ------------------------------------- | ------------------------------------------------------------ |
| **æœåŠ¡æ³¨å†Œä¸å‘ç°** | **Eureka**ï¼ˆæ—©æœŸï¼‰ã€Consulã€Zookeeper           | **Nacos**                             | Nacos åŒæ—¶æ”¯æŒæ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼›Eureka å·²åœæ­¢ç»´æŠ¤ï¼Œç”Ÿäº§ä¸Šå¤šç”¨ Consul / Nacosã€‚ |
| **é…ç½®ä¸­å¿ƒ**       | Spring Cloud Config                             | **Nacos Config**                      | Spring Cloud Config åŸºäº Git ç®¡ç†é…ç½®ï¼ŒNacos æ”¯æŒåŠ¨æ€é…ç½®ã€å®æ—¶åˆ·æ–°ã€‚ |
| **å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡** | Ribbonï¼ˆå·²åœæ›´ï¼‰ã€**Spring Cloud LoadBalancer** | **Dubbo + Nacos/Feign**ã€LoadBalancer | Ribbon å·²è¿‡æ—¶ï¼ŒSpring Cloud å®˜æ–¹æ¨è LoadBalancerï¼›é˜¿é‡Œç³»ä¹Ÿæ”¯æŒã€‚ |
| **æœåŠ¡è°ƒç”¨**       | **OpenFeign**                                   | **Dubbo / OpenFeign**                 | SpringCloud ä¸»æ¨ Feignï¼›é˜¿é‡Œç³»æ”¯æŒ Dubboï¼ˆRPCï¼‰å’Œ Feignï¼ˆHTTPï¼‰ã€‚ |
| **ç½‘å…³**           | Zuulï¼ˆ1.x åœæ›´ï¼‰ã€**Spring Cloud Gateway**      | **Spring Cloud Gateway**              | å®˜æ–¹ç»Ÿä¸€æ¨è Gatewayï¼ˆåŸºäº WebFluxï¼ŒåŠŸèƒ½æ›´å¼ºï¼‰ã€‚             |
| **ç†”æ–­ä¸é™æµ**     | Hystrixï¼ˆåœæ›´ï¼‰ã€Resilience4j                   | **Sentinel**                          | Sentinel æ˜¯é˜¿é‡Œå¼€æºçš„é«˜æ€§èƒ½æµé‡é˜²æŠ¤ã€ç†”æ–­ã€é™æµç»„ä»¶ã€‚        |
| **æ¶ˆæ¯é©±åŠ¨**       | Spring Cloud Streamï¼ˆæ”¯æŒ Kafkaã€RabbitMQï¼‰     | **RocketMQ Binder**ã€Kafkaã€RabbitMQ  | é˜¿é‡Œç³»æ¨è RocketMQï¼Œæ”¯æŒæ›´å¼ºçš„äº‹åŠ¡æ¶ˆæ¯ã€‚                    |
| **åˆ†å¸ƒå¼äº‹åŠ¡**     | æ— å®˜æ–¹å®ç°ï¼ˆéœ€ Seataã€Atomikos ç­‰ï¼‰             | **Seata**                             | Seata ä¸“é—¨è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œæ”¯æŒ ATã€TCCã€Saga æ¨¡å¼ã€‚      |
| **æœåŠ¡é“¾è·¯è¿½è¸ª**   | Sleuth + Zipkin                                 | **Sleuth + Zipkin/SkyWalking**        | é˜¿é‡Œç³»å¸¸ç”¨ SkyWalking ä½œä¸ºåˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ã€‚                   |
| **å®‰å…¨**           | Spring Cloud Security                           | -                                     | é˜¿é‡Œç³»ä¾èµ–æ›´åº•å±‚çš„å®‰å…¨ä½“ç³»ï¼ŒSpringCloud å®˜æ–¹æœ‰ OAuth2 æ”¯æŒã€‚ |
| **Job è°ƒåº¦**       | æ— å†…ç½®ï¼Œéœ€è¦ Quartz/XXL-Job                     | **Alibaba SchedulerX**ï¼ˆäº‘äº§å“ï¼‰      | SchedulerX æ˜¯é˜¿é‡Œäº‘æä¾›çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚                |

------

### ç”¨è¿‡å“ªäº›å¾®æœåŠ¡ç»„ä»¶ï¼Ÿ

![img](https://cdn.xiaolincoding.com//picgo/1715933382453-968d55a3-059b-423d-9f67-0ebf732fc400.png)

å¾®æœåŠ¡å¸¸ç”¨çš„ç»„ä»¶ï¼š

- **æ³¨å†Œä¸­å¿ƒ**ï¼šæ³¨å†Œä¸­å¿ƒæ˜¯å¾®æœåŠ¡æ¶æ„æœ€æ ¸å¿ƒçš„ç»„ä»¶ã€‚å®ƒèµ·åˆ°çš„ä½œç”¨æ˜¯å¯¹æ–°èŠ‚ç‚¹çš„æ³¨å†Œä¸çŠ¶æ€ç»´æŠ¤ï¼Œ**è§£å†³äº†ã€Œå¦‚ä½•å‘ç°æ–°èŠ‚ç‚¹ä»¥åŠæ£€æŸ¥å„èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€çš„é—®é¢˜ã€**ã€‚å¾®æœåŠ¡èŠ‚ç‚¹åœ¨å¯åŠ¨æ—¶ä¼šå°†è‡ªå·±çš„æœåŠ¡åç§°ã€IPã€ç«¯å£ç­‰ä¿¡æ¯åœ¨æ³¨å†Œä¸­å¿ƒç™»è®°ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå®šæ—¶æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€‚æ³¨å†Œä¸­å¿ƒé€šå¸¸ä¼šé‡‡ç”¨å¿ƒè·³æœºåˆ¶æœ€å¤§ç¨‹åº¦ä¿è¯å·²ç™»è®°è¿‡çš„æœåŠ¡èŠ‚ç‚¹éƒ½æ˜¯å¯ç”¨çš„ã€‚
- **è´Ÿè½½å‡è¡¡**ï¼šè´Ÿè½½å‡è¡¡**è§£å†³äº†ã€Œå¦‚ä½•å‘ç°æœåŠ¡åŠè´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°çš„é—®é¢˜ã€**ï¼Œé€šå¸¸å¾®æœåŠ¡åœ¨äº’ç›¸è°ƒç”¨æ—¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥é€šè¿‡IPã€ç«¯å£è¿›è¡Œè®¿é—®è°ƒç”¨ã€‚è€Œæ˜¯å…ˆé€šè¿‡æœåŠ¡ååœ¨æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢è¯¥æœåŠ¡æ‹¥æœ‰å“ªäº›èŠ‚ç‚¹ï¼Œæ³¨å†Œä¸­å¿ƒå°†è¯¥æœåŠ¡å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨è¿”å›ç»™æœåŠ¡è°ƒç”¨è€…ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æœåŠ¡å‘ç°ï¼Œå› æœåŠ¡é«˜å¯ç”¨çš„è¦æ±‚ï¼ŒæœåŠ¡è°ƒç”¨è€…ä¼šæ¥æ”¶åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå¿…é¡»è¦ä»ä¸­è¿›è¡Œé€‰æ‹©ã€‚å› æ­¤æœåŠ¡è°ƒç”¨è€…ä¸€ç«¯å¿…é¡»å†…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹å‘èµ·å®è´¨æ€§çš„é€šä¿¡è¯·æ±‚ã€‚
- **æœåŠ¡é€šä¿¡**ï¼šæœåŠ¡é€šä¿¡ç»„ä»¶è§£å†³äº†ã€Œ**æœåŠ¡é—´å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é€šä¿¡çš„é—®é¢˜**ã€ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§åè®®ï¼Œé€šå¸¸æ˜¯HTTP RESTfulé£æ ¼ã€‚ä½†å› ä¸ºRESTfulé£æ ¼è¿‡äºçµæ´»ï¼Œå¿…é¡»åŠ ä»¥çº¦æŸï¼Œé€šå¸¸åº”ç”¨æ—¶å¯¹å…¶å°è£…ã€‚ä¾‹å¦‚åœ¨SpringCloudä¸­å°±æä¾›äº†Feignå’ŒRestTemplateä¸¤ç§æŠ€æœ¯å±è”½åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œæ‰€æœ‰å¼€å‘è€…éƒ½æ˜¯åŸºäºå°è£…åç»Ÿä¸€çš„SDKè¿›è¡Œå¼€å‘ï¼Œæœ‰åˆ©äºå›¢é˜Ÿé—´çš„ç›¸äº’åˆä½œã€‚
- **é…ç½®ä¸­å¿ƒ**ï¼šé…ç½®ä¸­å¿ƒä¸»è¦è§£å†³äº†ã€Œ**å¦‚ä½•é›†ä¸­ç®¡ç†å„èŠ‚ç‚¹é…ç½®æ–‡ä»¶çš„é—®é¢˜**ã€ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œæ‰€æœ‰çš„å¾®æœåŠ¡èŠ‚ç‚¹éƒ½åŒ…å«è‡ªå·±çš„å„ç§é…ç½®æ–‡ä»¶ï¼Œå¦‚jdbcé…ç½®ã€è‡ªå®šä¹‰é…ç½®ã€ç¯å¢ƒé…ç½®ã€è¿è¡Œå‚æ•°é…ç½®ç­‰ã€‚è¦çŸ¥é“æœ‰çš„å¾®æœåŠ¡å¯èƒ½å¯èƒ½æœ‰å‡ åä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå°†è¿™äº›é…ç½®æ–‡ä»¶åˆ†æ•£å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸Šï¼Œå‘ç”Ÿé…ç½®æ›´æ”¹å°±éœ€è¦é€ä¸ªèŠ‚ç‚¹è°ƒæ•´ï¼Œå°†ç»™è¿ç»´äººå‘˜å¸¦æ¥å·¨å¤§çš„å‹åŠ›ã€‚é…ç½®ä¸­å¿ƒä¾¿ç”±æ­¤è€Œç”Ÿï¼Œé€šè¿‡éƒ¨ç½²é…ç½®ä¸­å¿ƒæœåŠ¡å™¨ï¼Œå°†å„èŠ‚ç‚¹é…ç½®æ–‡ä»¶ä»æœåŠ¡ä¸­å‰¥ç¦»ï¼Œé›†ä¸­è½¬å­˜åˆ°é…ç½®ä¸­å¿ƒã€‚ä¸€èˆ¬é…ç½®ä¸­å¿ƒéƒ½æœ‰UIç•Œé¢ï¼Œæ–¹ä¾¿å®ç°å¤§è§„æ¨¡é›†ç¾¤é…ç½®è°ƒæ•´ã€‚
- **é›†ä¸­å¼æ—¥å¿—ç®¡ç†**ï¼šé›†ä¸­å¼æ—¥å¿—ä¸»è¦æ˜¯è§£å†³äº†ã€Œ**å¦‚ä½•æ”¶é›†å„èŠ‚ç‚¹æ—¥å¿—å¹¶ç»Ÿä¸€ç®¡ç†çš„é—®é¢˜**ã€ã€‚å¾®æœåŠ¡æ¶æ„é»˜è®¤å°†åº”ç”¨æ—¥å¿—åˆ†åˆ«ä¿å­˜åœ¨éƒ¨ç½²èŠ‚ç‚¹ä¸Šï¼Œå½“éœ€è¦å¯¹æ—¥å¿—æ•°æ®å’Œæ“ä½œæ•°æ®è¿›è¡Œæ•°æ®åˆ†æå’Œæ•°æ®ç»Ÿè®¡æ—¶ï¼Œå¿…é¡»æ”¶é›†æ‰€æœ‰èŠ‚ç‚¹çš„æ—¥å¿—æ•°æ®ã€‚é‚£ä¹ˆæ€ä¹ˆé«˜æ•ˆæ”¶é›†æ‰€æœ‰èŠ‚ç‚¹çš„æ—¥å¿—æ•°æ®å‘¢ï¼Ÿä¸šå†…å¸¸è§çš„æ–¹æ¡ˆæœ‰ELKã€EFKã€‚é€šè¿‡æ­å»ºç‹¬ç«‹çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œå®šæ—¶æŠ“å–å„èŠ‚ç‚¹å¢é‡æ—¥å¿—å½¢æˆæœ‰æ•ˆçš„ç»Ÿè®¡æŠ¥è¡¨ï¼Œä¸ºç»Ÿè®¡å’Œåˆ†ææä¾›æ•°æ®æ”¯æ’‘ã€‚
- **åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª**ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªè§£å†³äº†ã€Œ**å¦‚ä½•ç›´è§‚çš„äº†è§£å„èŠ‚ç‚¹é—´çš„è°ƒç”¨é“¾è·¯çš„é—®é¢˜**ã€ã€‚ç³»ç»Ÿä¸­ä¸€ä¸ªå¤æ‚çš„ä¸šåŠ¡æµç¨‹ï¼Œå¯èƒ½ä¼šå‡ºç°è¿ç»­è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘æ¶‰åŠçš„æ¯ä¸ªå¾®æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œé€šè¿‡å¯è§†åŒ–é“¾è·¯å›¾å±•ç°ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿåˆ†æç³»ç»Ÿç“¶é¢ˆåŠå‡ºé”™çš„æœåŠ¡ã€‚
- **æœåŠ¡ä¿æŠ¤**ï¼šæœåŠ¡ä¿æŠ¤ä¸»è¦æ˜¯è§£å†³äº†ã€Œ**å¦‚ä½•å¯¹ç³»ç»Ÿè¿›è¡Œé“¾è·¯ä¿æŠ¤ï¼Œé¿å…æœåŠ¡é›ªå´©çš„é—®é¢˜**ã€ã€‚åœ¨ä¸šåŠ¡è¿è¡Œæ—¶ï¼Œå¾®æœåŠ¡é—´äº’ç›¸è°ƒç”¨æ”¯æ’‘ï¼Œå¦‚æœæŸä¸ªå¾®æœåŠ¡å‡ºç°é«˜å»¶è¿Ÿå¯¼è‡´çº¿ç¨‹æ± æ»¡è½½ï¼Œæˆ–æ˜¯ä¸šåŠ¡å¤„ç†å¤±è´¥ã€‚è¿™é‡Œå°±éœ€è¦å¼•å…¥æœåŠ¡ä¿æŠ¤ç»„ä»¶æ¥å®ç°é«˜å»¶è¿ŸæœåŠ¡çš„å¿«é€Ÿé™çº§ï¼Œé¿å…ç³»ç»Ÿå´©æºƒã€‚

SpringCloud Alibabaå®ç°çš„å¾®æœåŠ¡æ¶æ„ï¼š

![img](https://cdn.xiaolincoding.com//picgo/1715933831252-4dbe4ae0-8072-4512-b54b-39ea5e8b3153.png)

- SpringCloud Alibabaä¸­ä½¿ç”¨**Alibaba Nacos**ç»„ä»¶å®ç°**æ³¨å†Œä¸­å¿ƒ**ï¼ŒNacosæä¾›äº†ä¸€ç»„ç®€å•æ˜“ç”¨çš„ç‰¹æ€§é›†ï¼Œå¯å¿«é€Ÿå®ç°åŠ¨æ€æœåŠ¡å‘ç°ã€æœåŠ¡é…ç½®ã€æœåŠ¡å…ƒæ•°æ®åŠæµé‡ç®¡ç†ã€‚
- SpringCloud Alibaba ä½¿ç”¨**NacosæœåŠ¡ç«¯å‡è¡¡**å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸Ribbonåœ¨è°ƒç”¨ç«¯è´Ÿè½½ä¸åŒï¼ŒNacosæ˜¯åœ¨æœåŠ¡å‘ç°çš„åŒæ—¶åˆ©ç”¨è´Ÿè½½å‡è¡¡è¿”å›æœåŠ¡èŠ‚ç‚¹æ•°æ®ã€‚
- SpringCloud Alibaba ä½¿ç”¨**Netflix Feign**å’Œ**Alibaba Dubbo**ç»„ä»¶æ¥å®ç°æœåŠ¡é€šè¡Œï¼Œå‰è€…ä¸SpringCloudé‡‡ç”¨äº†ç›¸åŒçš„æ–¹æ¡ˆï¼Œåè€…åˆ™æ˜¯å¯¹è‡ªå®¶çš„**RPC æ¡†æ¶Dubbo**ä¹Ÿç»™äºˆæ”¯æŒï¼Œä¸ºæœåŠ¡é—´é€šä¿¡æä¾›å¦ä¸€ç§é€‰æ‹©ã€‚
- SpringCloud Alibaba åœ¨**APIæœåŠ¡ç½‘å…³**ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ä¸SpringCloudç›¸åŒçš„ç»„ä»¶ï¼Œå³ï¼š**SpringCloud Gateway**ã€‚
- SpringCloud Alibabaåœ¨é…ç½®ä¸­å¿ƒç»„ä»¶ä¸­ä½¿ç”¨**Nacoså†…ç½®é…ç½®ä¸­å¿ƒ**ï¼ŒNacoså†…ç½®çš„é…ç½®ä¸­å¿ƒï¼Œå¯å°†é…ç½®ä¿¡æ¯**å­˜å‚¨ä¿å­˜åœ¨æŒ‡å®šæ•°æ®åº“**ä¸­
- SpringCloud Alibabaåœ¨åŸæœ‰çš„**ELKæ–¹æ¡ˆ**å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ï¼ˆLOGï¼‰å®ç°æ—¥å¿—é›†ä¸­å¼ç®¡ç†ã€‚
- SpringCloud Alibabaåœ¨**åˆ†å¸ƒå¼é“¾è·¯ç»„ä»¶**ä¸­é‡‡ç”¨ä¸SpringCloudç›¸åŒçš„æ–¹æ¡ˆï¼Œå³ï¼š**Sleuth/Zipkin Server**ã€‚
- SpringCloud Alibabaä½¿ç”¨**Alibaba Sentinel**å®ç°ç³»ç»Ÿä¿æŠ¤ï¼ŒSentinelä¸ä»…åŠŸèƒ½æ›´å¼ºå¤§ï¼Œå®ç°ç³»ç»Ÿä¿æŠ¤æ¯”Hystrixæ›´ä¼˜é›…ï¼Œè€Œä¸”è¿˜æ‹¥æœ‰æ›´å¥½çš„UIç•Œé¢ã€‚

------

### è´Ÿè½½å‡è¡¡æœ‰å“ªäº›ç®—æ³•ï¼Ÿ

- ç®€å•è½®è¯¢ï¼šå°†è¯·æ±‚æŒ‰é¡ºåºåˆ†å‘ç»™åç«¯æœåŠ¡å™¨ä¸Šï¼Œä¸å…³å¿ƒæœåŠ¡å™¨å½“å‰çš„çŠ¶æ€ï¼Œæ¯”å¦‚åç«¯æœåŠ¡å™¨çš„æ€§èƒ½ã€å½“å‰çš„è´Ÿè½½ã€‚

- åŠ æƒè½®è¯¢ï¼šæ ¹æ®æœåŠ¡å™¨è‡ªèº«çš„æ€§èƒ½ç»™æœåŠ¡å™¨è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œå°†è¯·æ±‚æŒ‰é¡ºåºå’Œæƒé‡åˆ†å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è®©æ€§èƒ½é«˜çš„æœºå™¨å¤„ç†æ›´å¤šçš„è¯·æ±‚

  Ribbon

  > åŠ¨æ€æŠ‰æ‹© ribbonè®¡ç®—å“åº”æ—¶é—´å¹¶è°ƒæ•´æƒé‡

  SpringCloud LoadBalancer 

  > [ä½ çš„æœåŠ¡æ¶ˆè´¹è€…]
  >        â”‚
  >        â–¼
  > [é‡‡é›†è°ƒç”¨æŒ‡æ ‡] â†â”€ Micrometer / Sleuth / è‡ªå®šä¹‰åŸ‹ç‚¹
  >        â”‚
  >        â–¼
  > [è®¡ç®—æ–°æƒé‡]   â†â”€ æ ¹æ®å»¶è¿Ÿã€é”™è¯¯ç‡ã€è´Ÿè½½ç­‰
  >        â”‚
  >        â–¼
  > [è°ƒç”¨æ³¨å†Œä¸­å¿ƒAPI] â†â”€ Nacos/Consul/Eureka Client
  >        â”‚
  >        â–¼
  > [æ›´æ–°å®ä¾‹æƒé‡]   â†â”€ ä¿®æ”¹ metadata.weight æˆ– instance.weight
  >        â”‚
  >        â–¼
  > [SCLB ä¸‹æ¬¡æ‹‰å–æœåŠ¡åˆ—è¡¨æ—¶è‡ªåŠ¨æ„ŸçŸ¥æ–°æƒé‡]
  >        â”‚
  >        â–¼
  > [è´Ÿè½½å‡è¡¡æ—¶æŒ‰æ–°æƒé‡é€‰æ‹©å®ä¾‹]

- ç®€å•éšæœºï¼šå°†è¯·æ±‚éšæœºåˆ†å‘ç»™åç«¯æœåŠ¡å™¨ä¸Šï¼Œè¯·æ±‚è¶Šå¤šï¼Œå„ä¸ªæœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚è¶Šå¹³å‡

- åŠ æƒéšæœºï¼šæ ¹æ®æœåŠ¡å™¨è‡ªèº«çš„æ€§èƒ½ç»™æœåŠ¡å™¨è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œå°†è¯·æ±‚æŒ‰å„ä¸ªæœåŠ¡å™¨çš„æƒé‡éšæœºåˆ†å‘ç»™åç«¯æœåŠ¡å™¨

- ä¸€è‡´æ€§å“ˆå¸Œï¼šæ ¹æ®è¯·æ±‚çš„å®¢æˆ·ç«¯ ipã€æˆ–è¯·æ±‚å‚æ•°é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å€¼ï¼Œåˆ©ç”¨è¯¥æ•°å€¼å–æ¨¡æ˜ å°„å‡ºå¯¹åº”çš„åç«¯æœåŠ¡å™¨ï¼Œè¿™æ ·èƒ½ä¿è¯åŒä¸€ä¸ªå®¢æˆ·ç«¯æˆ–ç›¸åŒå‚æ•°çš„è¯·æ±‚æ¯æ¬¡éƒ½ä½¿ç”¨åŒä¸€å°æœåŠ¡å™¨

- æœ€å°æ´»è·ƒæ•°ï¼šç»Ÿè®¡æ¯å°æœåŠ¡å™¨ä¸Šå½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚æ´»è·ƒæ•°ï¼Œå°†è¯·æ±‚åˆ†å‘ç»™æ´»è·ƒæ•°æœ€å°‘çš„åå°æœåŠ¡å™¨

  > å®¢æˆ·ç«¯ç»Ÿè®¡çš„ **æ´»è·ƒè¯·æ±‚æ•°** = è¯¥å®¢æˆ·ç«¯ **å¯¹æ¯ä¸ªæœåŠ¡å®ä¾‹å‘é€ä½†è¿˜æœªæ”¶åˆ°å“åº”çš„è¯·æ±‚æ•°**

------

### ä»‹ç»ä¸€ä¸‹æœåŠ¡ç†”æ–­

æœåŠ¡ç†”æ–­æ˜¯åº”å¯¹å¾®æœåŠ¡é›ªå´©æ•ˆåº”çš„ä¸€ç§**é“¾è·¯ä¿æŠ¤æœºåˆ¶ï¼Œç±»ä¼¼è‚¡å¸‚ã€ä¿é™©ä¸**ã€‚

æ¯”å¦‚è¯´ï¼Œå¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®äº¤äº’æ˜¯é€šè¿‡è¿œç¨‹è°ƒç”¨æ¥å®Œæˆçš„ã€‚æœåŠ¡Aè°ƒç”¨æœåŠ¡ï¼ŒæœåŠ¡Bè°ƒç”¨æœåŠ¡Cï¼ŒæŸä¸€æ—¶é—´é“¾è·¯ä¸Šå¯¹æœåŠ¡Cçš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…æœåŠ¡Cä¸å¯ç”¨ï¼Œéšç€æ—¶é—´çš„å¢é•¿ï¼Œå¯¹æœåŠ¡Cçš„è°ƒç”¨ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œç„¶åæœåŠ¡Cå´©æºƒäº†ï¼Œä½†æ˜¯é“¾è·¯è°ƒç”¨è¿˜åœ¨ï¼Œå¯¹æœåŠ¡Bçš„è°ƒç”¨ä¹Ÿåœ¨æŒç»­å¢å¤šï¼Œç„¶åæœåŠ¡Bå´©æºƒï¼Œéšä¹‹Aä¹Ÿå´©æºƒï¼Œå¯¼è‡´é›ªå´©æ•ˆåº”ã€‚

æœåŠ¡ç†”æ–­æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚ä¾‹å¦‚åœ¨é«˜å‹ç”µè·¯ä¸­ï¼Œå¦‚æœæŸä¸ªåœ°æ–¹çš„ç”µå‹è¿‡é«˜ï¼Œç†”æ–­å™¨å°±ä¼šç†”æ–­ï¼Œå¯¹ç”µè·¯è¿›è¡Œä¿æŠ¤ã€‚åŒæ ·ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç†”æ–­æœºåˆ¶ä¹Ÿæ˜¯èµ·ç€ç±»ä¼¼çš„ä½œç”¨ã€‚å½“è°ƒç”¨é“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡ç†”æ–­ï¼Œä¸å†æœ‰è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚

æ‰€ä»¥ï¼ŒæœåŠ¡ç†”æ–­çš„ä½œç”¨ç±»ä¼¼äºæˆ‘ä»¬å®¶ç”¨çš„ä¿é™©ä¸ï¼Œå½“æŸæœåŠ¡å‡ºç°ä¸å¯ç”¨æˆ–å“åº”è¶…æ—¶çš„æƒ…å†µæ—¶ï¼Œä¸ºäº†é˜²æ­¢æ•´ä¸ªç³»ç»Ÿå‡ºç°é›ªå´©ï¼Œæš‚æ—¶åœæ­¢å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ã€‚

åœ¨Spring Cloudæ¡†æ¶é‡Œï¼Œ==ç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°==ã€‚Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚

------

### ä»‹ç»ä¸€ä¸‹æœåŠ¡é™çº§

æœåŠ¡é™çº§ä¸€èˆ¬æ˜¯æŒ‡åœ¨æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æ—¶å€™ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡ä½¿ç”¨æƒ…å†µä»¥åŠæµé‡ï¼Œå¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„ä¸å¤„ç†æˆ–è€…ç”¨ä¸€ç§ç®€å•çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä»è€Œ**é‡Šæ”¾æœåŠ¡å™¨èµ„æºçš„èµ„æºä»¥ä¿è¯æ ¸å¿ƒä¸šåŠ¡çš„æ­£å¸¸é«˜æ•ˆè¿è¡Œã€‚**

æœåŠ¡å™¨çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œè€Œè¯·æ±‚æ˜¯æ— é™çš„ã€‚åœ¨ç”¨æˆ·ä½¿ç”¨å³å¹¶å‘é«˜å³°æœŸï¼Œä¼šå½±å“æ•´ä½“æœåŠ¡çš„æ€§èƒ½ï¼Œä¸¥é‡çš„è¯ä¼šå¯¼è‡´å®•æœºï¼Œä»¥è‡³äºæŸäº›é‡è¦æœåŠ¡ä¸å¯ç”¨ã€‚æ•…é«˜å³°æœŸä¸ºäº†ä¿è¯æ ¸å¿ƒåŠŸèƒ½æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå°±éœ€è¦å¯¹æŸäº›æœåŠ¡é™çº§å¤„ç†ã€‚å¯ä»¥ç†è§£ä¸ºèˆå°ä¿å¤§

æœåŠ¡é™çº§æ˜¯ä»æ•´ä¸ªç³»ç»Ÿçš„è´Ÿè·æƒ…å†µå‡ºå‘å’Œè€ƒè™‘çš„ï¼Œå¯¹æŸäº›è´Ÿè·ä¼šæ¯”è¾ƒé«˜çš„æƒ…å†µï¼Œä¸ºäº†é¢„é˜²æŸäº›åŠŸèƒ½ï¼ˆä¸šåŠ¡åœºæ™¯ï¼‰å‡ºç°è´Ÿè·è¿‡è½½æˆ–è€…å“åº”æ…¢çš„æƒ…å†µï¼Œåœ¨å…¶å†…éƒ¨æš‚æ—¶èˆå¼ƒå¯¹ä¸€äº›éæ ¸å¿ƒçš„æ¥å£å’Œæ•°æ®çš„è¯·æ±‚ï¼Œ==è€Œç›´æ¥è¿”å›ä¸€ä¸ªæå‰å‡†å¤‡å¥½çš„fallbackï¼ˆé€€è·¯ï¼‰é”™è¯¯å¤„ç†ä¿¡æ¯==ã€‚è¿™æ ·ï¼Œè™½ç„¶æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰æŸçš„æœåŠ¡ï¼Œä½†å´ä¿è¯äº†æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚==ç†”æ–­æˆ–è€…æœåŠ¡è°ƒç”¨æ–¹å‡ºå¼‚å¸¸éƒ½ä¼šèµ°é™çº§==
